\chapter{Perturbation Theory}
\label{ch:perturbation}

Perturbation theory is a very powerful method and a generic method applicable to all 
matrix problems. Additionally, perturbation theory is relatively cheap in terms of computing
time, especially compared with coupled cluster theory. The method provides a different 
route to the solution of the Schrödinger equation, by approaching the exact solution 
systematically, based on an order-by-order expansion of the energy and wavefunction. 
Therefore, perturbation theory is often used to improve the results from other computational
schemes. What is more, the exponential form of the wavefunction in coupled cluster theory 
stems from the non-degenerate Rayleigh-Schrödinger perturbation theory (RSPT) expansion.

\section{Formal perturbation theory}

We split the Hamiltonian into a known part and a perturbed part,
\begin{equation}
    \hat{H} = \hat{H}_0 + \hat{V}.
\end{equation}
Sometimes it is convenient to write
\begin{equation}
    \label{eq:schrodinger_w_order_param}
    \hat{H} = \hat{H}_0 + \lambda\hat{V},
\end{equation}
where we have included an "order parameter" $\lambda$. This parameter is used to categorise
the contributions of different order. 
The exact solution is given by
\begin{equation}
    \label{eq:perturbation_schrodinger}
    \begin{gathered}
        \hat{H} \Psi_n = E_n \Psi_n \\
        (\hat{H}_0 + \hat{V}) \Psi_n = E_n \Psi_n, \quad \Psi_n = \Phi_n + \chi_n,
    \end{gathered}
\end{equation}
while the solvable and simple zero order problem is given by
\begin{equation}
    \label{eq:zero_order_perturbed_schrodinger}
    \hat{H}_0 \Phi_n = E_n^{(0)} \Phi_n.
\end{equation}
The set $\{\Phi_n\}$ is assumed to be an orthonormal basis for the Hilbert space. The 
excat wavefunction $\Psi_n$ is split into a zero-order part $\Phi_n$ and the 
perturbative part $\chi_n$.

By projecting \autoref{eq:perturbation_schrodinger} with $\bra{\Phi_0}$ we get
\begin{equation}
    \begin{gathered}
    \bra{\Phi_n} \hat{H}_0 \ket{\Psi_n} + \bra{\Phi_n} \hat{V} \ket{\Psi_n}
        = E_n \braket{\Phi_n}{\Psi_n} \\
    \to E_n = \bra{\Phi_n} \hat{H} \ket{\Psi_n} \\
    \to \Delta E_n = E_n - E_n^{0} = \bra{\Phi_n} \hat{V} \ket{\Psi_n}
    \end{gathered}
\end{equation}
where we have used that 
\begin{gather}
    \label{eq:intermediate_normalisation}
    \braket{\Phi_m}{\Phi_n} = \delta_{mn}, \\
    \braket{\Psi_n}{\Phi_n} = \braket{\Phi_n + \chi_n}{\Phi_n} = 1, \\
    \braket{\Psi_n} = 1 + \braket{\chi_n}.
\end{gather}
This is called the intermediate normalisation assumption.

\subsection{Energy- and Wavefunction Expansion}

We now have need for the order parameter from $\lambda$ \autoref{eq:schrodinger_w_order_param}
as we expand the wavefunction and energy,
\begin{equation}
    \begin{aligned}
        \Psi_n &= \Phi_n + \chi_n = \Psi_n^{(0)} + \lambda\Psi_n^{(1)} 
            + \lambda^2\Psi_n^{(2)} + \dots \quad (\Psi_n^{(0)} \equiv \Phi_n) \\
        E_n &= E_n^{(0)} + \Delta E_n = E_n^{(0)} + \lambda E_n^{(1)} 
            + \lambda^2 E_n^{(2)} + \dots 
    \end{aligned}
\end{equation}
We insert these expansions into the Schrödinger equation,
\begin{equation}
    \begin{aligned}
        (\hat{H} - E_n) \Psi_n = 0 \\
        (\hat{H}_0 + \lambda \hat{V})\Psi_n = 0,
    \end{aligned}
\end{equation}
resulting in 
\begin{equation}
    (\hat{H}_0 + \lambda \hat{V} - E_n^{(0)} - \lambda E_n^{(1)} 
        -\lambda^2 E_n^{(2)} - \dots)
    (\Psi_n^{(0)} + \lambda \Psi_n^{(1)} + \lambda \Psi_n^{(2)} + \dots) = 0.
\end{equation}
Now we gather the coefficients of different powers of $\lambda$,
\begin{align}
    (\hat{H}_0 - E_n^{(0)})\Psi_n^{(0)} &= 0 \\
    \label{eq:perturbation_lambda_power_first}
    (\hat{H}_0 - E_n^{(0)})\Psi_n^{(1)} &= (E_n^{(1)} - \hat{V})\Psi_n^{(0)}  \\
    (\hat{H}_0 - E_n^{(0)})\Psi_n^{(2)} &= (E_n^{(1)} - \hat{V})\Psi_n^{(1)}
        + E_n^{(2)}\Psi_n^{(0)} \\
        &\dots \nonumber \\
    \label{eq:perturbation_lambda_power_mth}
    (\hat{H}_0 - E_n^{(0)})\Psi_n^{(m)} &= (E_n^{(1)} - \hat{V})\Psi_n^{(m-1)}
        + \sum_{l=0}^{m-2} E_n^{(m-l)}\Psi_n^{(l)}.
\end{align}
Where the last line gives a general $m$th-order equation. This equation can be 
simplified somewhat,
\begin{equation}
    (E_n^{(0)} - \hat{H}_0)\Psi_n^{(m)} = \hat{V}\Psi_n^{(m-1)} 
        - \sum_{l=0}^{m-1}E_n^{(m-l)}\Psi_n^{(l)}.
\end{equation}
By applying $\bra{\Phi_n}$ to each of the equations, we get expressions 
for $E_n^{(m)}$. 
For $\lambda^1$ (\autoref{eq:perturbation_lambda_power_first}) we get,
\begin{equation}
    \begin{gathered}
    \bra{\Phi_n} \hat{H}_0 - E_n^{(0)}\ket{\Psi_n^{(1)}}
        = \bra{\Phi_n} E_n^{(1)} - \hat{V}\ket{\Phi_n} \\
    \bra{(\hat{H}_0 - E_n^{(0)})\Phi_n} \ket{\Psi_n^{(1)}}
        = \bra{\Phi_n} E_n^{(1)} - \hat{V}\ket{\Phi_n} \\
    \to E_n^{(1)} = \bra{\Phi_n} \hat{V} \ket{\Phi_n} = \hat{V}_{nn}.
    \end{gathered}
\end{equation}
Since we have an expression for $E_n^{(1)}$, we can solve the inhomogeneous 
differential equation for $\Psi_n^{(1)}$, by also requiring the intermediate
normalisation condition $\braket{\Phi_n}{\Psi_n^{(1)}} = 0$. For 
the general $m$th-order expression (\autoref{eq:perturbation_lambda_power_mth}),
\begin{equation}
    \begin{gathered}
        \bra{\Phi_n} E_n^{0} - \hat{H}_0\ket{\Psi_n^{(m)}}
            = \bra{\Phi_n} \hat{V} \ket{\Psi_n^{(m-1)}}
            - \sum_{l=0}^{m-1}E_n^{(m-l)}\braket{\Phi_n}{\Psi_n^{(l)}} \\
        E_n^{(m)} = \bra{\Phi_n^{(m)}} = \bra{\Phi_n} \hat{V} \ket{\Psi_n^{(m-1)}}.
    \end{gathered}
\end{equation} 
In principle, we can obtain every next-order energy contribution $E_n^{(m)}$ from 
the previous-order wavefunctions $\Psi_n^{(m-1)}$ and then solve for $\Psi_n^{(m)}$.

\subsection{Projection Operators}
We define the projection operators, $\hat{P}$ and $\hat{Q}$, in terms of the
zero-order wavefunctions,
\begin{equation}
    \begin{aligned}
        \hat{P} &= \ket{\Phi_0} \bra{\Phi_0} \\
        \hat{Q} &= \hat{1} - \hat{P} = \sum_{i=1}^N \ket{\Phi_i} \bra{\Phi_i}.
    \end{aligned}
\end{equation}
The projecton operators have the following convenient properties,
\begin{equation}
    \begin{gathered}
    \hat{P}^2 =  \ket{\Phi_0}\bra{\Phi_0}\ket{\Phi_0}\bra{\Phi_0} 
        = \ket{\Phi_0}\bra{\Phi_0} = \hat{P} \\
    \hat{Q}^2 = (1 - \hat{P})^2 = \hat{1} - \hat{P} - \hat{P} + \hat{P}
        = \hat{1} - \hat{P} = \hat{Q} \\
    \hat{P}\hat{Q} = \hat{Q} \hat{P} = 0 \\
    [ \hat{P}, \hat{H}_0 ] = [ \hat{Q}, \hat{H}_0 ] = 0
    \end{gathered}
\end{equation}

If we write the wavefunction as a linear expansion in terms of $\Phi_i$,
\begin{equation}
    \Phi = \sum_i a_i \Phi_i,
\end{equation}
acting on it with the projection operators yields
\begin{equation}
    \hat{P} \Psi = \sum_i a_i \ket{\Phi_0}\bra{\Phi_0}\ket{\Phi_i}
        = \sum_i a_i\ket{\Phi_0}\delta_{0i} = a_0\Phi_0.
\end{equation}
For sake of specificity, the operator $\hat{P}$ will extract $\Phi_0$ from 
$\Psi$, while $\hat{Q}$ annihilates $\Phi_0$,
\begin{equation}
    \hat{Q}\Psi = (\hat{1} - \hat{P})\Psi = \Psi - a_0\Phi_0 
        = \sum_{i=1}^N a_i\Phi_i,
\end{equation}
meaning we can write
\begin{equation}
    \Psi = \hat{P} \Psi + \hat{Q} \Psi.
\end{equation}

\subsection{The Resolvent}
Now follows what some considers a more elegant derivation of the perturbation equations,
including the introduction of the \emph{resolvent} of the unperturbed part of the Hamiltonian
$\hat{H}_0$.

Starting from a rearrangment of the Schrödinger equation,
\begin{equation}
    \begin{gathered}
        (\hat{H}_0 + \hat{V})\Psi = E\Psi, \\
        \to -\hat{H}_0 \Phi = (\hat{V} - E)\Psi,
    \end{gathered}
\end{equation}
we introduce a seemingly arbitrary parameter $\zeta$, the purpose of which will be 
apperent later. This parameter is introduced by adding $\zeta\Phi$ to both sides,
\begin{equation}
    (\zeta - \hat{H}_0)\Phi = (\hat{V} - E + \zeta)\Phi.
\end{equation}
Next, we apply $\hat{Q}$ to both sides,
\begin{equation}
    \label{eq:q_space_schrodinger_1} 
    \hat{Q}(\zeta - \hat{H}_0)\Psi = \hat{Q}(\hat{V} - E + \zeta)\Psi.
\end{equation}
The right-hand side of this expression can be rewritten as,
\begin{equation}
    \begin{aligned}
    \hat{Q}(\zeta - \hat{H}_0)\Psi &= \hat{Q}^2(\zeta - \hat{H}_0)
        = \hat{Q}(\zeta - \hat{H}_0)\hat{Q}\Psi \\
        &= \sum_{i \neq 0} \sum_{j \neq 0} \ket{\Phi_i} \bra{\Phi_i}
            \zeta - \hat{H}_0 \ket{\Phi_j} \bra{\Phi_j},
    \end{aligned}
\end{equation}
\autoref{eq:q_space_schrodinger_1} is now 
\begin{equation}
    \label{eq:q_space_schrodinger_2}
    \hat{Q}(\zeta - \hat{H}_0)\hat{Q}\Psi = \hat{Q}(\hat{V} - E + \zeta)\Psi.
\end{equation}

By restricting to choice of $\zeta$, so they do not coincide with the eigenvalues
of $\hat{H}_0$ in $\hat{Q}$-space, i.e. $\{\Phi_i | i \neq 0\}$, we ensure that the inverse of 
$\hat{Q}(\zeta - \hat{H}_0)\hat{Q}$ exists. This inverse is the \emph{resolvent} of
$\hat{H}_0$,
\begin{equation}
    \hat{R}_0(\zeta) = \frac{\hat{Q}}{\zeta - \hat{H}_0}
        \equiv \sum_{i \neq 0} \sum_{j \neq 0}
            \ket{\Phi_i}\bra{\Phi_i} 
            (\zeta - \hat{H}_0)^{-1}
            \ket{\Phi_j}\bra{\Phi_j}.
\end{equation}
The resolvent simplifies in the diagonal case to
\begin{equation}
    \hat{R}_0(\zeta)
        = \sum_{i \neq 0} \ket{\Phi_i} \bra{\Phi_i}
            (\zeta - E_j^{(0)})^{-1} \ket{\Phi_j}\bra{\Phi_j}
        = \sum_{i \neq 0} \frac{\ket{\Phi_i} \bra{\Phi_i}}{(\zeta - E_i^{(0)})}. 
\end{equation}

We can prove that $\hat{R}_0(\zeta)$ is the inverse of
$\hat{Q}(\zeta - \hat{H}_0)\hat{Q}$ in $\hat{Q}$-space,
\begin{equation}
    \begin{aligned}
        \frac{\hat{Q}}{\zeta - \hat{H}_0} &\hat{Q}(\zeta - \hat{H}_0)\hat{Q} \\
            &= \left(
                \sum_{i,j \neq 0} \ket{\Phi_i}\bra{\Phi_i}
                    (\zeta - \hat{H}_0)^{-1} \ket{\Phi_j}\bra{\Phi_j}
            \right) \left(
                \sum_{k,l \neq 0} \ket{\Phi_k}\bra{\Phi_k}
                    (\zeta - \hat{H}_0) \ket{\Phi_l}\bra{\Phi_l}
            \right) \\
            &= \sum_{i,l \neq 0} \ket{\Phi_i}
                \bra{\Phi_i}
                    (\zeta - \hat{H}_0)^{-1}
                    \left(\sum_{j \neq 0} \ket{\Phi_j} \bra{\Phi_j} \right)
                    (\zeta - \hat{H}_0)
                \ket{\Phi_l}
            \bra{\Phi_l} \\
            &= \sum_{i, l \neq 0} \ket{\Phi_i}
                \bra{\Phi_i} (\zeta - \hat{H}_0)^{-1}
                (1 - \ket{\Phi_0}\bra{\Phi_0})
                (\zeta - \hat{H}_0) \ket{\Phi_l}
            \bra{\Phi_l} \\
            &= \sum_{i \neq 0} \ket{\Phi_i}\bra{\Phi_i} = \hat{Q}.
    \end{aligned}
\end{equation}

Applying the resolvent to both sides of \autoref{eq:q_space_schrodinger_2},
\begin{equation}
    \begin{gathered}
    \hat{Q}\Psi = \hat{R}_0(\zeta)(\hat{V} - E + + \zeta)\Psi \\
    \to \Psi = \Phi_0 + \hat{R}_0(\zeta)(\hat{V} - E + \zeta)\Psi,
    \end{gathered}
\end{equation}
which can be interpreted as a recursive relation for $\Psi$. Inserting the 
expression for $\Psi$ into itself repeatedly, yields 
\begin{equation}
    \label{eq:perturbation_wavefunction}
    \Psi = \sum_{m=0}^\infty [\hat{R}_0(\zeta)(\hat{V}) - E + \zeta ]^m \Phi_0.
\end{equation}
We can find an expression for the perturbative energy correction by left-projecting 
this expression with $\bra{\Phi_0}\hat{V}$,
\begin{equation}
    \label{eq:perturbation_energy}
    \Delta E = \mel{\Phi_0}{\hat{V}}{\Psi} 
        = \sum_{m=0}^\infty \mel*{\Phi_0}
        {
            \left[\hat{R}_0(\zeta)(\hat{V} - E + \zeta)\right]^m
        }{\Phi_0}.
\end{equation}

The problem with these equations is that $E$, which is unknown, appears on the right-hand
side. One would also wonder what to do with $\zeta$. There are two common 
choices for $\zeta$ that give rise to two important theories,
\begin{align*}
    \zeta = E &\leftarrow \text{Brillouin-Wigner Perturbation} \\
    \zeta = E^{(0)}_0 \to -E + \zeta = -\Delta E 
        &\leftarrow \text{Rayleigh-Schrödinger Perturbation}.
\end{align*}

\section{Brillouin-Wigner Perturbation Theory}

By setting $\zeta = E$ in \autoref{eq:perturbation_wavefunction} and 
\autoref{eq:perturbation_energy} we get Brilloun-Wigner
perturbation theory\cite{brillouin1932problemes,wigner1935modification}. 
The wavefunction- and energy expression becomes the following,
\begin{gather}
    \Psi = \sum_{m=0}^\infty [\hat{R}_0(E) \hat{V}]^m \Phi_0 \\
    \Delta E = \sum_{m=0}^\infty 
        \mel*{\Phi_0}{\hat{V}[\hat{R}_0(E)\hat{V}]^m}{\Phi_0}.
\end{gather}
Moreover, the resolvent is given by 
\begin{equation}
    \hat{R}_0 = \sum_i \frac{\dyad{\Phi_i}{\Phi_i}}{E - E_i^{(0)}}.
\end{equation}
As we can see, these equations are still implicit, i.e. $E$ appears on the 
right-hand side. In order to compute corrections in the energy and wavefunctions 
estimates, we need an estimate for $E$. A common estimate for the first-order 
energy is $E^{(0)}_0 + \mel*{\Phi_0}{\hat{V}}{\Phi_0}$. From this we can continue 
computing the second-order energy,
\begin{equation}
    \begin{aligned}
        E^{(2)}
            &= \mel*{\Phi_0}{\hat{V}\hat{R}_0(E)\hat{V}}{\Phi_0} \\
            &= \sum_i \frac{\mel*{\Phi_0}{\hat{V}}{\Phi_i}
                \mel*{\Phi_i}{\hat{V}}{\Phi_0}
            }{E - E^{(0)}_i} \\
            &= \sum_i \frac{V_{0i}V_i0}{E - E^{(0)}_i}.
    \end{aligned}
\end{equation}
Similiarly for the third-order energy,
\begin{equation}
    E^{(3)} = \sum_{ij} \frac{V_{0i}V_{ij}V_{j0}}{(E - E^{(0)}_i)(E - E^{(0)}_j)}.
\end{equation}

These expressions are somewhat simple, but Brilloun-Wigner is plagued by a fundamental
problem as it does not provide a true order-by-order expansion of the energy. This is 
due to the systematically prevalent presence of the infinite-order $E$-term in the right-hand 
sides of the equations. Related to this problem, is the lack of extensivity if the 
perturbation is truncated at any finite order. See 
\citeauthor{shavitt2009many}\cite{shavitt2009many} for a derivation of this
non-extensivity of finite-order Brilloun-Wigner perturbation theory. For this 
reason, we move on to Rayleigh-Schrödinger perturbation theory.

\section{Rayleigh-Schrödinger Perturbation Theory}

By setting $\zeta = E_0^{(0)}$ in \autoref{eq:perturbation_wavefunction} and
\autoref{eq:perturbation_energy} we get Rayleigh-Schrödinger perturbation
theory\cite{rayleigh1894theory,schrodinger1926quantisierung}. This parametrisation 
means that $\zeta - E = - \Delta E$, which gives us 
\begin{gather}
    \label{eq:rspt_wavefunction}
    \Psi = \sum_{m=0}^\infty \left[ 
        \hat{R}_0(E^{(0)}_0) (\hat{V} - \Delta E)     
    \right]^m \Phi_0 \\
    \label{eq:rspt_energy}
    \Delta E =  \sum_{m=0}^\infty \mel*{\Phi_0}
    {
        \hat{V} \left[\hat{R}_0 (E^{(0)}_0)(\hat{V} - \Delta E) \right]^m
    }{\Phi_0},
\end{gather}
where the resolvent becomes
\begin{equation}
    \hat{R}_0(E^{(0)}_0) = \sum_i \frac{\dyad{\Phi_i}{\Phi_i}}{E^{(0)} - E^{(0)}_i}.
\end{equation}
The keen reader will have noticed that these expressions are lacking the unknown 
$E$, but we still have an expression for $\Delta E$ in the right-hand side of the
expressions.


The first-order correction in energy is simply
\begin{equation}
    E^{(1)} = \mel{\Phi_0}{\hat{V}}{\Phi_0}.
\end{equation}
For the second order energy correction, $E^{(2)}$ we need the first-order 
wavefunction correction,
\begin{equation}
    \Psi^{(1)} = \hat{R}_0\hat{V}\Phi_0.
\end{equation}
Notice that the $\Delta E$-term to the right disappears as 
$\hat{R}_0\Delta_E\ket{\Phi_0} = \Delta_E\hat{R}_0\ket{\Phi_0} = 0$.
This gives us
\begin{equation}
    E^{(2)} = \mel{\Phi_0}{\hat{V}\hat{R}_0\hat{V}}{\Phi_0}
        = \sum_{i} \frac{|\mel{\Phi_0}{\hat{V}}{\Phi_i}|^2}{E^{(0)} - E^{(0)}_i}.
\end{equation}
For the third-order energy correction we need the second-order wavefunction correction,
\begin{equation}
    \Psi^{(2)} = \hat{R}_0(\hat{V} - \Delta E)\hat{R}\hat{V} \Phi_0
        = \hat{R}_0(\hat{V} - \mel{\Phi_0}{\hat{V}}{\Phi_0})\hat{R}\hat{V} \Phi_0,
\end{equation}
where we have started to treat the stepwise expansions as a recursive relation, by 
inserting the first-order energy corrections for $\Delta E$. Generally, we can 
write this recursive relation as
\begin{gather}
    E^{(n)} = \mel{\Psi_k}{\hat{V}}{\Psi^{(n-1)}_k}, \\
    \label{eq:recursive_relation_RSPT_wavefunction}
    \Psi^{n} = \hat{R}_0 \hat{V}\Psi^{(n-1)} - \sum_{j=1}^{n-1}E^{(n-j)} \Psi^{(j)}.
\end{gather}
The third order-energy correction becomes
\begin{equation}
    \begin{aligned}
    \label{eq:third_order_RSPT_energy}
    E^{(3)} =& \mel{\Phi_0}{\hat{V}\hat{R}_0[\hat{V} - \mel{\Phi_0}{\hat{V}}{\Phi_0}]}{\Phi_0} \\
        =& \mel{\Phi_0}{\hat{V}\hat{R}\hat{V}\hat{R}\hat{V}}{\Phi}
            - \mel{\Phi_0}{\hat{V} \hat{R}^2\hat{V}}{\Phi_0}
    \end{aligned}
\end{equation}
We should now notice that a pattern has arisen in the energy terms, albeit a bit complicated one. 
There will always be a leading term,
\begin{equation}
    E^{(n)} = \mel{\Phi_0}{\hat{V}\hat{R}\hat{V}\hat{R}\dots\hat{V}}{\Phi_0},
\end{equation}
with $n$ factors $\hat{V}$ and $n-1$ factors $\hat{R}$. But then we will have 
terms that are on the form 
\begin{equation}
    E^{(j)}\braket{\Psi^{(n-1)}}{\Psi^{(n-j)}} 
    = E^{(j)}\mel{\Phi_0}{\hat{V}\mathcal{M}(\hat{R}, \hat{V})\hat{V}}{\Phi_0},
\end{equation}
where $\mathcal{M}(\hat{R}, \hat{V})$ is the \emph{monomial} of in total 
$n - j - 2$ operators $\hat{V}$ and $\hat{R}$'s, in some order. The terms 
can be systematically generated from the leading energy term by a procedure called 
\emph{bracketing}.

The bracketing procedure can be quickly summarised as follows. The $n$th order 
energy $E^{(n)}$ can be written as the leading term plus terms generated by inserting 
some brackets $\langle$ $\rangle$ around one or more $\hat{V}$s, except for the outer 
ones, in \emph{any} possible way, in \emph{any} number. These terms may also be nested.
The bracket represents an expectation value with $\Psi$. The sign of each term is 
$(-1)^j$, where $j$ is the number of brackets in the term. 
For example, for $n=4$ we have four possibilities,
\begin{align}
    \mel{\Phi_0}{\hat{V}\hat{R}_0\ev*{\hat{V}}\hat{R}_0\hat{V}\hat{R}_0\hat{V}}{\Phi_0}
        =& - \mel{\Phi_0}{\hat{V}}{\Phi_0}
            \mel{\Phi_0}{\hat{V}\hat{R}_0^2\hat{V}\hat{R}_0\hat{V}}{\Phi_0} \\
    \mel{\Phi_0}{\hat{V}\hat{R}_0\hat{V}\hat{R}_0\ev*{\hat{V}}\hat{R}_0\hat{V}}{\Phi_0}
        =& - \mel{\Phi_0}{\hat{V}}{\Phi_0}
            \mel{\Phi_0}{\hat{V}\hat{R}_0\hat{V}\hat{R}_0^2\hat{V}}{\Phi_0} \\
    \mel{\Phi_0}{\hat{V}\hat{R}_0\ev*{\hat{V}}\hat{R}_0\ev*{\hat{V}}\hat{R}_0\hat{V}}{\Phi_0}
        =&  \mel{\Phi_0}{\hat{V}}{\Phi_0}^2
            \mel{\Phi_0}{\hat{V}\hat{R}_0^3\hat{V}}{\Phi_0} \\
    \mel{\Phi_0}{\hat{V}\hat{R}_0\ev*{\hat{V}\hat{R}_0\hat{V}}\hat{R}_0\hat{V}}{\Phi_0}
        =& - \mel{\Phi_0}{\hat{V}\hat{R}_0\hat{V}}{\Phi_0}
            \mel{\Phi_0}{\hat{V}\hat{R}_0^2\hat{V}}{\Phi_0}.
\end{align}
For higher order energies, we would see brackets within brackets, leading to an increasing 
growth rate in the number of terms.

We will end our discussion of many-body perturbation theory presently. In closing, 
one should take notice of the special form the second term in $E^{(3)}$
(\autoref{eq:third_order_RSPT_energy}) takes. These kinds of terms, called \emph{unlinked} terms, 
becomes more and more prevalent as the series expansion continues. This is apparent from 
the fourth-order energy term derived from the bracketing technique above. A very powerful theorem 
called the \emph{linked-diagram theorem}, derived by
\citeauthor{goldstone1957derivation}\cite{goldstone1957derivation}, states that the 
energy and the wavefunctions can be expressed as a sum of \emph{linked} terms only (!),
because all the 
unlinked diagrams in a Rayleigh-Schrödinger perturbation series cancels against the 
renormalisation terms\footnote{Additional sums in the  wavefunction expression 
involving lower-order energies in RSPT,
see \autoref{eq:recursive_relation_RSPT_wavefunction}}. Proving the linked-diagram 
theorem requires a herculean effort, and we will refrain from doing so. The entirety 
of chapter 6 in \citeauthor{shavitt2009many}\cite{shavitt2009many} is devoted to 
a proof of the linked-diagram theorem. What we will take with us is that the linked-diagram
theorem forms the foundation for the 
coupled cluster ``ansatz'' wavefunction, which we will introduce at the very beginning 
of the next chapter.
