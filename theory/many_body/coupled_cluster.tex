\chapter{Coupled Cluster}

In the late 1950s Fritz Coester constructed a rigorous formal solution of the bound
state Schrödinger equation as a set of single particle wave
functions\cite{coester1958bound}. He wanted to find an expression for the wave operator 
$\omega$, which transforms a zero-order wavefunction to the exact wave function,
\begin{equation}
    \Psi = \Omega \Phi_0.
\end{equation}
From Coester's solutions it would become apparent that the Rayleigh-Schrödinger 
perturbation expansions of the energy does not contain matrix elements representing 
the products of so-called unlinked diagram. In other words, one form of $\Omega$ is 
given a ``linked-diagram expansion'',
\begin{equation}
    \Omega\ket{\Phi_0} = \ket{\Phi_0} 
    = \sum_{k=1}^\infty\left((\hat{R}_0\hat{W})^k \ket{{\Phi_0}} \right)_L.
\end{equation}a
This is further underlined in discussions by John Hubbard\cite{hubbard1957description}
and Nicolaas Marinus Hugenholtz\cite{hugenholtz1957perturbation}.

Conveniently, $\Omega$ may be written quite generally as
\begin{equation}
    \Omega = e^{\hat{T}}, \quad \Psi = e^{\hat{T}}\Phi_0.
\end{equation}
This exponential form has been come to be known as the Coupled Cluster ansatz, even 
though it is much more than a simple guess for the form of the exact wavefunction.
To underline this point we quote Herman Kümmel: ``Strange as it may be, in spite of
the many successes of the coupled cluster method there is still a widspread belief
that the underlying exponential structure is something artificial, accidental or 
an approximation only. This is why I want to make it clear that this feature is 
extremely natural - even necessary - on a very fundamental level, not necessarily
connected with many-body theory''\cite{kummel1991origins}. 

Throughout the 1950s and early 1960s, Coester and Kümmel developed the coupled cluster method together and 
proposed using the exponential-form wave operator as coupling between the shell-model 
state and the correct state vector for nuclear matter\cite{coester1960short}. At the time, 
the method proved too computationally intensive. Specifically, the hard core potenatials 
of nuclear physics leaves no freedom in truncating the set of coupled cluster equations.
However, the method was picked up by 
Ji\v{r}\'{i} \v{C}\'{i}\v{z}ek who 
in 1966 reformulated the method for modelling of electron correlation in atoms and
molecules\cite{vcivzek1966correlation}. Further development with Josef Paldus
made the coupled cluster method one of the most succesfull\footnote{At least one of the
most prevalent} methods in quantum chemistry. Together with Isaiah Shavitt,
\v{C}\'{i}\v{z}ek and Paldus did the first \emph{ab initio} comutations with the method,
which they called the coupled-pair many-electron-theory (MET)\cite{paldus1972correlation},
as it can be intepreted as the perturbative variant of the many-electron-theory of 
Oktay Sinano\v{g}lu\cite{sinanoglu1964many}.

\section{The Cluster Operator}

Having established the form of the coupled cluster wavefunction as 
\begin{equation}
    \ket{\Psi} = e^{\hat{T}} \ket{\Phi_0},
\end{equation}
we now take a closer look at the cluster operator, which is divided into sub-operators 
\begin{equation}
    \hat{T} = \hat{T}_1 +  \hat{T}_2 + \hat{T}_2 + \hat{T}_3 + \dots,
\end{equation}
where the one-, two- and three-body operators are defined thusly,
\begin{align}
    \hat{T}_1 &= \sum_{ai}t^a_i\{\hat{a}^\dagger \hat{i} \} \\
    \hat{T}_2 &= \frac{1}{(2!)^2}\sum_{ijab} t^{ab}_{ij} 
        \{\hat{a}^\dagger \hat{i} \hat{b}^\dagger \hat{j} \} \\
    \hat{T}_3 &= \frac{1}{(3!)^2} \sum_{ijkabc} 
        \{\hat{a}^\dagger \hat{i} \hat{b}^\dagger \hat{j} \hat{c}^\dagger \hat{k} \},
\end{align}
where the coefficients $t^{abc\dots}_{ijk\dots}$ are commonly referred to as the 
coupled cluster \emph{amplitudes}, and are coefficients to be determined. The strings 
of operators are automatically normal-ordered. The general $m$-body cluster operator 
is given by 
\begin{equation}
    \hat{T}_m = \frac{1}{(m!)^2} \sum_{\substack{ij\dots \\ ab \dots}}
        t^{ab\dots}_{ij\dots} \{\hat{a}^\dagger \hat{i} \hat{b}^\dagger \hat{j} \dots\},
\end{equation}
which produces an $m$-fold excitation. It is not necessary to include cluster-operators
up to a infinite-fold excitation. Logically, the maximum excitation order is dictated by the number 
of electrons in the system $n$, such that $n \geq m$. Any higher-order excitation operator
would eventually annihilate an unoccupied orbital, resulting in a zero-contribution.
The prefactor $1/(m!)^2$ accounts for the redundancy created by unrestricted summations,
as a permutation of any of the $m$ hole or $m$ particle indices will not produce a 
distinct contributions. Indeed, we have for example that
\begin{equation}
    \hat{a}^\dagger \hat{i} \hat{b}^\dagger \hat{j} 
    = - \hat{a}^\dagger \hat{j} \hat{b}^\dagger \hat{i}
    = - \hat{b}^\dagger \hat{i} \hat{a}^\dagger \hat{j} 
    = \hat{b}^\dagger \hat{j} \hat{a}^\dagger \hat{j},
\end{equation}
and therefore we must also have that 
\begin{equation}
    t^{ab}_{ij} = - t^{ab}_{ji} = -t^{ba}_{ij} = t^{ba}_{ji}.
\end{equation}
Hence, the $(2!)^2 = 4$ contributions of two hole indices, $ab$, and two particle indices,
$ij$, will produce four equal terms, which is offset by the prefactor $1/4$.

The exponential wave operator $e^{\hat{T}}$ may be expanded as a Taylor series,
\begin{equation}
    e^{\hat{T}} = 1 + \hat{T} + \frac{1}{2!}\hat{T}^2
        + \frac{1}{3!}\hat{T}^3 + \dots.
\end{equation}
By including only single- and double excitations, 
$\hat{T}_{\text{CCSD}} = \hat{T}_1 + \hat{T}_2$,
this expressions becomes
\begin{equation}
    e^{\hat{T}_{\text{CCSD}}} = 
        1 + \hat{T}_1 + \hat{T}_2 
        + \frac{1}{2}\hat{T}_1^2 + \hat{T}_1\hat{T}_2 + \frac{1}{2} \hat{T}_2^2
        + \frac{1}{3!}\hat{T}_1^3 + \frac{1}{2}\hat{T}_1^2 \hat{T}_2
            + \frac{1}{2}\hat{T}_1\hat{T}_2^2 + \frac{1}{3!}\hat{T}_2^3 
        + \dots
\end{equation}
Contributions to the wave function containing only a single cluster operator, $\hat{T}_m$,
are called connected cluster contributions, while those containing products of cluster 
operators, $\hat{T}_{m_1}^{\alpha}\hat{T}_{m_2}^{\beta}$, are called disconnected
cluster contributions.

This inclusion of only sigle- and double excitations is called ``Coupled Cluster Singles 
Doubles'', elucidating the subscript CCSD\cite{purvis1982full}.
The most common approximation in coupled cluster theory is the CCSD model. Here, 
the operator $\hat{T}_2$ describes the important electron-pair interaction and the 
$\hat{T}_1$ operator carries out the orbital relaxations induced by the field set 
up by electron-pair interactions. 

\begin{tcolorbox}[title={Importance of different parts of the cluster operator}, 
    colback={white},
    colbacktitle={pink},
    coltitle={black}]
    The most important contribution to the wave-function in quantum chemistry is
    undoubtedlty $\hat{T}_2$, because 
    of the two-electron nature of the Hamiltonian. It describes the most important 
    interaction of quantum chemistry, the electron-pair interaction. The inclusion 
    of $\hat{T}_1$ and its products are relatively insensitive to the choice of 
    basis set, as the operators $e^{\hat{T}_1}$ has the effect of transforming 
    thereference state $\ket{\Phi_0}$ to another Slater determinant. This is known 
    as Thouless theorem\cite{thouless1960stability}. With very high electron-density,
    the three-particle operator $\hat{T}_3$ becomes important. Higher-order terms 
    are usually of less and decreasing importance, but they can be of concern in 
    special situations. For instance, the four-particle operator $\hat{T}_4$ is 
    very important in nuclear physics. See for instance Helgaker et 
    ali\cite{helgaker2014molecular} or 
    Shavitt \& Bartlett\cite{shavitt2009many} for further discussion on this topic.
\end{tcolorbox}


\section{Coupled-Cluster Doubles (CCD)}

As a good starting point for understanding the coupled cluster scheme and especially
where the coupled-cluster equations come from, we now constrain the cluster
operator to
\begin{equation}
    \hat{T}_{\text{CCD}} = \hat{T}_2,
\end{equation}
and completely derive the coupled cluster equations for this case.
The CCD wave function includes all connected and disconnected clusters involving
$\hat{T}_2$ only,
\begin{equation}
    \Psi_{\text{CCD}} = e^{\hat{T}_2} = \Phi_0 + \hat{T}_2\Phi_0 + \frac{1}{2}\hat{T}_2^2\Phi_0 
        + \frac{1}{3!}\hat{T}_2^3\Phi_0 + \dots
\end{equation}

There are several methods with which to arrive at the coupled-cluster equations
and here we employ two 
of them for the coupled cluster doubles truncation. First, we use
configuration-interaction techniques and the Slater-Condon rules 
(\autoref{app:slater_condon}) and second, we use the ``algebraic method'',
employing second quantisation and Wick's theorem. A third way is with the aid of
diagrams. A brief note on such diagrams can be found in \autoref{app:diagrams}.

\subsection{Configuration space derivation}

We start from the CCD-constrained time-independent Schrödinger equation,
\begin{equation}
    \hat{H}\Psi_{\text{CCD}} = E_{\text{CCD}} \Psi_{\text{CCD}},
\end{equation}
which we left project with the reference state,
\begin{gather*}
    \bra{\Phi_0} \hat{H} \ket{\Psi_{\text{CCD}}} = \bra{\Phi_0} E_{\text{CCD}} \ket{\Psi_{\text{CCD}}} \nonumber \\
    \to E_{\text{CCD}} = \bra{\Phi_0} \hat{H} \ket{\Psi_{\text{CCD}}},
\end{gather*}
where we have taken advandage of the intermediate normalisation, 
$\braket{\Phi_0}{\Psi_{\text{CCD}}} = 1$. We then insert the exponential expansion
from the coupled cluster ansatz,
\begin{equation}
    \label{eq:ccd_energy}
    \begin{aligned}
    E_{\text{CCD}} &= \bra{\Phi_0} \hat{H} (1 + \hat{T}_2)\ket{\Phi_0} \\
        &= E_{\text{ref}} 
        + \sum_{\substack{i>j \\ a>b}} \bra{\Phi_0} \hat{H} \ket{\Phi_{ij}^{ab}}t^{ab}_{ij} \\
        &= E_{\text{ref}}
        + \sum_{\substack{i>j \\ a>b}} \bra{ij}  \ket{ab}t^{ab}_{ij}.
    \end{aligned}
\end{equation}
The energy expression will truncate here because no higher order terms will contribute.
It is common to substract $E_{\text{ref}}$ to get,
\begin{equation}
    \hat{H}_N \Psi_{\text{CCD}} = \Delta E_{\text{CCD}} \Psi_{\text{CCD}},
\end{equation}
where $\hat{H}_N = \hat{H} - E_{\text{ref}}$. Now follows a bunch of expressions
intended to show the correspondence between coupled cluster- and perturbation theory,
\begin{equation}
    \hat{H}_N = \hat{F} - \hat{U} + \hat{H}_2 - E_{\text{ref}}
        = \hat{H}_0 + \hat{F}^0 - \hat{U} + \hat{H}_2 - E_{\text{ref}},
\end{equation}
where,
\begin{gather}
    \hat{H}_0 = \hat{F}^d = \sum_\mu \hat{f}_\mu^d, 
        \quad \bra{p} \hat{f}_\mu^d \ket{q} = \epsilon_p \delta_{pq} \\
    \hat{F}^0 = \sum_\mu \hat{f}^0_\mu,
        \quad \bra{p} \hat{f}^0 \ket{q} = (1 - \delta_{pq})\bra{p} \hat{f} \ket{q} \\
    \hat{U} = \sum_\mu \hat{u}_\mu, 
        \quad \bra{p} \hat{u}_\mu \ket{q} = \sum_i \bra{pi} \ket{qi} \\
    \hat{H}_2 = \sum_{\mu > \nu} \frac{1}{r_{\mu\nu}},
        \quad E_{\text{ref}} = E_0 + E^{(1)}, \\
    E_0  = \sum_i \epsilon_i, \quad E^{(1)} = - \frac{1}{2} \sum_{ij} \bra{ij} \ket{ij}.
\end{gather}
In the canonical HF case we have $\hat{F}^0 = 0$ and $\hat{F}^d = \hat{F}$.

In order to compute the energy of the system we need the amplitudes $t^{ab}_{ij}$.
Starting from the modified Schrödinger equation,
\begin{equation}
    \hat{H}_N \Psi_{\text{CCD}} = \Delta E_{\text{CCD}} \Psi_{\text{CCD}}.
\end{equation}
We left project with a doubly-excited Slater determinant, and insert for the CC ansatz,
\begin{gather}
    \bra{\Phi^{ab}_{ij}} \hat{H}_N e^{\hat{T}_2} \ket{\Phi_0} 
        = \Delta E_{\text{CCD}} \bra{\Phi^{ab}_{ij}} e^{\hat{T}_2} \ket{\Phi_0} \\
    \bra{\Phi^{ab}_{ij}} 
        \hat{H}_N \left(1 + \hat{T}_2 + \frac{1}{2}\hat{T}^2_2\right) \ket{\Phi_0}
        = \Delta E_{\text{CCD}} t^{ab}_{ij}. \label{eq:ccd_amplitude}
\end{gather}
Here we have only expanded the exponential function up to the quadratic term. The next
term in the series will triple-excite the bra Slater determinant, which will give a
zero-contribution according to the Slater-Condon rules, because of two noncoincidences. Next we apply the Slater-Condon rules to the rest of the terms on the right-hand side, starting with just the normal-ordered Hamiltonian,
\begin{equation}
    \bra{\phi^{ab}_{ij}} \hat{H}_N \ket{\Phi_0} = \bra{ab} \ket{ij},
\end{equation}
where only $\hat{H}_2$ contributes.

Next we look at the linear term,
\begin{equation}
    \begin{aligned}
    \bra{\Phi^{ab}_{ij}} &\hat{H}_N \hat{T}_2 \ket{\Phi_0} 
        = \sum_{klcd} \bra{\phi^{ab}_{ij}} \hat{H}_N \ket{\phi^{cd}_{kl}} \\
    &= \bra{\Phi^{ab}_{ij}} \hat{H}_0 - E_{\text{ref}} \ket{\Phi^{ab}_{ij}}t^{ab}_{ij}
        + \sum_{\substack{k>l \\ c>d}} 
            \bra{\Phi^{ab}_{ij}} \hat{F}^0 - \hat{U} \ket{\Phi^{cd}_{kl}} t^{cd}_{kl} \\
    &\quad + \sum_{\substack{k>l \\ c>l}} 
        \bra{\Phi^{ab}_{ij}} \hat{H}_2 \ket{\Phi^{cd}_{kl}} t^{cd}_{kl} 
        = L_0 + L_1 + L_2.
    \end{aligned}
\end{equation}
We are going to evaluate these terms one-by-one, starting with $L_0$,
\begin{equation}
    \begin{aligned}
        L_0 &= \bra{\Phi^{ab}_{ij}} \hat{H}_0 - E_{\text{ref}}\ket{\Phi^{ab}_{ij}}
            = \bra{\Phi^{ab}_{ij}} \hat{H}_0 - E_0 - E^{(1)}\ket{\Phi^{ab}_{ij}} \\
            &= \left(-\varepsilon^{ab}_{ij} + \frac{1}{2}\sum_{kl}\bra{kl} \ket{kl}\right) t^{ab}_{ij}.,
    \end{aligned}
\end{equation}
where $\varepsilon^{ab}_{ij} = \varepsilon_i + \varepsilon_j - \varepsilon_a - \varepsilon_b$.

The next term,
\begin{equation}
    L_1 = \sum_{\substack{k>l \\ c>d}} 
            \bra{\Phi^{ab}_{ij}} \hat{F}^0 - \hat{U} \ket{\Phi^{cd}_{kl}} t^{cd}_{kl},
\end{equation}
yields contributions if at least three of the indices $k$, $l$, $c$, $d$ are equal to 
the indices $i$, $j$, $a$, $b$ (we want one or zero noncoincidences). All the possible
terms are,
\begin{equation}
L_1 = \begin{cases}
\begin{aligned}
     - \sum_k u_{kk} t^{ab}_{ij} &\quad \text{all indices equal} \\
     - \sum_k(f^0_{jk} - u_{jk}) t^{ab}_{ik} &\quad \text{one hole index unequal} \\
     + \sum_k(f^0_{ik} - u_{ik}) t^{ab}_{jk} &\quad \text{the other hole index unequal} \\
     - \sum_c(f^0_{ac} - u_{ac}) t^{bc}_{ij} &\quad \text{one particle index unequal} \\
     + \sum_c(f^0_{bc} - u_{bc}) t^{zc}_{ij} &\quad \text{the other particle index unequal}.
\end{aligned}
\end{cases}
\end{equation}

For the last linear term,
\begin{equation}
    L_2 = \sum_{\substack{k>l \\ c>d}}\bra{\Phi^{ab}_{ij}} \hat{H}_2 \ket{\Phi^{cd}_{kl}} t^{cd}_{kl},
\end{equation}
we require that at least two of the indices $k$, $l$, $c$, $d$ are equal to the indices $i$, $j$, $a$, $b$,
as we can do with at most two noncoincidences in the bra and the ket. For equality in
both the hole indices or both the particle indices we have
\begin{align}
    cd = ab \quad &\to \quad \sum_{k>l}\bra{ij}\ket{kl} t^{ab}_{kl} \\ 
    kl = ij \quad &\to \quad \sum_{c>d}\bra{ab}\ket{cd} t^{cd}_{ij}.
\end{align}
For one equality in both hole and particle index we have
\begin{equation}
    -\sum_{kl}\big(\bra{bk}\ket{cj} t^{ac}_{ik} - \bra{bk}\ket{ci} t^{ac}_{jk}  
                -\bra{ak}\ket{cj} t^{bc}_{ik} - \bra{bk}\ket{ci}  t^{ac}_{jk} \big),
\end{equation}
where the sign stems from the maximum coincidence permutations as dictated by the
Slater-Condon rules. Most of the three- and four euqal index terms are accounted
for by the expression above, the remaining three-index equality terms are
\begin{align}
    -\sum_{kl}\big( \bra{jl}\ket{kl} t^{ab}_{ik} - \bra{il}\ket{kl} t^{ab}_{jk} \big) \\
    +\sum_{cl}\big( \bra{bl}\ket{cl} t^{ac}_{ij} - \bra{al}\ket{cl} t^{bc}_{ij} \big),
\end{align}
and there is one term for the case where all indices are equal,
\begin{equation}
    \sum_{k>l} \bra{kl} \ket{kl} t^{ab}_{ij} = \frac{1}{2} \sum_{kl} \bra{kl} \ket{kl} t^{ab}_{ij}.
\end{equation}

These last three- and four-index equality terms are expressible in terms of $\hat{u}$,
and will cancel the first term in $L_1$ together with the $\hat{u}$ term from $L_0$.
All terms so far are the same as in a CID computation. The difference between CCD and
CID as the following extra quadratic terms,
\begin{equation}
    Q = \frac{1}{2}\bra{\Phi^{ab}_{ij}} \hat{H}_N \hat{T}_2^2\ket{\Phi_0}
        = \frac{1}{2} \sum_{\substack{k>l \\ c>d}} \sum_{\substack{m>n \\ e>f}}
            \bra{\phi^{ab}_{ij}} \hat{H}_N \ket{\Phi^{cdef}_{klmn}}t^{cd}_{kl}t^{ef}_{mn}.
\end{equation}
From this expression we will have a contrition only when four of the indices $k$, $l$,
$m$, $n$, $c$, $d$, $e$, $f$ are equal to $i$, $j$, $a$, $b$, and only $\hat{H}_2$
can contribute. After some algebraic acrobatics we'll find that this becomes
\begin{equation}
    \label{eq:quad_term}
    \begin{aligned}
        Q = \sum_{\substack{k>l \\ c>d}} \bra{kl} \ket{cd}\big[
                &(t^{ab}_{ij}t^{cd}_{kl} + t^{cd}_{ij}t^{ab}_{kl}) 
            -2   (t^{ac}_{ik}t^{cd}_{jl} + t^{bd}_{ij}t^{bd}_{ij}) \\
            -2  &(t^{ab}_{ik}t^{cd}_{jl} + t^{cd}_{ik}t^{ab}_{jl}) 
            +4   (t^{ac}_{ik}t^{bd}_{jl} + t^{bd}_{ik}t^{ac}_{jl})
            \big].
    \end{aligned}
\end{equation}
From \autoref{eq:ccd_energy} we see that
\begin{equation}
    \label{eq:ccd_energy2}
    \Delta E_{\text{CCD}} = \sum_{\substack{i>j \\ a>b}} \bra{ij} \ket{ab} t^{ab}_{ij},
\end{equation}
and because the indices in \autoref{eq:quad_term} are dummy variables we see that
the first term here cancels with the right-hand side of \autoref{eq:ccd_amplitude}.
Some algebraic massage after the initial acrobatic exercises leads to,
\begin{equation}
    \begin{aligned}
    \varepsilon^{ab}_{ij}t^{ab}_{ij}
        &= \bra{ab}\ket{ij} + \frac{1}{2}\sum_{cd} \bra{ab}\ket{cd}t^{cd}_{ij}
            + \frac{1}{2}\sum_{kl} \bra{ij} \ket{kl} t^{ab}_{kl} \\
        &\ -\sum_{kl}\big(
             \bra{bk}\ket{cj}t^{ac}_{ik} 
            -\bra{bk}\ket{ci}t^{ac}_{jk}
            -\bra{ak}\ket{cj}t^{bc}_{ik}
            +\bra{ak}\ket{ci}t^{bc}_{jk}
            \big) \\
        &\ -\sum_k \hat{f}^0_{jk} t^{ab}_{ik}
            +\sum_k \hat{f}^0_{ik} t^{ab}_{jk}
            +\sum_c \hat{f}^0_{bc} t^{ac}_{ij}
            -\sum_c \hat{f}^0_{ac} t^{bc}_{ij} \\
        &\ +\sum_{klcd} \bra{kl} \ket{cd} \Big[
            \frac{1}{4}t^{cd}_{ij}t^{ab}_{kl}
            -\frac{1}{2}(t^{ac}_{ij}t^{bd}_{kl} + t^{bd}_{ij}t^{ac}_{kl}) \\
        &\quad\quad -\frac{1}{2}(t^{ab}_{ik}t^{cd}_{jl} + t^{cd}_{ik}t^{ab}_{jl})
            +(t^{ac}_{ik}t^{bd}_{jl} + t^{bd}_{ik}t^{ac}_{jl})
            \Big],
    \end{aligned}
\end{equation}
which is the CCD amplitude equations. This equation contains simultaneous algebraic 
expressions, contrary to CI. The equations must be solved iteratively, substituting 
$t^{ab}_{ij}$ obtained in each iteration, into the quadratic terms for the next 
iteration.

\subsection{Algebraic Derivation}

In this derivation we make great use of second quantisation formalism and Wick's 
theorem. We start with the normal-ordered Hamiltionian,
\begin{equation}
    \begin{aligned}
    \hat{H}_N &= (\hat{H}_0)_N + \hat{F}^0_N  + \hat{W} \\
        &= \sum_p \varepsilon_p \{ \hat{p}^\dagger \hat{p} \}
            + \sum_{p\neq q} f_{pq} \{ \hat{p}^\dagger \hat{q} \}
            + \frac{1}{4} \sum_{pqrs} \bra{pq} \ket{rs} \{\hat{p}^\dagger\hat{q}^\dagger\hat{s}\hat{r}\}.
    \end{aligned}
\end{equation}
The one-particle terms $(\hat{H}_0)_N$ and $\hat{F}^0_N$ can be combined by setting
$\varepsilon_{p} = f_{pp}$, reducing the normal-ordered Hamilionian to
\begin{equation}
    \begin{aligned}
    \hat{H}_N &= \hat{F}_N  + \hat{W} \\
        &= \sum_{pq} f_{pq} \{ \hat{p}^\dagger \hat{q} \}
            + \frac{1}{4} \sum_{pqrs} \bra{pq} \ket{rs} \{\hat{p}^\dagger\hat{q}^\dagger\hat{s}\hat{r}\}.
    \end{aligned}
\end{equation}

First we want to find an expression for the energy,
\begin{equation}
    \Delta E_{\text{CCD}} = \bra{0}\hat{H}_N (1 + \hat{T}^2) \ket{0}
        = \bra{0} \hat{H}_N \hat{T}_2 \ket{0},
\end{equation}
where only the vacuum expectation value of the product of the Hamiltonian and the 
doubles cluster operators gives a contributions, because the vacuum expectation value
of just the Hamiltonian is zero. Inserting for the operators,
\begin{equation}
    \Delta E_{\text{CCD}} 
        = \sum_{\substack{i>j \\ a>b}}\bra{0}\left[ 
        \sum_{pq} f_{pq} \{\hat{p}^\dagger \hat{q}\}
        + \frac{1}{4}\sum_{pqrs}\bra{pq} \ket{rs} \{\hat{p}^\dagger\hat{q}^\dagger\hat{s}\hat{r}\}
        \right] 
        \{\hat{a}^\dagger\hat{b}^\dagger\hat{j}\hat{i} \}
        \ket{0}t^{ab}_{ij}.
\end{equation}
Here the one-particle part will vanish as there is no manner one can contract all the
operators in this term without using an internal contraction in the normal-ordered
product. It is also useful to convert the first sum to an unrestricted sum,
\begin{equation}
    \Delta E_{\text{CCD}}
        = \frac{1}{16}\sum_{ijab}\sum_{pqrs}\bra{pq} \ket{rs} 
           \bra{0} 
           \{\hat{p}^\dagger\hat{q}^\dagger\hat{s}\hat{r}\} 
           \{\hat{a}^\dagger\hat{b}^\dagger\hat{j}\hat{i} \}
           \ket{0} t^{ab}_{ij}.
\end{equation}
We contract the operators in the normal-ordered products,
\begin{gather}
    \begin{aligned}
         \bra{0}
            &\wick{
            \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}} \} 
            \{\c1{\hat{a}}^\dagger \c2{\hat{b}}^\dagger \c3{\hat{j}} \c4{\hat{i}} \} 
            }
            +
            \wick{
            \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}} \} 
            \{\c2{\hat{a}}^\dagger \c1{\hat{b}}^\dagger \c3{\hat{j}} \c4{\hat{i}} \}
            } \\
            +
            &\wick{
            \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}} \} 
            \{\c1{\hat{a}}^\dagger \c2{\hat{b}}^\dagger \c4{\hat{j}} \c3{\hat{i}} \}
            }
            +
            \wick{
            \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}} \} 
            \{\c2{\hat{a}}^\dagger \c1{\hat{b}}^\dagger \c4{\hat{j}} \c3{\hat{i}} \}
            }
         \ket{0}
    \end{aligned} \\
    \begin{aligned}
        = &\delta_{pi}\delta_{qj}\delta_{sb}\delta_{ra} 
        - \delta_{pi}\delta_{qj}\delta_{sa}\delta_{rb} \\
        - &\delta_{pj}\delta_{qi}\delta_{sb}\delta_{ra} 
        + \delta_{pj}\delta_{qi}\delta_{sa}\delta_{rn}. 
    \end{aligned} 
\end{gather}
All these products of delta functions give us a reduction in the sums and the CCD
energy becomes,
\begin{equation}
    \Delta E_{\text{CCD}} = \frac{1}{4}\sum_{ijab}\bra{ij} \ket{ab} t^{ab}_{ij}.
\end{equation}

The natural next step is to find the amplitude equations,
\begin{equation}
    \bra{\Phi^{ab}_{ij}}\hat{H}_N\left(1 + \hat{T}_2 + \frac{1}{2}\hat{T}^2\right) \ket{0}
        = \Delta E_{\text{CCD}} t^{ab}_{ij}.
\end{equation}
We compute this expression in steps, starting with the lone normal-ordred Hamiltonian,
\begin{equation}
    \bra{\Phi^{ab}_{ij}} \hat{H}_N \ket{0}
        = \frac{1}{4}\sum_{pqrs} \bra{0}
        \{\hat{a}\hat{b}\hat{j}^\dagger\hat{i}^\dagger\}
        \{\hat{p}^\dagger\hat{q}^\dagger\hat{s}\hat{r}\}
        \ket{0}\bra{pq} \ket{rs},
\end{equation}
here we also have to compute a few contractions,
\begin{gather}
    \begin{aligned}
        \bra{0}
        &\wick{
        \{ \c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}}\}
        \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c3{\hat{s}} \c4{\hat{r}} \}
        }
        +\wick{
        \{ \c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}}\}
        \{ \c2{\hat{p}}^\dagger \c1{\hat{q}}^\dagger \c3{\hat{s}} \c4{\hat{r}} \}
        } \\
        +&\wick{
        \{ \c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}}\}
        \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
        }
        +\wick{
        \{ \c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}}\}
        \{ \c2{\hat{p}}^\dagger \c1{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
        }
        \ket{0}
    \end{aligned} \\
    \begin{aligned}
        =&\delta_{ir}\delta_{js}\delta_{bq}\delta_{ap} 
        -\delta_{ir}\delta_{js}\delta_{bp}\delta_{aq}\\
        -&\delta_{is}\delta_{jr}\delta_{bq}\delta_{ap}
        +\delta_{is}\delta_{jr}\delta_{bp}\delta_{aq}.
    \end{aligned} 
\end{gather}
This will leave us with a similar expression as the one in the energy equation,
\begin{equation}
    \bra{\Phi^{ab}_{ij}} \hat{H}_N \ket{0} = \bra{ab} \ket{ij}.
\end{equation}

Now for the linear terms,
\begin{equation}
    \begin{aligned}
         \bra{\phi^{ab}_{ij}} \hat{H}_N \hat{T}_2 \ket{0} 
            = &\sum_{\substack{k>l \\ c>d}} \bra{\phi^{an}_{ij}} \hat{H}_n 
                \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \} \ket{0}t^{cd}_{kl} \\
            = \frac{1}{4} &\sum_{klcd} \bra{\Phi^{ab}_{ij}} \hat{F}_N + \hat{W}\ket{\Phi^{cd}_{kl}}t^{cd}_{kl}
    \end{aligned}
\end{equation}
Starting with the first term,
\begin{equation}
    \begin{aligned}
         L_1 &= \frac{1}{4}\sum_{klcd} \bra{\phi^{ab}_{ij}} \hat{F}_N \ket{\phi^{cd}_{kl}} t^{cd}_{kl} \\
            &= \frac{1}{4}\sum_{klcd} \sum{pq} f_{pq} \bra{\phi^{ab}_{ij}}
                \{ \hat{p}^\dagger \hat{q}\} \ket{\phi^{cd}_{kl}} t^{cd}_{kl} \\
            &= \frac{1}{4} \sum_{klcd}\sum_{pq} f_{pq} \bra{0}
                \{\hat{i}^\dagger \hat{j}^\dagger \hat{b} \hat{a} \}
                \{\hat{p}^\dagger \hat{q}\} 
                \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \}
            \ket{0} t^{cd}_{kl}
    \end{aligned}
\end{equation}
The product of normal-ordered operators must be contracted in such a way that tree and
three operators in the first and last operators string are contracted with one another,
and the two operators in the middle string is contracted with one operator in the last
and first one. This provides us with $3\times 3 \times 2 = 16$ possible contractions.
Here are the first four contractions,
\begin{gather}
    \begin{aligned}
        &\wick{
        \{\c5{\hat{i}}^\dagger \c4{\hat{j}}^\dagger \c3{\hat{b}} \c1{\hat{a}} \}
        \{\c1{\hat{p}}^\dagger \c2{\hat{q}}\} 
        \{\c2{\hat{c}}^\dagger \c3{\hat{d}}^\dagger \c4{\hat{l}} \c5{\hat{k}} \} 
        } + 
        \wick{
        \{\c5{\hat{i}}^\dagger \c4{\hat{j}}^\dagger \c1{\hat{b}} \c3{\hat{a}} \}
        \{\c1{\hat{p}}^\dagger \c2{\hat{q}}\} 
        \{\c3{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \c4{\hat{l}} \c5{\hat{k}} \} 
        } \\ +
        &\wick{
        \{\c5{\hat{i}}^\dagger \c4{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}} \}
        \{\c3{\hat{p}}^\dagger \c4{\hat{q}}\} 
        \{\c1{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \c3{\hat{l}} \c5{\hat{k}} \} 
        } +
        \wick{
        \{\c5{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}} \}
        \{\c4{\hat{p}}^\dagger \c5{\hat{q}}\} 
        \{\c1{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \c3{\hat{l}} \c4{\hat{k}} \} 
        }
    \end{aligned} \\
    \begin{aligned}
         =&\delta_{ik}\delta_{jl}\delta_{bd}\delta_{ap}\delta_{cq}
         +\delta_{ik}\delta_{jl}\delta_{ac}\delta_{bp}\delta_{dq} \\
         -&\delta_{ik}\delta_{jq}\delta_{bd}\delta_{ac}\delta_{pl}
         -\delta_{iq}\delta_{pk}\delta_{jl}\delta_{bd}\delta_{ac}.
    \end{aligned}
\end{gather}
The last 12 contractions will be equivalent to these four, and thus we rid ourselves
of the $\frac{1}{4}$-prefactor, yielding
\begin{equation}
    L_1 = \sum_c(f_{bc} t^{ac}_{ij} - f_{ac} t^{bc}_{ij}) + \sum_k (f_{ik} t^{ab}_{jk} - f_{jk} t^{ab}_{ik}).
\end{equation}

Proceeding to the second linear term,
\begin{equation}
    \begin{aligned}
    L_2 &= \frac{1}{4}\sum_{klcd} \bra{\Phi^{ab}_{ij}} \hat{W} \ket{\Phi^{cd}_{kl}} t^{cd}_{kl} \\
        &= \frac{1}{16}\sum_{pqrs} \sum_{klcd} \bra{pq} \ket{rs} \bra{0}
            \{\hat{j}^\dagger \hat{b} \hat{i}^\dagger  \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{d}^\dagger \hat{k} \hat{l} \}
        \ket{0}t^{cd}_{kl}
    \end{aligned}
\end{equation}
Here there are many possible ways to contract the operators string, so it is convenient
to label the different kinds of contractions. Subscript $a$-term consist of two
hole-hole contractions, subscript $b$-terms consist of two particle-particle
contractions and subscript $c$-terms consist of one particle-hole and one
hole-particle contractions,
\begin{align}
    &\begin{aligned}
        L_{2a}
        &= \frac{1}{8}\sum_{pqrs} \sum_{klcd} \bra{pq} \ket{rs} \bra{0}
            \wick{
            \{\c2{\hat{i}}^\dagger \c1{\hat{j}}^\dagger \hat{b} \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{d}^\dagger \c1{\hat{k}} \c2{\hat{l}} \}
            }
            \ket{0}t^{cd}_{kl} \\
        &= \frac{1}{8}\sum_{pqrs} \sum_{cd} \bra{pq} \ket{rs} \bra{0}
            \{ \hat{b} \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{ \hat{c}^\dagger \hat{d}^\dagger \}
            \ket{0}t^{cd}_{kl}
    \end{aligned} \\
    &\begin{aligned}
        L_{2b}
        &= \frac{1}{8}\sum_{pqrs} \sum_{klcd} \bra{pq} \ket{rs} \bra{0}
            \wick{
            \{\hat{i}^\dagger \hat{j}^\dagger \c2{\hat{b}} \c1{\hat{a}} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\c1{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \hat{l} \hat{k} \}
            }
            \ket{0}t^{cd}_{kl} \\
        &= \frac{1}{8}\sum_{pqrs} \sum_{kl} \bra{pq} \ket{rs} \bra{0}
            \{\hat{i}^\dagger \hat{j}^\dagger \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{l} \hat{k} \}
            \ket{0}t^{cd}_{kl}
    \end{aligned} \\
    &\begin{aligned}
        L_{2c}
            = \frac{1}{4}\sum_{pqrs} \sum_{klcd} \bra{pq} \ket{rs} \bra{0}
            &\wick{
            \{\c2{\hat{i}}^\dagger \hat{j}^\dagger \c1{\hat{b}} \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \c1{\hat{d}^\dagger} \c2{\hat{l}} \hat{k} \}
            } \\
            +
            &\wick{
            \{\hat{i}^\dagger \c2{\hat{j}}^\dagger \c1{\hat{b}} \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \c1{\hat{d}^\dagger} \c2{\hat{l}} \hat{k} \}
            } \\
            +
            &\wick{
            \{\c2{\hat{i}}^\dagger \hat{j}^\dagger \hat{b} \c1{\hat{a}} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \c1{\hat{d}^\dagger} \c2{\hat{l}} \hat{k} \}
            } \\
            +
            &\wick{
            \{\hat{i}^\dagger \c2{\hat{j}}^\dagger \hat{b} \c1{\hat{a}} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \c1{\hat{d}^\dagger} \c2{\hat{l}} \hat{k} \}
            }
            \ket{0}t^{cd}_{kl} \\
        = \frac{1}{4} \sum_{pqrs} \sum_{kc} \bra{pq} \ket{rs} \bra{0}
            &\{\hat{i}^\dagger \hat{a}\}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{k} \} 
            \\ -
            &\{\hat{j}^\dagger \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{k} \} 
            \\ -
            &\{\hat{i}^\dagger \hat{b} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{k} \} 
            \\ +
            &\{\hat{j}^\dagger \hat{b} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{k} \} 
        \ket{0}.
    \end{aligned}
\end{align}
The vacuum expectation value in $L_{2a}$ can be evaluated as,
\begin{gather}
    \begin{aligned}
        \bra{0}
            &\wick{
            \{ \c2{\hat{b}} \c1{\hat{a}} \}
            \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
            \{ \c3{\hat{c}}^\dagger \c4{\hat{d}}^\dagger \}
            } +
            \wick{
            \{ \c2{\hat{b}} \c1{\hat{a}} \}
            \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
            \{ \c4{\hat{c}}^\dagger \c3{\hat{d}}^\dagger \}
            } \\ +
            &\wick{
            \{ \c1{\hat{b}} \c2{\hat{a}} \}
            \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
            \{ \c3{\hat{c}}^\dagger \c4{\hat{d}}^\dagger \}
            } +
            \wick{
            \{ \c1{\hat{b}} \c2{\hat{a}} \}
            \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
            \{ \c4{\hat{c}}^\dagger \c3{\hat{d}}^\dagger \}
            }
            \ket{0}
    \end{aligned} \\
    \begin{aligned}
         =&\delta_{bq}\delta_{ap}\delta_{sd}\delta_{rc}
          -\delta_{bq}\delta_{ap}\delta_{sc}\delta_{rd} \\
         -&\delta_{aq}\delta_{bp}\delta_{sd}\delta_{rc}
         + \delta_{aq}\delta_{bp}\delta_{sc}\delta_{rd}
    \end{aligned}
\end{gather}
Inserting this result into the original expression and substituting to similar indicies
will yield,
\begin{equation}
    L_{2a} = \frac{1}{2} \sum_{cd}\bra{ab} \ket{cd} t^{cd}_{ij}.
\end{equation}
A very similar computation will yield the following result for the next linear term,
\begin{equation}
    L_{2b} = \frac{1}{2} \sum_{kl} \bra{kl} \ket{ij} t^{ab}_{kl}.
\end{equation}
The last linear term is very different, however. INSERT SOMETHING HERE!

After long last, we have only the quadratic term to deal with,
\begin{equation}
    Q = \frac{1}{8}\sum_{pqrs}\sum_{\substack{k>l \\ c>d}} \sum_{\substack{m>n \\ e>f}}
        \bra{pq} \ket{rs} \bra{0}
            \{\hat{i}^\dagger \hat{j}^\dagger \hat{b} \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \}
            \{\hat{e}^\dagger \hat{f}^\dagger \hat{n} \hat{m} \}
        \ket{0} t^{dc}_{kl} t^{ef}_{mn}.
\end{equation}
In this expression there are no non-zero contractions between the third and 
fourth normal ordered operator string. We therefore need to contract operators 
in the first normal-ordered string with operators either in the third or four 
string, and the operator in the second string with the rest. 

We start by contracting all operators in the first normal-ordered string 
with all the operators in the fourth normal-ordered string,

\begin{equation}
    \begin{gathered}
    \frac{1}{8}\sum_{pqrs}\sum_{\substack{k>l \\ c>d}} \sum_{\substack{m>n \\ e>f}}
    \bra{pq} \ket{rs} \bra{0}
      \wick{ 
            \{\c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \}
            \{\c1{\hat{e}}^\dagger \c2{\hat{f}}^\dagger \c3{\hat{n}} \c4{\hat{m}} \}
        \ket{0} t^{cd}_{kl} t^{ef}_{mn}
        } \\
    =
    \frac{1}{8}\sum_{pqrs}\sum_{\substack{k>l \\ c>d}}
    \bra{pq} \ket{rs} \bra{0}
        \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
        \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \}
    \ket{0} t^{cd}_{kl} t^{ab}_{ij}.
    \end{gathered}
\end{equation}
There are four possible ways to contract this last term, resulting in
\begin{equation}
    \frac{1}{2}\sum_{\substack {k>l \\ c >d }}
        \bra{kl} \ket{cd} t^{cd}_{kl} t^{ab}_{ij}.
\end{equation}
We get the same result by contracting the four operators in the first 
string with the four operators in the third string, cancelling the
factor $\frac{1}{2}$, eventually yielding a result equal to
$\Delta E_{\text{CCD}} t^{ab}_{ij}$, which we see by 
comparing this result to \autoref{eq:ccd_energy2}.

There are four remaining reasonable classes in which to sort the
permutations of contractions that remain;
\begin{itemize}
    \item[a] the two hole operators in the first string are
    contracted with the third or fourth operator string, yielding 
    equal results;
    \item[b] one hole and one particle operators in the first string
    are contracted with operators in the third string, the rest of
    the operators in the first string are contracted with operators 
    in the fourth string;
    \item[c] two particle operators and one hole operator from the 
    first string are contracted with operators in the third string,
    the last hole operator is contracted with an operator in the 
    fourth string;
   \item[d] one particle operator and two hole operators are contracted 
    with operators in the third string and the last particle operator 
    with an operator in the fourth string.
\end{itemize}
The results for class a and class b are somewhat straight-forward to 
compute, giving the following,
\begin{align}
    &\begin{gathered}
        Q_a = \frac{1}{16}\sum_{pqrs}\sum_{klcd} 
        \bra{pq} \ket{rs}\bra{0}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{l} \hat{k} \}
            \{\hat{c}^\dagger \hat{d}^\dagger \}
        \ket{0} t^{cd}_{ij} t^{ab}_{kl} \\
        = \frac{1}{4} \sum_{klcd}
        \bra{kl} \ket{rs} t^{cd}_{ij} t^{ab}_{kl}
    \end{gathered} \\
    &\begin{gathered}
        Q_b = \frac{1}{4}\sum_{pqrs} \sum_{klcd}
        \bra{pq} \ket{rs} \bra{0}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{k} \}
            \{\hat{d}^\dagger \hat{l} \}
            \ket{0}
            (t^{ac}_{ik}t^{bd}_{jl} - t^{bc}_{ik}t^{ad}_{jl}) \\
        = \sum_{klcd} \bra{kl} \ket{cd}
            (t^{ac}_{ik}t^{bd}_{jl} - t^{bc}_{ik}t^{ad}_{jl})
        = \sum_{klcd} \bra{kl} \ket{cd}
            (t^{ac}_{ik}t^{bd}_{jl} - t^{bd}_{ik}t^{ac}_{jl})
    \end{gathered}
\end{align}

The sets of terms for class c and d can each be generated in two distinct
ways, dependent on the choice of the tree operators from the first operator
string ($\hat{i}^\dagger \hat{a} \hat{b}$ or 
$\hat{j}^\dagger \hat{a} \hat{b}$ for c and 
$\hat{i}^\dagger \hat{j}^\dagger \hat{a}$ or 
$\hat{i}^\dagger \hat{j}^\dagger \hat{b}$ for d). In each case there 
are 16 possibilities; the three operators from the first string can be 
contracted with operators in both the third or fourth string in four ways and
the remainding operators can be then be contracted in two ways. All these 
possibilities lead to equivalent results. For example, here is the first 
$Q_c$ term,
\begin{equation}
    \begin{gathered}
    \frac{1}{8} \sum_{pqrs} \sum_{klcd} \sum_{mnef}
    \bra{pq} \ket{rs} \bra{0}
        \wick{
        \{\c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}} \}
        \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \} 
        \{\hat{c}^\dagger \hat{d}^\dagger \c3{\hat{l}} \hat{k} \}
        \{\c1{\hat{e}}^\dagger \c2{\hat{f}}^\dagger \c4{\hat{n}} \hat{m} \}
        }
    \ket{0} t^{cd}_{kl} t^{ef}_{mn} \\
    = - \frac{1}{8} \sum_{pqrs} \sum_{klcd}
    \bra{pq} \ket{rs} \bra{0} 
        \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
        \{\hat{c}^\dagger \hat{d}^\dagger \hat{k} \}
        \{\hat{l} \}
    \ket{0} t^{cd}_{kj} t^{ab}_{li}
    \ket{0}
    \end{gathered}
\end{equation}
The remainding operators in this expression can be contracted in four ways,
\begin{align}
    \begin{aligned}
        \bra{0}&
        \wick{
        \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}}\}
        \{\c1{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \c3{\hat{k}} \}
        \{\c4{\hat{l}} \}
        }
        +
        \wick{
        \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}}\}
        \{\c1{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \c4{\hat{k}} \}
        \{\c3{\hat{l}} \}
        } \\
        &+
        \wick{
        \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}}\}
        \{\c2{\hat{c}}^\dagger \c1{\hat{d}}^\dagger \c3{\hat{k}} \}
        \{\c4{\hat{l}} \}
        }
        +
        \wick{
        \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}}\}
        \{\c2{\hat{c}}^\dagger \c1{\hat{d}}^\dagger \c4{\hat{k}} \}
        \{\c3{\hat{l}} \}
        } \ket{0}
    \end{aligned} \\
    = \delta_{pl} \delta_{qk} \delta_{rd} \delta_{sc}
    - \delta_{pk} \delta_{ql} \delta_{rd} \delta_{sc}
    - \delta_{pl} \delta_{qk} \delta_{rc} \delta_{sd}
    + \delta_{pk} \delta_{ql} \delta_{rc} \delta_{sd}
\end{align}
Algbra eventually leads to,
\begin{equation}
    - \frac{1}{2} \sum_{klcd} \bra{kl} \ket{cd}
        t^{ab}_{ik} t^{cd}_{jl}.
\end{equation}
A similar computations provides the second $Q_c$ term,
\begin{equation}
    - \frac{1}{2} \sum_{klcd} \bra{kl} \ket{cd}
        t^{cd}_{ik} t^{ab}_{jl}
\end{equation}
These two terms give us,
\begin{equation}
    Q_c = - \frac{1}{2} \sum_{klcd} \bra{kl} \ket{cd}
        (t^{ab}_{ik}t^{cd}_{jl} - t^{cd}_{ik}t^{ab}_{jl})
\end{equation}
Treating the class d terms gives,
\begin{equation}
    Q_d - \frac{1}{2} \sum_{klcd} \bra{kl} \ket{cd}
        (t^{ac}_{ij}t^{bd}_{kl} - t^{bd}_{ij}t^{ac}_{kl}).
\end{equation}
Combining all the quadratic terms will now yield the same as in 
\autoref{eq:quad_term}, and we can conclude that an algebraic 
derivation of the coupled cluster method is equivalent to the 
configuration space derivation.

\section{The Coupled Cluster Equations}

In general there is a more useful and compact approach that can be used to derive 
the coupled cluster equations, compared to the lengthy derivation of the CCD 
equations above. We start by inserting the coupled cluster wavefunctions into the 
time-independent Schrödinger equation,
\begin{equation}
    \hat{H}_Ne^{\hat{T}}\ket{\Phi_0} = \Delta E e^{\hat{T}}\ket{\Phi_0}.
\end{equation} 
In order to find an expression for the energy and amplitude equations one could 
try to left-project with $\bra{\Phi_0}$. This would propel us in the same 
direction as in the previous section, i.e. \autoref{eq:ccd_energy} and onwards.
Instead, we multipy 
from the left with $e^{-\hat{T}}$ first, and then left-project with $\bra{\Phi_0}$,
\begin{equation}
    \label{eq:cc_energy}
    \begin{gathered}
    \bra{\Phi_0} e^{-\hat{T}}\hat{H}_Ne^{\hat{T}} \ket{\Phi_0} 
    = \bra{\Phi_0} e^{-\hat{T}} \Delta E e^{\hat{T}} \ket{\Phi_0} \\
    \to \bra{\Phi_0} e^{-\hat{T}} \hat{H}_N e^{\hat{T}} \ket{\Phi_0}
    = \Delta E.
    \end{gathered}
\end{equation}
Left-projecting with an excited state, $\bra{\Phi^{ab\dots}_{ij\dots}}$ will give us 
expression for the corresponding amplitude $t^{ab\dots}_{ij\dots}$,
\begin{equation}
    \label{eq:cc_amplitude}
    \bra{\Phi^{ab\dots}_{ij\dots}} e^{-\hat{T}}\hat{H}_Ne^{\hat{T}}\ket{\Phi_0} = 0.
\end{equation}
Now we have obtained a \emph{non-Hermitian}\footnote{We will show later that this 
non-Hermiticity is somewhat problematic.}, similarity-transformed Hamiltonian,
\begin{equation}
    \mathscr{H} = e^{-\hat{T}}\hat{H}_Ne^{\hat{T}},
\end{equation}
which has $\ket{\Phi_0}$ as right eigenfunction and $E$ as the corresponding eigenvalue.
Importantly, a similarity-transformation will not change the eigenvalue spectrum of the 
operator.

A benefit of the similarity-transformed Hamiltionians is that we can write the operators
more expicitly by applying the Baker-Campbell-Haussdorff
expansion\cite{campbell1897law,baker1905alternants,hausdorff1906symbolische},
\begin{equation}
    \begin{aligned}
        e^{-\hat{B}}\hat{A}e^{\hat{B}}
        =& (1 - \hat{B} + \frac{1}{2}\hat{B}^2 - \frac{1}{3!} + \dots)
        \hat{A} (1 + \hat{B} + \frac{1}{2} + \frac{1}{3!}\hat{B}^3 + \dots) \\
        =& \hat{A} + (\hat{A}\hat{B} - \hat{B}\hat{A}) 
        + \frac{1}{2}(\hat{A}\hat{B}^2 + 2\hat{B}\hat{A}\hat{B} + \hat{B}^2\hat{A})
        \\ &\ + \frac{1}{3!}(
            \hat{A}\hat{B}^3 - 3\hat{B}\hat{A}\hat{B}^2 + 3\hat{B}^2\hat{A}\hat{B}
            - \hat{B}^3\hat{A}
        ) + \dots \\
        =& \hat{A} + [\hat{A}, \hat{B}] + 
        \frac{1}{2}\{
            (\hat{A}\hat{B} - \hat{B}\hat{A})\hat{B}
            -\hat{B}(\hat{A}\hat{B} - \hat{B}\hat{A})     
        \} \\ &\ + \frac{1}{3!} \{
            [(\hat{A}\hat{B} - \hat{B}\hat{A})\hat{B}
            -\hat{B}(\hat{A}\hat{B} - \hat{B}\hat{A})] \hat{B}\\
            &\ \ -\hat{B}[(\hat{A}\hat{B} - \hat{B}\hat{A})\hat{B}
            -\hat{B}(\hat{A}\hat{B} - \hat{B}\hat{A})]
        \} + \dots \\
        =& \hat{A} + [\hat{A}, \hat{B}]
        + \frac{1}{2}[[\hat{A}, \hat{B}], \hat{B}]
        + \frac{1}{3!} [[[\hat{A}, \hat{B}], \hat{B}], \hat{B}] + \dots .
    \end{aligned}
\end{equation}
Applying the Baker-Campbell-Haussdorff expansion to the similarity-transformed 
Hamiltonians yields
\begin{equation}
    \begin{gathered}
    \label{eq:bch_hamiltonian}
    \mathscr{H} = 
    e^{-\hat{T}}\hat{H}_Ne^{\hat{T}} = \hat{H}_N + [\hat{H}_N, \hat{T}]
        + \frac{1}{2}[[\hat{H}_N, \hat{T}], \hat{T}]
        + \frac{1}{3!}[[[\hat{H}_N, \hat{T}], \hat{T}], \hat{T}] \\
        + \frac{1}{4!}[[[[\hat{H}_N, \hat{T}], \hat{T}], \hat{T}], \hat{T}].
    \end{gathered}
\end{equation}
Notice the absence of dots in this expression. The Baker-Campbell-Hausdorff expansion 
for the electronic Hamiltionian, containing at most two-particle interactions, will 
terminate with the four-fold commutator.

By applying the generalised Wick's theorem to the Baker-Campbell-Hausdorff 
expansion of the Hamiltonian in \autoref{eq:bch_hamiltonian}, we will be 
confronted with a vast simplification. Applying the generalised Wick's theorm 
to a commutator gives the following 
\begin{equation}
    \label{eq:wick_on_ab}
    [\hat{A}, \hat{B}] = \hat{A} \hat{B} - \hat{B} \hat{A} 
        = \{\hat{A} \hat{B} \} + \{ \wick{\c{\hat{A}} \c{\hat{B}} } \}
        - \{\hat{B} \hat{A} \} - \{ \wick{\c{\hat{B}} \c{\hat{A}} } \},
\end{equation}
where $\hat{A}$ and $\hat{B}$ are normal-ordered operators, each with an even 
number of creation- and annihilation operators\footnote{It is not a coincidence 
that both the normal-ordred Hamiltonian $\hat{H}_N$ and the cluster operator
$\hat{T}$ satisfy these condtions}.
In this expression $\{ \}$ denotes a normal-ordering of the operators inside 
the braces and $\{ \wick{\c{\hat{A}} \c{\hat{B}} } \}$
represents a sum of all normal-ordered products of operators in which there 
are one or more contractions between creation or annihilation operators in 
$\hat{A}$ and those in $\hat{B}$. We must also have that 
\begin{equation}
    \{\hat{A} \hat{B}\} = \{\hat{B} \hat{A}\},
\end{equation}
since the two operators both contain an even number of creation- and
annihilation operators. This means that what remains of \autoref{eq:wick_on_ab}
is simply
\begin{equation}
    [\hat{A}, \hat{B}] = \{ \wick{\c{\hat{A}} \c{\hat{B}} } \}
    - \{ \wick{\c{\hat{B}} \c{\hat{A}} } \}.
\end{equation}

The general $m$-fold cluster operator $T_m$ contains some number of creation
operators $\hat{a}^\dagger, \hat{b}^\dagger \dots$ and hole operators 
$\hat{i}, \hat{j}, \dots$, and the only possible non-zero contractions are 
$\wick{\c{\hat{a}} \c{\hat{b}}^\dagger} = \delta_{ab}$ and 
$\wick{\c{\hat{i}}^\dagger \c{\hat{j}}} = \delta_{ij}$. Moreover, since the 
different cluster operators commute, no nonzero conatractions exist 
between different $\hat{T}_m$ operators. Ergo, in the neste commutators from 
\autoref{eq:bch_hamiltonian}, we only see surviving terms between the Hamiltonian 
$\hat{H}_N$ and one or more of the cluster operators $\hat{T}_m$. This 
accounts for the natural truncation at the four-fold commutator. In fact,
we can rewrite the Baker-Campbell-Haussdorff-expanded similarity-transformed 
Hamiltonian as 
\begin{equation}
    \mathscr{H} = 
    e^{-\hat{T}}\hat{H}_Ne^{\hat{T}} = 
    \hat{H}_N + \wick{\c{\hat{H}_N} \c{\hat{T}}}
    + \frac{1}{2}\wick[offset=1.4em]{\c{\hat{H}_N} \c{\overline{\hat{T}\hat{T}}}}
    + \frac{1}{3!}\wick[offset=1.4em]{\c{\hat{H}_N} 
        \c{\overline{\hat{T}\hat{T}\hat{T}}}}
    + \frac{1}{4!}\wick[offset=1.4em]{\c{\hat{H}_N} 
        \c{\overline{\hat{T}\hat{T}\hat{T}\hat{T}}}},
\end{equation}
where the very interesting notation combining a contraction line and an horizontal bar 
indicates a sum over all terms in which the Hamiltonian $\hat{H}_N$ is connected by at 
least one contraction with each of the following cluster operators $\hat{T}$.

Disconnected clusters that on the form $\hat{T}_m \hat{T}_n$, which can be found in the 
coupled cluster wavefunction are not present in the Baker-Campbell-Hausdorff expansion 
of the similarity-transformed Hamiltonian. This is true also for the coupled cluster 
amplitude equations, which may be written 
\begin{align}
    \bra{\Phi_0} e^{-\hat{T}}\hat{H}_N e^{\hat{T}} \ket{\Phi_0}
    &= \bra{\Phi_0} \hat{H}_N e^{\hat{T}} \ket{\Phi_0}_C = \Delta E \\
    \bra{\Phi^{ab\dots}_{ij\dots}} e^{-\hat{T}}\hat{H}_N e^{\hat{T}} \ket{\Phi_0}
    &= \bra{\Phi^{ab\dots}_{ij\dots}} \hat{H}_N e^{\hat{T}} \ket{\Phi_0}_C = 0,
\end{align}
where the inclusion of only connected terms is underlined.

The CCSD equations take the form 
\begin{gather}
    \bra{\Phi_0} \hat{H}_N
        \Big(\hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \hat{T}_2\Big)
    \ket{\Phi_0}_C = \Delta E \\
    \bra{\Phi^a_i} \hat{H}_N \Big(
        1 + \hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \frac{1}{3!}\hat{T}_1^3
        + \hat{T}_1\hat{T}_2 + \hat{T}_2
    \Big) \ket{\Phi_0}_C = 0 \\
    \bra{\Phi^{ab}_{ij}} \hat{H}_N \Big(
        1 + \hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \frac{1}{3!}\hat{T}_1^3
        + \frac{1}{4!}\hat{T}_1^4 + \hat{T}_2 + \frac{1}{2}\hat{T}_2^2
        + \hat{T}_1 \hat{T}_2 + \frac{1}{2}\hat{T}_1^2 \hat{T}_2
    \Big) \ket{\Phi_0}_C = 0.
\end{gather}
For CCSDT, the energy expression is the same, whil the amplitude equations take
the form 
\begin{gather}
    \bra{\Phi^a_i} \hat{H}_N \Big(
        1 + \hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \frac{1}{3!}\hat{T}_1^3
        + \hat{T}_1\hat{T}_2 + \hat{T}_2 + \hat{T}_3
    \Big) \ket{\Phi_0}_C = 0 \\
    \begin{aligned}
    \bra{\Phi^{ab}_{ij}} \hat{H}_N& \Big(
        1 + \hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \frac{1}{3!}\hat{T}_1^3
        + \frac{1}{4!}\hat{T}_1^4 + \hat{T}_2 \\ &+ \frac{1}{2}\hat{T}_2^2
        + \hat{T}_1 \hat{T}_2 + \frac{1}{2}\hat{T}_1^2 \hat{T}_2
        + \hat{T}_3 + \hat{T}_1\hat{T}_3
    \Big) \ket{\Phi_0}_C = 0  
    \end{aligned} \\
    \begin{aligned}
    \bra{\Phi^{ab}_{ij}} \hat{H}_N& \Big(
        \hat{T}_2 + \hat{T}_3 + \frac{1}{2}\hat{T}_2^2 + \hat{T}_1\hat{T}_2
        + \hat{T}_2\hat{T}_3 + \hat{T}_1\hat{T}_3 \\
        &+ \frac{1}{2}\hat{T}_1^2\hat{T}_2 + \frac{1}{2}\hat{T}_1\hat{T}_2^2
        + \frac{1}{2} \hat{T}_1^2\hat{T}_3 + \frac{1}{3!} \hat{T}_1^3 \hat{T}_2
    \big) \ket{\Phi_0}_C = 0  
    \end{aligned}
\end{gather}
the final result of the computation of these equations are provided in the 
appendices INSERT INTO THE APPENDICES!

\section{[UNFINISHED] The Lagrangian Formulation}

\section{[UNFINISHED] Generealisation in Time}