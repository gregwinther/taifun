\chapter{Coupled Cluster}
\label{ch:coupled_cluster_theory}

In the late 1950s Fritz Coester constructed a rigorous formal solution of the bound
state Schrödinger equation as a set of single particle wave
functions\cite{coester1958bound}. He wanted to find an expression for the wave operator 
$\Omega$, which transforms a zero-order wavefunction to the exact wave function,
\begin{equation}
    \Psi = \Omega \Phi_0.
\end{equation}
From Coester's solutions it would become apparent that the Rayleigh-Schrödinger 
perturbation expansions of the energy does not contain matrix elements representing 
the products of so-called unlinked diagram. In other words, one form of $\Omega$ is 
given a ``linked-diagram expansion'',
\begin{equation}
    \Omega\ket{\Phi_0} = \ket{\Phi_0} 
    = \sum_{k=1}^\infty\left((\hat{R}_0\hat{W})^k \ket{{\Phi_0}} \right)_L.
\end{equation}
This is further underlined in discussions by John Hubbard\cite{hubbard1957description}
and Nicolaas Marinus Hugenholtz\cite{hugenholtz1957perturbation}.

Conveniently, $\Omega$ may be written quite generally as
\begin{equation}
    \Omega = e^{\hat{T}}, \quad \Psi = e^{\hat{T}}\Phi_0.
\end{equation}
This exponential form has been come to be known as the Coupled Cluster ansatz, even 
though it is much more than a simple guess for the form of the exact wavefunction.
To underline this point we quote Herman Kümmel: ``Strange as it may be, in spite of
the many successes of the coupled cluster method there is still a widspread belief
that the underlying exponential structure is something artificial, accidental or 
an approximation only. This is why I want to make it clear that this feature is 
extremely natural - even necessary - on a very fundamental level, not necessarily
connected with many-body theory''\cite{kummel1991origins}. 

Throughout the 1950s and early 1960s, Coester and Kümmel developed the coupled cluster method together and 
proposed using the exponential-form wave operator as coupling between the shell-model 
state and the correct state vector for nuclear matter\cite{coester1960short}. At the time, 
the method proved too computationally intensive. Specifically, the hard core potenatials 
of nuclear physics leaves no freedom in truncating the set of coupled cluster equations.
However, the method was picked up by 
Ji\v{r}\'{i} \v{C}\'{i}\v{z}ek who 
in 1966 reformulated the method for modelling of electron correlation in atoms and
molecules\cite{vcivzek1966correlation}. Further development with Josef Paldus
made the coupled cluster method one of the most succesfull\footnote{At least one of the
most prevalent} methods in quantum chemistry. Together with Isaiah Shavitt,
\v{C}\'{i}\v{z}ek and Paldus did the first \emph{ab initio} comutations with the method,
which they called the coupled-pair many-electron-theory (MET)\cite{paldus1972correlation},
as it can be intepreted as the perturbative variant of the many-electron-theory of 
Oktay Sinano\v{g}lu\cite{sinanoglu1964many}.

\section{The Cluster Operator}

Having established the form of the coupled cluster wavefunction as 
\begin{equation}
    \ket{\Psi} = e^{\hat{T}} \ket{\Phi_0},
\end{equation}
we now take a closer look at the cluster operator, which is divided into sub-operators 
\begin{equation}
    \hat{T} = \hat{T}_1 +  \hat{T}_2 + \hat{T}_2 + \hat{T}_3 + \dots,
\end{equation}
where the one-, two- and three-body operators are defined thusly,
\begin{align}
    \hat{T}_1 &= \sum_{ai}t^a_i\{\hat{a}^\dagger \hat{i} \} \\
    \hat{T}_2 &= \frac{1}{(2!)^2}\sum_{ijab} t^{ab}_{ij} 
        \{\hat{a}^\dagger \hat{i} \hat{b}^\dagger \hat{j} \} \\
    \hat{T}_3 &= \frac{1}{(3!)^2} \sum_{ijkabc} 
        \{\hat{a}^\dagger \hat{i} \hat{b}^\dagger \hat{j} \hat{c}^\dagger \hat{k} \},
\end{align}
where the coefficients $t^{abc\dots}_{ijk\dots}$ are commonly referred to as the 
coupled cluster \emph{amplitudes}, and are coefficients to be determined. The strings 
of operators are automatically normal-ordered. The general $m$-body cluster operator 
is given by 
\begin{equation}
    \hat{T}_m = \frac{1}{(m!)^2} \sum_{\substack{ij\dots \\ ab \dots}}
        t^{ab\dots}_{ij\dots} \{\hat{a}^\dagger \hat{i} \hat{b}^\dagger \hat{j} \dots\},
\end{equation}
which produces an $m$-fold excitation. It is not necessary to include cluster-operators
up to a infinite-fold excitation. Logically, the maximum excitation order is dictated by the number 
of electrons in the system $n$, such that $n \geq m$. Any higher-order excitation operator
would eventually annihilate an unoccupied orbital, resulting in a zero-contribution.
The prefactor $1/(m!)^2$ accounts for the redundancy created by unrestricted summations,
as a permutation of any of the $m$ hole or $m$ particle indices will not produce a 
distinct contributions. Indeed, we have for example that
\begin{equation}
    \hat{a}^\dagger \hat{i} \hat{b}^\dagger \hat{j} 
    = - \hat{a}^\dagger \hat{j} \hat{b}^\dagger \hat{i}
    = - \hat{b}^\dagger \hat{i} \hat{a}^\dagger \hat{j} 
    = \hat{b}^\dagger \hat{j} \hat{a}^\dagger \hat{j},
\end{equation}
and therefore we must also have that 
\begin{equation}
    t^{ab}_{ij} = - t^{ab}_{ji} = -t^{ba}_{ij} = t^{ba}_{ji}.
\end{equation}
Hence, the $(2!)^2 = 4$ contributions of two hole indices, $ab$, and two particle indices,
$ij$, will produce four equal terms, which is offset by the prefactor $1/4$.

The exponential wave operator $e^{\hat{T}}$ may be expanded as a Taylor series,
\begin{equation}
    e^{\hat{T}} = 1 + \hat{T} + \frac{1}{2!}\hat{T}^2
        + \frac{1}{3!}\hat{T}^3 + \dots.
\end{equation}
By including only single- and double excitations, 
$\hat{T}_{\text{CCSD}} = \hat{T}_1 + \hat{T}_2$,
this expressions becomes
\begin{equation}
    e^{\hat{T}_{\text{CCSD}}} = 
        1 + \hat{T}_1 + \hat{T}_2 
        + \frac{1}{2}\hat{T}_1^2 + \hat{T}_1\hat{T}_2 + \frac{1}{2} \hat{T}_2^2
        + \frac{1}{3!}\hat{T}_1^3 + \frac{1}{2}\hat{T}_1^2 \hat{T}_2
            + \frac{1}{2}\hat{T}_1\hat{T}_2^2 + \frac{1}{3!}\hat{T}_2^3 
        + \dots
\end{equation}
Contributions to the wave function containing only a single cluster operator, $\hat{T}_m$,
are called connected cluster contributions, while those containing products of cluster 
operators, $\hat{T}_{m_1}^{\alpha}\hat{T}_{m_2}^{\beta}$, are called disconnected
cluster contributions.

This inclusion of only single- and double excitations is called ``Coupled Cluster Singles 
Doubles'', elucidating the subscript CCSD\cite{purvis1982full}.
The most common approximation in coupled cluster theory is the CCSD model. Here, 
the operator $\hat{T}_2$ describes the important electron-pair interaction and the 
$\hat{T}_1$ operator carries out the orbital relaxations induced by the field set 
up by electron-pair interactions. 

\begin{tcolorbox}[title={Importance of different parts of the cluster operator}, 
    colback={white},
    colbacktitle={pink},
    coltitle={black}]
    The most important contribution to the wave-function in quantum chemistry is
    undoubtedlty $\hat{T}_2$, because 
    of the two-electron nature of the Hamiltonian. It describes the most important 
    interaction of quantum chemistry, the electron-pair interaction. The inclusion 
    of $\hat{T}_1$ and its products are relatively insensitive to the choice of 
    basis set, as the operators $e^{\hat{T}_1}$ has the effect of transforming 
    the reference state $\ket{\Phi_0}$ to another Slater determinant. This is known 
    as Thouless theorem\cite{thouless1960stability}. With very high electron-density,
    the three-particle operator $\hat{T}_3$ becomes important. Higher-order terms 
    are usually of less and decreasing importance, but they can be of concern in 
    special situations. For instance, the four-particle operator $\hat{T}_4$ is 
    very important in nuclear physics. See for instance 
    \citeauthor{helgaker2014molecular}\cite{helgaker2014molecular} or 
    \citeauthor{shavitt2009many}\cite{shavitt2009many} for further discussion on this
    topic.
\end{tcolorbox}


\section{Coupled-Cluster Doubles (CCD)}

As a good starting point for understanding the coupled cluster scheme and especially
where the coupled-cluster equations come from, we now constrain the cluster
operator to
\begin{equation}
    \hat{T}_{\text{CCD}} = \hat{T}_2,
\end{equation}
and completely derive the coupled cluster equations for this case.
The CCD wave function includes all connected and disconnected clusters involving
$\hat{T}_2$ only,
\begin{equation}
    \Psi_{\text{CCD}} = e^{\hat{T}_2} = \Phi_0 + \hat{T}_2\Phi_0 + \frac{1}{2}\hat{T}_2^2\Phi_0 
        + \frac{1}{3!}\hat{T}_2^3\Phi_0 + \dots
\end{equation}

There are several methods with which to arrive at the coupled-cluster equations
and here we employ two 
of them for the coupled cluster doubles truncation. First, we use
configuration-interaction techniques and the Slater-Condon rules 
(\autoref{app:slater_condon}) and second, we use the ``algebraic method'',
employing second quantisation and Wick's theorem. A third way is with the aid of
diagrams. A brief note on such diagrams can be found in \autoref{app:diagrams}.

\subsection{Configuration space derivation}

We start from the CCD-constrained time-independent Schrödinger equation,
\begin{equation}
    \hat{H}\Psi_{\text{CCD}} = E_{\text{CCD}} \Psi_{\text{CCD}},
\end{equation}
which we left project with the reference state,
\begin{gather*}
    \bra{\Phi_0} \hat{H} \ket{\Psi_{\text{CCD}}} = \bra{\Phi_0} E_{\text{CCD}} \ket{\Psi_{\text{CCD}}} \nonumber \\
    \to E_{\text{CCD}} = \bra{\Phi_0} \hat{H} \ket{\Psi_{\text{CCD}}},
\end{gather*}
where we have taken advandage of the intermediate normalisation, 
$\braket{\Phi_0}{\Psi_{\text{CCD}}} = 1$. We then insert the exponential expansion
from the coupled cluster ansatz,
\begin{equation}
    \label{eq:ccd_energy}
    \begin{aligned}
    E_{\text{CCD}} &= \bra{\Phi_0} \hat{H} (1 + \hat{T}_2)\ket{\Phi_0} \\
        &= E_{\text{ref}} 
        + \sum_{\substack{i>j \\ a>b}} \bra{\Phi_0} \hat{H} \ket{\Phi_{ij}^{ab}}t^{ab}_{ij} \\
        &= E_{\text{ref}}
        + \sum_{\substack{i>j \\ a>b}} \bra{ij} \ket{ab}t^{ab}_{ij}.
    \end{aligned}
\end{equation}
The energy expression will truncate here because no higher order terms will contribute.
It is common to substract $E_{\text{ref}}$ to get,
\begin{equation}
    \hat{H}_N \Psi_{\text{CCD}} = \Delta E_{\text{CCD}} \Psi_{\text{CCD}},
\end{equation}
where $\hat{H}_N = \hat{H} - E_{\text{ref}}$. Now follows a series of expressions
intended to show the correspondence between coupled cluster- and perturbation theory,
HOPEFULLY THIS WILL BE CLEARER WHEN THE CHAPTER ON PERTURBATION THEORY IS COMPLETE
\begin{equation}
    \hat{H}_N = \hat{F} - \hat{U} + \hat{H}_2 - E_{\text{ref}}
        = \hat{H}_0 + \hat{F}^0 - \hat{U} + \hat{H}_2 - E_{\text{ref}},
\end{equation}
where,
\begin{gather}
    \hat{H}_0 = \hat{F}^d = \sum_\mu \hat{f}_\mu^d, 
        \quad \bra{p} \hat{f}_\mu^d \ket{q} = \epsilon_p \delta_{pq} \\
    \hat{F}^0 = \sum_\mu \hat{f}^0_\mu,
        \quad \bra{p} \hat{f}^0 \ket{q} = (1 - \delta_{pq})\bra{p} \hat{f} \ket{q} \\
    \hat{U} = \sum_\mu \hat{u}_\mu, 
        \quad \bra{p} \hat{u}_\mu \ket{q} = \sum_i \bra{pi} \ket{qi} \\
    \hat{H}_2 = \sum_{\mu > \nu} \frac{1}{r_{\mu\nu}},
        \quad E_{\text{ref}} = E_0 + E^{(1)}, \\
    E_0  = \sum_i \epsilon_i, \quad E^{(1)} = - \frac{1}{2} \sum_{ij} \bra{ij} \ket{ij}.
\end{gather}
In the canonical HF case we have $\hat{F}^0 = 0$ and $\hat{F}^d = \hat{F}$.

In order to compute the energy of the system we need the amplitudes $t^{ab}_{ij}$.
Starting from the modified Schrödinger equation,
\begin{equation}
    \hat{H}_N \Psi_{\text{CCD}} = \Delta E_{\text{CCD}} \Psi_{\text{CCD}}.
\end{equation}
We left project with a doubly-excited Slater determinant, and insert for the CC ansatz,
\begin{gather}
    \bra{\Phi^{ab}_{ij}} \hat{H}_N e^{\hat{T}_2} \ket{\Phi_0} 
        = \Delta E_{\text{CCD}} \bra{\Phi^{ab}_{ij}} e^{\hat{T}_2} \ket{\Phi_0} \\
    \bra{\Phi^{ab}_{ij}} 
        \hat{H}_N \left(1 + \hat{T}_2 + \frac{1}{2}\hat{T}^2_2\right) \ket{\Phi_0}
        = \Delta E_{\text{CCD}} t^{ab}_{ij}. \label{eq:ccd_amplitude}
\end{gather}
Here we have only expanded the exponential function up to the quadratic term. The next
term in the series will triple-excite the bra Slater determinant, which will give a
zero-contribution according to the Slater-Condon rules, because of two noncoincidences. Next we apply the Slater-Condon rules to the rest of the terms on the right-hand side, starting with just the normal-ordered Hamiltonian,
\begin{equation}
    \bra{\phi^{ab}_{ij}} \hat{H}_N \ket{\Phi_0} = \bra{ab} \ket{ij},
\end{equation}
where only $\hat{H}_2$ contributes.

Next we look at the linear term,
\begin{equation}
    \begin{aligned}
    \bra{\Phi^{ab}_{ij}} &\hat{H}_N \hat{T}_2 \ket{\Phi_0} 
        = \sum_{klcd} \bra{\phi^{ab}_{ij}} \hat{H}_N \ket{\phi^{cd}_{kl}} \\
    &= \bra{\Phi^{ab}_{ij}} \hat{H}_0 - E_{\text{ref}} \ket{\Phi^{ab}_{ij}}t^{ab}_{ij}
        + \sum_{\substack{k>l \\ c>d}} 
            \bra{\Phi^{ab}_{ij}} \hat{F}^0 - \hat{U} \ket{\Phi^{cd}_{kl}} t^{cd}_{kl} \\
    &\quad + \sum_{\substack{k>l \\ c>l}} 
        \bra{\Phi^{ab}_{ij}} \hat{H}_2 \ket{\Phi^{cd}_{kl}} t^{cd}_{kl} 
        = L_0 + L_1 + L_2.
    \end{aligned}
\end{equation}
We are going to evaluate these terms one-by-one, starting with $L_0$,
\begin{equation}
    \begin{aligned}
        L_0 &= \bra{\Phi^{ab}_{ij}} \hat{H}_0 - E_{\text{ref}}\ket{\Phi^{ab}_{ij}}
            = \bra{\Phi^{ab}_{ij}} \hat{H}_0 - E_0 - E^{(1)}\ket{\Phi^{ab}_{ij}} \\
            &= \left(-\varepsilon^{ab}_{ij} + \frac{1}{2}\sum_{kl}\bra{kl} \ket{kl}\right) t^{ab}_{ij}.,
    \end{aligned}
\end{equation}
where $\varepsilon^{ab}_{ij} = \varepsilon_i + \varepsilon_j - \varepsilon_a - \varepsilon_b$.

The next term,
\begin{equation}
    L_1 = \sum_{\substack{k>l \\ c>d}} 
            \bra{\Phi^{ab}_{ij}} \hat{F}^0 - \hat{U} \ket{\Phi^{cd}_{kl}} t^{cd}_{kl},
\end{equation}
yields contributions if at least three of the indices $k$, $l$, $c$, $d$ are equal to 
the indices $i$, $j$, $a$, $b$ (we want one or zero noncoincidences). All the possible
terms are,
\begin{equation}
L_1 = \begin{cases}
\begin{aligned}
     - \sum_k u_{kk} t^{ab}_{ij} &\quad \text{all indices equal} \\
     - \sum_k(f^0_{jk} - u_{jk}) t^{ab}_{ik} &\quad \text{one hole index unequal} \\
     + \sum_k(f^0_{ik} - u_{ik}) t^{ab}_{jk} &\quad \text{the other hole index unequal} \\
     - \sum_c(f^0_{ac} - u_{ac}) t^{bc}_{ij} &\quad \text{one particle index unequal} \\
     + \sum_c(f^0_{bc} - u_{bc}) t^{zc}_{ij} &\quad \text{the other particle index unequal}.
\end{aligned}
\end{cases}
\end{equation}

For the last linear term,
\begin{equation}
    L_2 = \sum_{\substack{k>l \\ c>d}}\bra{\Phi^{ab}_{ij}} \hat{H}_2 \ket{\Phi^{cd}_{kl}} t^{cd}_{kl},
\end{equation}
we require that at least two of the indices $k$, $l$, $c$, $d$ are equal to the indices $i$, $j$, $a$, $b$,
as we can do with at most two noncoincidences in the bra and the ket. For equality in
both the hole indices or both the particle indices we have
\begin{align}
    cd = ab \quad &\to \quad \sum_{k>l}\bra{ij}\ket{kl} t^{ab}_{kl} \\ 
    kl = ij \quad &\to \quad \sum_{c>d}\bra{ab}\ket{cd} t^{cd}_{ij}.
\end{align}
For one equality in both hole and particle index we have
\begin{equation}
    -\sum_{kl}\big(\bra{bk}\ket{cj} t^{ac}_{ik} - \bra{bk}\ket{ci} t^{ac}_{jk}  
                -\bra{ak}\ket{cj} t^{bc}_{ik} - \bra{bk}\ket{ci}  t^{ac}_{jk} \big),
\end{equation}
where the sign stems from the maximum coincidence permutations as dictated by the
Slater-Condon rules. Most of the three- and four equal index terms are accounted
for by the expression above, the remaining three-index equality terms are
\begin{align}
    -\sum_{kl}\big( \bra{jl}\ket{kl} t^{ab}_{ik} - \bra{il}\ket{kl} t^{ab}_{jk} \big) \\
    +\sum_{cl}\big( \bra{bl}\ket{cl} t^{ac}_{ij} - \bra{al}\ket{cl} t^{bc}_{ij} \big),
\end{align}
and there is one term for the case where all indices are equal,
\begin{equation}
    \sum_{k>l} \bra{kl} \ket{kl} t^{ab}_{ij} = \frac{1}{2} \sum_{kl} \bra{kl} \ket{kl} t^{ab}_{ij}.
\end{equation}

\begin{tcolorbox}[title={Difference between Coupled Cluster and Configuration Interaction}, 
    colback={white},
    colbacktitle={pink},
    coltitle={black}]

    THIS BOX MAY BELONG SOMEWHERE ELSE (or may not be in a box)

    Monkhorst\cite{monkhorst1977calculation} gives a general formuala for transferring 
    back and forth between CC operators $\hat{T}_m$ and CI operators $\hat{C}_m$,
    \begin{equation}
        \hat{C}_m = \sum_{k}^m\frac{1}{k!}\sum_{|m_\mu|}
            \delta(m_1 + m_2 + \dots + m_k, m) \prod_{\mu=1}^k\hat{T}_{m_\mu},
    \end{equation}
    where the second sum is over all sets of $k$ $m_\mu$-values that sum up to $m$.
    The first four of the terms are,
    \begin{align}
        \hat{C}_1 &= \hat{T}_1 \\
        \hat{C}_2 &= \hat{T}_2 + \frac{1}{2} \hat{T}_1^2 \\
        \hat{C}_3 &= \hat{T}_3 + \hat{T}_1\hat{T}_2 + \frac{1}{3!} T_1^3 \\
        \hat{C}_4 &= \hat{T}_4 + \frac{1}{2}\hat{T}_2
            + \frac{1}{2}\hat{T}_2\hat{T}_1^2 + \frac{1}{4!}\hat{T}_1^4.
    \end{align}
    For the CCSD and CISDTQ wavfunctions we have,
    \begin{gather}
        \ket{\Psi_{\text{CCSD}}} = \left(
            1 + \hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \frac{1}{3!}\hat{T}_1^3 
            + \hat{T}_2 + \frac{1}{2}\hat{T}_2^2 + \frac{1}{4!}\hat{T}_1^4 
            + \hat{T}_1\hat{T}_2 
        \right) \ket{\Phi_0} \\
        \ket{\Psi_{\text{CISDTQ}}} = \left(
            1 + \hat{C}_1 + \hat{C}_2  + \hat{C}_3 + \hat{C}_4
        \right)\ket{\Phi_0}
    \end{gather}
    which provides us with a relation between the two,
    \begin{equation}
        \ket{\Psi_{\text{CCSD}}} 
            = \ket{\Psi_{\text{CISDTQ}}} - (\hat{T}_3 + \hat{T}_4)\ket{\Phi_0}.
    \end{equation}
    Moreover, we see that for a system of $n=2$ particles, that
    \begin{equation}
        \ket{\Psi_{\text{CCSD}}} = \ket{\Psi_{\text{CISD}}}.
    \end{equation}
\end{tcolorbox}

These last three- and four-index equality terms are expressible in terms of $\hat{u}$,
and will cancel the first term in $L_1$ together with the $\hat{u}$ term from $L_0$.
All terms so far are the same as in a configuration interaction with doubles excitations
(CID) computation. The difference between coupled cluster with doubles (CCD) and
CID is the following extra quadratic terms,
\begin{equation}
    Q = \frac{1}{2}\bra{\Phi^{ab}_{ij}} \hat{H}_N \hat{T}_2^2\ket{\Phi_0}
        = \frac{1}{2} \sum_{\substack{k>l \\ c>d}} \sum_{\substack{m>n \\ e>f}}
            \bra{\phi^{ab}_{ij}} \hat{H}_N \ket{\Phi^{cdef}_{klmn}}t^{cd}_{kl}t^{ef}_{mn}.
\end{equation}
From this expression we will have a contrition only when four of the indices $k$, $l$,
$m$, $n$, $c$, $d$, $e$, $f$ are equal to $i$, $j$, $a$, $b$, and only $\hat{H}_2$
can contribute. After some algebraic acrobatics we'll find that this becomes
\begin{equation}
    \label{eq:quad_term}
    \begin{aligned}
        Q = \sum_{\substack{k>l \\ c>d}} \bra{kl} \ket{cd}\big[
                &(t^{ab}_{ij}t^{cd}_{kl} + t^{cd}_{ij}t^{ab}_{kl}) 
            -2   (t^{ac}_{ik}t^{cd}_{jl} + t^{bd}_{ij}t^{bd}_{ij}) \\
            -2  &(t^{ab}_{ik}t^{cd}_{jl} + t^{cd}_{ik}t^{ab}_{jl}) 
            +4   (t^{ac}_{ik}t^{bd}_{jl} + t^{bd}_{ik}t^{ac}_{jl})
            \big].
    \end{aligned}
\end{equation}
From \autoref{eq:ccd_energy} we see that
\begin{equation}
    \label{eq:ccd_energy2}
    \Delta E_{\text{CCD}} = \sum_{\substack{i>j \\ a>b}} \bra{ij} \ket{ab} t^{ab}_{ij},
\end{equation}
and because the indices in \autoref{eq:quad_term} are dummy variables we see that
the first term here cancels with the right-hand side of \autoref{eq:ccd_amplitude}.
Some algebraic massage after the initial acrobatic exercises leads to,
\begin{equation}
    \begin{aligned}
    \varepsilon^{ab}_{ij}t^{ab}_{ij}
        &= \bra{ab}\ket{ij} + \frac{1}{2}\sum_{cd} \bra{ab}\ket{cd}t^{cd}_{ij}
            + \frac{1}{2}\sum_{kl} \bra{ij} \ket{kl} t^{ab}_{kl} \\
        &\ -\sum_{kl}\big(
             \bra{bk}\ket{cj}t^{ac}_{ik} 
            -\bra{bk}\ket{ci}t^{ac}_{jk}
            -\bra{ak}\ket{cj}t^{bc}_{ik}
            +\bra{ak}\ket{ci}t^{bc}_{jk}
            \big) \\
        &\ -\sum_k \hat{f}^0_{jk} t^{ab}_{ik}
            +\sum_k \hat{f}^0_{ik} t^{ab}_{jk}
            +\sum_c \hat{f}^0_{bc} t^{ac}_{ij}
            -\sum_c \hat{f}^0_{ac} t^{bc}_{ij} \\
        &\ +\sum_{klcd} \bra{kl} \ket{cd} \Big[
            \frac{1}{4}t^{cd}_{ij}t^{ab}_{kl}
            -\frac{1}{2}(t^{ac}_{ij}t^{bd}_{kl} + t^{bd}_{ij}t^{ac}_{kl}) \\
        &\quad\quad -\frac{1}{2}(t^{ab}_{ik}t^{cd}_{jl} + t^{cd}_{ik}t^{ab}_{jl})
            +(t^{ac}_{ik}t^{bd}_{jl} + t^{bd}_{ik}t^{ac}_{jl})
            \Big],
    \end{aligned}
\end{equation}
which is the CCD amplitude equations. This equation contains simultaneous algebraic 
expressions, contrary to CI. The equations must be solved iteratively, substituting 
$t^{ab}_{ij}$ obtained in each iteration, into the quadratic terms for the next 
iteration.

\subsection{Algebraic Derivation}

In this derivation we make great use of second quantisation formalism and Wick's 
theorem. We start with the normal-ordered Hamiltionian,
\begin{equation}
    \begin{aligned}
    \hat{H}_N &= (\hat{H}_0)_N + \hat{F}^0_N  + \hat{W} \\
        &= \sum_p \varepsilon_p \{ \hat{p}^\dagger \hat{p} \}
            + \sum_{p\neq q} f_{pq} \{ \hat{p}^\dagger \hat{q} \}
            + \frac{1}{4} \sum_{pqrs} \bra{pq} \ket{rs} \{\hat{p}^\dagger\hat{q}^\dagger\hat{s}\hat{r}\}.
    \end{aligned}
\end{equation}
The one-particle terms $(\hat{H}_0)_N$ and $\hat{F}^0_N$ can be combined by setting
$\varepsilon_{p} = f_{pp}$, reducing the normal-ordered Hamilionian to
\begin{equation}
    \begin{aligned}
    \hat{H}_N &= \hat{F}_N  + \hat{W} \\
        &= \sum_{pq} f_{pq} \{ \hat{p}^\dagger \hat{q} \}
            + \frac{1}{4} \sum_{pqrs} \bra{pq} \ket{rs} \{\hat{p}^\dagger\hat{q}^\dagger\hat{s}\hat{r}\}.
    \end{aligned}
\end{equation}

First we want to find an expression for the energy,
\begin{equation}
    \Delta E_{\text{CCD}} = \bra{0}\hat{H}_N (1 + \hat{T}^2) \ket{0}
        = \bra{0} \hat{H}_N \hat{T}_2 \ket{0},
\end{equation}
where only the vacuum expectation value of the product of the Hamiltonian and the 
doubles cluster operators gives a contributions, because the vacuum expectation value
of just the Hamiltonian is zero. Inserting for the operators,
\begin{equation}
    \Delta E_{\text{CCD}} 
        = \sum_{\substack{i>j \\ a>b}}\bra{0}\left[ 
        \sum_{pq} f_{pq} \{\hat{p}^\dagger \hat{q}\}
        + \frac{1}{4}\sum_{pqrs}\bra{pq} \ket{rs} \{\hat{p}^\dagger\hat{q}^\dagger\hat{s}\hat{r}\}
        \right] 
        \{\hat{a}^\dagger\hat{b}^\dagger\hat{j}\hat{i} \}
        \ket{0}t^{ab}_{ij}.
\end{equation}
Here the one-particle part will vanish as there is no manner one can contract all the
operators in this term without using an internal contraction in the normal-ordered
product. It is also useful to convert the first sum to an unrestricted sum,
\begin{equation}
    \Delta E_{\text{CCD}}
        = \frac{1}{16}\sum_{ijab}\sum_{pqrs}\bra{pq} \ket{rs} 
           \bra{0} 
           \{\hat{p}^\dagger\hat{q}^\dagger\hat{s}\hat{r}\} 
           \{\hat{a}^\dagger\hat{b}^\dagger\hat{j}\hat{i} \}
           \ket{0} t^{ab}_{ij}.
\end{equation}
We contract the operators in the normal-ordered products,
\begin{gather}
    \begin{aligned}
         \bra{0}
            &\wick{
            \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}} \} 
            \{\c1{\hat{a}}^\dagger \c2{\hat{b}}^\dagger \c3{\hat{j}} \c4{\hat{i}} \} 
            }
            +
            \wick{
            \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}} \} 
            \{\c2{\hat{a}}^\dagger \c1{\hat{b}}^\dagger \c3{\hat{j}} \c4{\hat{i}} \}
            } \\
            +
            &\wick{
            \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}} \} 
            \{\c1{\hat{a}}^\dagger \c2{\hat{b}}^\dagger \c4{\hat{j}} \c3{\hat{i}} \}
            }
            +
            \wick{
            \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}} \} 
            \{\c2{\hat{a}}^\dagger \c1{\hat{b}}^\dagger \c4{\hat{j}} \c3{\hat{i}} \}
            }
         \ket{0}
    \end{aligned} \\
    \begin{aligned}
        = &\delta_{pi}\delta_{qj}\delta_{sb}\delta_{ra} 
        - \delta_{pi}\delta_{qj}\delta_{sa}\delta_{rb} \\
        - &\delta_{pj}\delta_{qi}\delta_{sb}\delta_{ra} 
        + \delta_{pj}\delta_{qi}\delta_{sa}\delta_{rn}. 
    \end{aligned} 
\end{gather}
All these products of delta functions give us a reduction in the sums and the CCD
energy becomes,
\begin{equation}
    \Delta E_{\text{CCD}} = \frac{1}{4}\sum_{ijab}\bra{ij} \ket{ab} t^{ab}_{ij}.
\end{equation}

The natural next step is to find the amplitude equations,
\begin{equation}
    \bra{\Phi^{ab}_{ij}}\hat{H}_N\left(1 + \hat{T}_2 + \frac{1}{2}\hat{T}^2\right) \ket{0}
        = \Delta E_{\text{CCD}} t^{ab}_{ij}.
\end{equation}
We compute this expression in steps, starting with the lone normal-ordred Hamiltonian,
\begin{equation}
    \bra{\Phi^{ab}_{ij}} \hat{H}_N \ket{0}
        = \frac{1}{4}\sum_{pqrs} \bra{0}
        \{\hat{a}\hat{b}\hat{j}^\dagger\hat{i}^\dagger\}
        \{\hat{p}^\dagger\hat{q}^\dagger\hat{s}\hat{r}\}
        \ket{0}\bra{pq} \ket{rs},
\end{equation}
here we also have to compute a few contractions,
\begin{gather}
    \begin{aligned}
        \bra{0}
        &\wick{
        \{ \c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}}\}
        \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c3{\hat{s}} \c4{\hat{r}} \}
        }
        +\wick{
        \{ \c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}}\}
        \{ \c2{\hat{p}}^\dagger \c1{\hat{q}}^\dagger \c3{\hat{s}} \c4{\hat{r}} \}
        } \\
        +&\wick{
        \{ \c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}}\}
        \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
        }
        +\wick{
        \{ \c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}}\}
        \{ \c2{\hat{p}}^\dagger \c1{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
        }
        \ket{0}
    \end{aligned} \\
    \begin{aligned}
        =&\delta_{ir}\delta_{js}\delta_{bq}\delta_{ap} 
        -\delta_{ir}\delta_{js}\delta_{bp}\delta_{aq}\\
        -&\delta_{is}\delta_{jr}\delta_{bq}\delta_{ap}
        +\delta_{is}\delta_{jr}\delta_{bp}\delta_{aq}.
    \end{aligned} 
\end{gather}
This will leave us with a similar expression as the one in the energy equation,
\begin{equation}
    \bra{\Phi^{ab}_{ij}} \hat{H}_N \ket{0} = \bra{ab} \ket{ij}.
\end{equation}

Now for the linear terms,
\begin{equation}
    \begin{aligned}
         \bra{\phi^{ab}_{ij}} \hat{H}_N \hat{T}_2 \ket{0} 
            = &\sum_{\substack{k>l \\ c>d}} \bra{\phi^{an}_{ij}} \hat{H}_n 
                \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \} \ket{0}t^{cd}_{kl} \\
            = \frac{1}{4} &\sum_{klcd} \bra{\Phi^{ab}_{ij}} \hat{F}_N + \hat{W}\ket{\Phi^{cd}_{kl}}t^{cd}_{kl}
    \end{aligned}
\end{equation}
Starting with the first term,
\begin{equation}
    \begin{aligned}
         L_1 &= \frac{1}{4}\sum_{klcd} \bra{\phi^{ab}_{ij}} \hat{F}_N \ket{\phi^{cd}_{kl}} t^{cd}_{kl} \\
            &= \frac{1}{4}\sum_{klcd} \sum{pq} f_{pq} \bra{\phi^{ab}_{ij}}
                \{ \hat{p}^\dagger \hat{q}\} \ket{\phi^{cd}_{kl}} t^{cd}_{kl} \\
            &= \frac{1}{4} \sum_{klcd}\sum_{pq} f_{pq} \bra{0}
                \{\hat{i}^\dagger \hat{j}^\dagger \hat{b} \hat{a} \}
                \{\hat{p}^\dagger \hat{q}\} 
                \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \}
            \ket{0} t^{cd}_{kl}
    \end{aligned}
\end{equation}
The product of normal-ordered operators must be contracted in such a way that three and
three operators in the first and last operator strings are contracted with one another,
and the two operators in the middle string is contracted with one operator in the last
and first one. This provides us with $3\times 3 \times 2 = 16$ possible contractions.
Here are the first four contractions,
\begin{gather}
    \begin{aligned}
        &\wick{
        \{\c5{\hat{i}}^\dagger \c4{\hat{j}}^\dagger \c3{\hat{b}} \c1{\hat{a}} \}
        \{\c1{\hat{p}}^\dagger \c2{\hat{q}}\} 
        \{\c2{\hat{c}}^\dagger \c3{\hat{d}}^\dagger \c4{\hat{l}} \c5{\hat{k}} \} 
        } + 
        \wick{
        \{\c5{\hat{i}}^\dagger \c4{\hat{j}}^\dagger \c1{\hat{b}} \c3{\hat{a}} \}
        \{\c1{\hat{p}}^\dagger \c2{\hat{q}}\} 
        \{\c3{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \c4{\hat{l}} \c5{\hat{k}} \} 
        } \\ +
        &\wick{
        \{\c5{\hat{i}}^\dagger \c4{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}} \}
        \{\c3{\hat{p}}^\dagger \c4{\hat{q}}\} 
        \{\c1{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \c3{\hat{l}} \c5{\hat{k}} \} 
        } +
        \wick{
        \{\c5{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}} \}
        \{\c4{\hat{p}}^\dagger \c5{\hat{q}}\} 
        \{\c1{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \c3{\hat{l}} \c4{\hat{k}} \} 
        }
    \end{aligned} \\
    \begin{aligned}
         =&\delta_{ik}\delta_{jl}\delta_{bd}\delta_{ap}\delta_{cq}
         +\delta_{ik}\delta_{jl}\delta_{ac}\delta_{bp}\delta_{dq} \\
         -&\delta_{ik}\delta_{jq}\delta_{bd}\delta_{ac}\delta_{pl}
         -\delta_{iq}\delta_{pk}\delta_{jl}\delta_{bd}\delta_{ac}.
    \end{aligned}
\end{gather}
The last 12 contractions will be equivalent to these four, and thus we rid ourselves
of the $\frac{1}{4}$-prefactor, yielding
\begin{equation}
    L_1 = \sum_c(f_{bc} t^{ac}_{ij} - f_{ac} t^{bc}_{ij}) + \sum_k (f_{ik} t^{ab}_{jk} - f_{jk} t^{ab}_{ik}).
\end{equation}

Proceeding to the second linear term,
\begin{equation}
    \begin{aligned}
    L_2 &= \frac{1}{4}\sum_{klcd} \bra{\Phi^{ab}_{ij}} \hat{W} \ket{\Phi^{cd}_{kl}} t^{cd}_{kl} \\
        &= \frac{1}{16}\sum_{pqrs} \sum_{klcd} \bra{pq} \ket{rs} \bra{0}
            \{\hat{j}^\dagger \hat{b} \hat{i}^\dagger  \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{d}^\dagger \hat{k} \hat{l} \}
        \ket{0}t^{cd}_{kl}
    \end{aligned}
\end{equation}
Here there are many possible ways to contract the operator strings, so it is convenient
to label the different kinds of contractions. Subscript $a$-terms consist of two
hole-hole contractions, subscript $b$-terms consist of two particle-particle
contractions and subscript $c$-terms consist of one particle-hole and one
hole-particle contractions,
\begin{align}
    &\begin{aligned}
        L_{2a}
        &= \frac{1}{8}\sum_{pqrs} \sum_{klcd} \bra{pq} \ket{rs} \bra{0}
            \wick{
            \{\c2{\hat{i}}^\dagger \c1{\hat{j}}^\dagger \hat{b} \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{d}^\dagger \c1{\hat{k}} \c2{\hat{l}} \}
            }
            \ket{0}t^{cd}_{kl} \\
        &= \frac{1}{8}\sum_{pqrs} \sum_{cd} \bra{pq} \ket{rs} \bra{0}
            \{ \hat{b} \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{ \hat{c}^\dagger \hat{d}^\dagger \}
            \ket{0}t^{cd}_{kl}
    \end{aligned} \\
    &\begin{aligned}
        L_{2b}
        &= \frac{1}{8}\sum_{pqrs} \sum_{klcd} \bra{pq} \ket{rs} \bra{0}
            \wick{
            \{\hat{i}^\dagger \hat{j}^\dagger \c2{\hat{b}} \c1{\hat{a}} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\c1{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \hat{l} \hat{k} \}
            }
            \ket{0}t^{cd}_{kl} \\
        &= \frac{1}{8}\sum_{pqrs} \sum_{kl} \bra{pq} \ket{rs} \bra{0}
            \{\hat{i}^\dagger \hat{j}^\dagger \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{l} \hat{k} \}
            \ket{0}t^{cd}_{kl}
    \end{aligned} \\
    &\begin{aligned}
        L_{2c}
            = \frac{1}{4}\sum_{pqrs} \sum_{klcd} \bra{pq} \ket{rs} \bra{0}
            &\wick{
            \{\c2{\hat{i}}^\dagger \hat{j}^\dagger \c1{\hat{b}} \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \c1{\hat{d}^\dagger} \c2{\hat{l}} \hat{k} \}
            } \\
            +
            &\wick{
            \{\hat{i}^\dagger \c2{\hat{j}}^\dagger \c1{\hat{b}} \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \c1{\hat{d}^\dagger} \c2{\hat{l}} \hat{k} \}
            } \\
            +
            &\wick{
            \{\c2{\hat{i}}^\dagger \hat{j}^\dagger \hat{b} \c1{\hat{a}} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \c1{\hat{d}^\dagger} \c2{\hat{l}} \hat{k} \}
            } \\
            +
            &\wick{
            \{\hat{i}^\dagger \c2{\hat{j}}^\dagger \hat{b} \c1{\hat{a}} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \c1{\hat{d}^\dagger} \c2{\hat{l}} \hat{k} \}
            }
            \ket{0}t^{cd}_{kl} \\
        = \frac{1}{4} \sum_{pqrs} \sum_{kc} \bra{pq} \ket{rs} \bra{0}
            &\{\hat{i}^\dagger \hat{a}\}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{k} \} 
            \\ -
            &\{\hat{j}^\dagger \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{k} \} 
            \\ -
            &\{\hat{i}^\dagger \hat{b} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{k} \} 
            \\ +
            &\{\hat{j}^\dagger \hat{b} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{k} \} 
        \ket{0}.
    \end{aligned}
\end{align}
The vacuum expectation value in $L_{2a}$ can be evaluated as,
\begin{gather}
    \begin{aligned}
        \bra{0}
            &\wick{
            \{ \c2{\hat{b}} \c1{\hat{a}} \}
            \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
            \{ \c3{\hat{c}}^\dagger \c4{\hat{d}}^\dagger \}
            } +
            \wick{
            \{ \c2{\hat{b}} \c1{\hat{a}} \}
            \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
            \{ \c4{\hat{c}}^\dagger \c3{\hat{d}}^\dagger \}
            } \\ +
            &\wick{
            \{ \c1{\hat{b}} \c2{\hat{a}} \}
            \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
            \{ \c3{\hat{c}}^\dagger \c4{\hat{d}}^\dagger \}
            } +
            \wick{
            \{ \c1{\hat{b}} \c2{\hat{a}} \}
            \{ \c1{\hat{p}}^\dagger \c2{\hat{q}}^\dagger \c4{\hat{s}} \c3{\hat{r}} \}
            \{ \c4{\hat{c}}^\dagger \c3{\hat{d}}^\dagger \}
            }
            \ket{0}
    \end{aligned} \\
    \begin{aligned}
         =&\delta_{bq}\delta_{ap}\delta_{sd}\delta_{rc}
          -\delta_{bq}\delta_{ap}\delta_{sc}\delta_{rd} \\
         -&\delta_{aq}\delta_{bp}\delta_{sd}\delta_{rc}
         + \delta_{aq}\delta_{bp}\delta_{sc}\delta_{rd}
    \end{aligned}
\end{gather}
Inserting this result into the original expression and substituting to similar indicies
will yield,
\begin{equation}
    L_{2a} = \frac{1}{2} \sum_{cd}\bra{ab} \ket{cd} t^{cd}_{ij}.
\end{equation}
A very similar computation will yield the following result for the next linear term,
\begin{equation}
    L_{2b} = \frac{1}{2} \sum_{kl} \bra{kl} \ket{ij} t^{ab}_{kl}.
\end{equation}
The last linear term is somewhat different, however,
\begin{equation}
    L_{2c} = - \sum_kc \left( 
        \bra{bk} \ket{cj} t^{ac}_{ik}
       -\bra{bk} \ket{ci} t^{ac}_{jk} 
       -\bra{ak} \ket{cj} t^{bc}_{ik}
       +\bra{ak} \ket{ci} t^{bc}_{jk}. 
    \right)
\end{equation}

After long last, we have only the quadratic term to deal with,
\begin{equation}
    Q = \frac{1}{8}\sum_{pqrs}\sum_{\substack{k>l \\ c>d}} \sum_{\substack{m>n \\ e>f}}
        \bra{pq} \ket{rs} \bra{0}
            \{\hat{i}^\dagger \hat{j}^\dagger \hat{b} \hat{a} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \}
            \{\hat{e}^\dagger \hat{f}^\dagger \hat{n} \hat{m} \}
        \ket{0} t^{dc}_{kl} t^{ef}_{mn}.
\end{equation}
In this expression there are no non-zero contractions between the third and 
fourth normal ordered operator string. We therefore need to contract operators 
in the first normal-ordered string with operators either in the third or four 
string, and the operator in the second string with the rest. 

We start by contracting all operators in the first normal-ordered string 
with all the operators in the fourth normal-ordered string,

\begin{equation}
    \begin{gathered}
    \frac{1}{8}\sum_{pqrs}\sum_{\substack{k>l \\ c>d}} \sum_{\substack{m>n \\ e>f}}
    \bra{pq} \ket{rs} \bra{0}
      \wick{ 
            \{\c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}} \}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \}
            \{\c1{\hat{e}}^\dagger \c2{\hat{f}}^\dagger \c3{\hat{n}} \c4{\hat{m}} \}
        \ket{0} t^{cd}_{kl} t^{ef}_{mn}
        } \\
    =
    \frac{1}{8}\sum_{pqrs}\sum_{\substack{k>l \\ c>d}}
    \bra{pq} \ket{rs} \bra{0}
        \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
        \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \}
    \ket{0} t^{cd}_{kl} t^{ab}_{ij}.
    \end{gathered}
\end{equation}
There are four possible ways to contract this last term, resulting in
\begin{equation}
    \frac{1}{2}\sum_{\substack {k>l \\ c >d }}
        \bra{kl} \ket{cd} t^{cd}_{kl} t^{ab}_{ij}.
\end{equation}
We get the same result by contracting the four operators in the first 
string with the four operators in the third string, cancelling the
factor $\frac{1}{2}$, eventually yielding a result equal to
$\Delta E_{\text{CCD}} t^{ab}_{ij}$, which we see by 
comparing this result to \autoref{eq:ccd_energy2}.

There are four remaining reasonable classes in which to sort the
permutations of contractions that remain;
\begin{itemize}
    \item[a] the two hole operators in the first string are
    contracted with the third or fourth operator string, yielding 
    equal results;
    \item[b] one hole and one particle operators in the first string
    are contracted with operators in the third string, the rest of
    the operators in the first string are contracted with operators 
    in the fourth string;
    \item[c] two particle operators and one hole operator from the 
    first string are contracted with operators in the third string,
    the last hole operator is contracted with an operator in the 
    fourth string;
   \item[d] one particle operator and two hole operators are contracted 
    with operators in the third string and the last particle operator 
    with an operator in the fourth string.
\end{itemize}
The results for class a and class b are agruably the least complicated to 
compute, yielding the following,
\begin{align}
    &\begin{gathered}
        Q_a = \frac{1}{16}\sum_{pqrs}\sum_{klcd} 
        \bra{pq} \ket{rs}\bra{0}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{l} \hat{k} \}
            \{\hat{c}^\dagger \hat{d}^\dagger \}
        \ket{0} t^{cd}_{ij} t^{ab}_{kl} \\
        = \frac{1}{4} \sum_{klcd}
        \bra{kl} \ket{rs} t^{cd}_{ij} t^{ab}_{kl}
    \end{gathered} \\
    &\begin{gathered}
        Q_b = \frac{1}{4}\sum_{pqrs} \sum_{klcd}
        \bra{pq} \ket{rs} \bra{0}
            \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
            \{\hat{c}^\dagger \hat{k} \}
            \{\hat{d}^\dagger \hat{l} \}
            \ket{0}
            (t^{ac}_{ik}t^{bd}_{jl} - t^{bc}_{ik}t^{ad}_{jl}) \\
        = \sum_{klcd} \bra{kl} \ket{cd}
            (t^{ac}_{ik}t^{bd}_{jl} - t^{bc}_{ik}t^{ad}_{jl})
        = \sum_{klcd} \bra{kl} \ket{cd}
            (t^{ac}_{ik}t^{bd}_{jl} - t^{bd}_{ik}t^{ac}_{jl})
    \end{gathered}
\end{align}

The sets of terms for class c and d can each be generated in two distinct
ways, dependent on the choice of the tree operators from the first operator
string ($\hat{i}^\dagger \hat{a} \hat{b}$ or 
$\hat{j}^\dagger \hat{a} \hat{b}$ for c and 
$\hat{i}^\dagger \hat{j}^\dagger \hat{a}$ or 
$\hat{i}^\dagger \hat{j}^\dagger \hat{b}$ for d). In each case there 
are 16 possibilities; the three operators from the first string can be 
contracted with operators in both the third or fourth string in four ways and
the remainding operators can then be contracted in two ways. All these
possibilities lead to equivalent results. For example, here is the first 
$Q_c$ term,
\begin{equation}
    \begin{gathered}
    \frac{1}{8} \sum_{pqrs} \sum_{klcd} \sum_{mnef}
    \bra{pq} \ket{rs} \bra{0}
        \wick{
        \{\c4{\hat{i}}^\dagger \c3{\hat{j}}^\dagger \c2{\hat{b}} \c1{\hat{a}} \}
        \{\hat{c}^\dagger \hat{d}^\dagger \hat{l} \hat{k} \} 
        \{\hat{c}^\dagger \hat{d}^\dagger \c3{\hat{l}} \hat{k} \}
        \{\c1{\hat{e}}^\dagger \c2{\hat{f}}^\dagger \c4{\hat{n}} \hat{m} \}
        }
    \ket{0} t^{cd}_{kl} t^{ef}_{mn} \\
    = - \frac{1}{8} \sum_{pqrs} \sum_{klcd}
    \bra{pq} \ket{rs} \bra{0} 
        \{\hat{p}^\dagger \hat{q}^\dagger \hat{s} \hat{r} \}
        \{\hat{c}^\dagger \hat{d}^\dagger \hat{k} \}
        \{\hat{l} \}
    \ket{0} t^{cd}_{kj} t^{ab}_{li}
    \ket{0}
    \end{gathered}
\end{equation}
The remainding operators in this expression can be contracted in four ways,
\begin{align}
    \begin{aligned}
        \bra{0}&
        \wick{
        \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}}\}
        \{\c1{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \c3{\hat{k}} \}
        \{\c4{\hat{l}} \}
        }
        +
        \wick{
        \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}}\}
        \{\c1{\hat{c}}^\dagger \c2{\hat{d}}^\dagger \c4{\hat{k}} \}
        \{\c3{\hat{l}} \}
        } \\
        &+
        \wick{
        \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}}\}
        \{\c2{\hat{c}}^\dagger \c1{\hat{d}}^\dagger \c3{\hat{k}} \}
        \{\c4{\hat{l}} \}
        }
        +
        \wick{
        \{\c4{\hat{p}}^\dagger \c3{\hat{q}}^\dagger \c2{\hat{s}} \c1{\hat{r}}\}
        \{\c2{\hat{c}}^\dagger \c1{\hat{d}}^\dagger \c4{\hat{k}} \}
        \{\c3{\hat{l}} \}
        } \ket{0}
    \end{aligned} \\
    = \delta_{pl} \delta_{qk} \delta_{rd} \delta_{sc}
    - \delta_{pk} \delta_{ql} \delta_{rd} \delta_{sc}
    - \delta_{pl} \delta_{qk} \delta_{rc} \delta_{sd}
    + \delta_{pk} \delta_{ql} \delta_{rc} \delta_{sd}
\end{align}
Some algebraic extertion will eventually lead to,
\begin{equation}
    - \frac{1}{2} \sum_{klcd} \bra{kl} \ket{cd}
        t^{ab}_{ik} t^{cd}_{jl}.
\end{equation}
A similar computation provides the second $Q_c$ term,
\begin{equation}
    - \frac{1}{2} \sum_{klcd} \bra{kl} \ket{cd}
        t^{cd}_{ik} t^{ab}_{jl}.
\end{equation}
These two terms give us,
\begin{equation}
    Q_c = - \frac{1}{2} \sum_{klcd} \bra{kl} \ket{cd}
        (t^{ab}_{ik}t^{cd}_{jl} - t^{cd}_{ik}t^{ab}_{jl})
\end{equation}
Treating the class d terms gives,
\begin{equation}
    Q_d - \frac{1}{2} \sum_{klcd} \bra{kl} \ket{cd}
        (t^{ac}_{ij}t^{bd}_{kl} - t^{bd}_{ij}t^{ac}_{kl}).
\end{equation}
Combining all the quadratic terms will now yield the same as in 
\autoref{eq:quad_term}, and we can conclude that an algebraic 
derivation of the coupled cluster method is equivalent to the 
configuration space derivation.

\section{The Coupled Cluster Equations}

In general there is a more useful and compact approach that can be used to derive 
the coupled cluster equations, compared to the lengthy derivation of the CCD 
equations above. We start by inserting the coupled cluster wavefunctions into the 
time-independent Schrödinger equation,
\begin{equation}
    \hat{H}_Ne^{\hat{T}}\ket{\Phi_0} = \Delta E e^{\hat{T}}\ket{\Phi_0}.
\end{equation} 
In order to find an expression for the energy and amplitude equations one could 
try to left-project with $\bra{\Phi_0}$. This would propel us in the same 
direction as in the previous section, i.e. \autoref{eq:ccd_energy} and onwards.
Instead, we multipy 
from the left with $e^{-\hat{T}}$ first, and then left-project with $\bra{\Phi_0}$,
\begin{equation}
    \label{eq:cc_energy}
    \begin{gathered}
    \bra{\Phi_0} e^{-\hat{T}}\hat{H}_Ne^{\hat{T}} \ket{\Phi_0} 
    = \bra{\Phi_0} e^{-\hat{T}} \Delta E e^{\hat{T}} \ket{\Phi_0} \\
    \to \bra{\Phi_0} e^{-\hat{T}} \hat{H}_N e^{\hat{T}} \ket{\Phi_0}
    = \Delta E.
    \end{gathered}
\end{equation}
Left-projecting with an excited state, $\bra{\Phi^{ab\dots}_{ij\dots}}$ will give us 
an expression for the corresponding amplitude $t^{ab\dots}_{ij\dots}$,
\begin{equation}
    \label{eq:cc_amplitude}
    \bra{\Phi^{ab\dots}_{ij\dots}} e^{-\hat{T}}\hat{H}_Ne^{\hat{T}}\ket{\Phi_0} = 0.
\end{equation}
Now we have obtained a \emph{non-Hermitian}\footnote{We will show later that this 
non-Hermiticity is somewhat problematic.}, similarity-transformed Hamiltonian,
\begin{equation}
    \mathscr{H} = e^{-\hat{T}}\hat{H}_Ne^{\hat{T}},
\end{equation}
which has $\ket{\Phi_0}$ as right eigenfunction and $E$ as the corresponding eigenvalue.
Importantly, a similarity-transformation will not change the eigenvalue spectrum of the 
operator. This holds for any operator or matrix. 

Proving this is not an exercise in perseverance and toil.
Consider some matrix $A$, and the matrix $C$ which is a square, non-singular 
matrix of the same order as $A$. We say that the matrices $A$ and
$C^{-1}AC$ are \emph{similar}, and $C^{-1}AC$ is the \emph{similarity transformation}
of $A$. If $(\lambda, \vb{x})$ is an
eigenvalue-eigenvector pair of $A$, then $(\lambda, C^{-1}\vb{x})$ is the 
eigenvalue-eigenvector pari for $C^{-1}AC$,
\begin{equation}
    (C^{-1}AC)C^{-1}\vb{x} = C^{-1}A\vb{x} = \lambda C^{-1}\vb{x}.
\end{equation}

A benefit of the similarity-transformed Hamiltionians that we will take advantage of,
is that we can write the operators
more expicitly by applying the Baker-Campbell-Haussdorff
expansion\cite{campbell1897law,baker1905alternants,hausdorff1906symbolische},
\begin{equation}
    \begin{aligned}
        e^{-\hat{B}}\hat{A}e^{\hat{B}}
        =& (1 - \hat{B} + \frac{1}{2}\hat{B}^2 - \frac{1}{3!} + \dots)
        \hat{A} (1 + \hat{B} + \frac{1}{2} + \frac{1}{3!}\hat{B}^3 + \dots) \\
        =& \hat{A} + (\hat{A}\hat{B} - \hat{B}\hat{A}) 
        + \frac{1}{2}(\hat{A}\hat{B}^2 + 2\hat{B}\hat{A}\hat{B} + \hat{B}^2\hat{A})
        \\ &\ + \frac{1}{3!}(
            \hat{A}\hat{B}^3 - 3\hat{B}\hat{A}\hat{B}^2 + 3\hat{B}^2\hat{A}\hat{B}
            - \hat{B}^3\hat{A}
        ) + \dots \\
        =& \hat{A} + [\hat{A}, \hat{B}] + 
        \frac{1}{2}\{
            (\hat{A}\hat{B} - \hat{B}\hat{A})\hat{B}
            -\hat{B}(\hat{A}\hat{B} - \hat{B}\hat{A})     
        \} \\ &\ + \frac{1}{3!} \{
            [(\hat{A}\hat{B} - \hat{B}\hat{A})\hat{B}
            -\hat{B}(\hat{A}\hat{B} - \hat{B}\hat{A})] \hat{B}\\
            &\ \ -\hat{B}[(\hat{A}\hat{B} - \hat{B}\hat{A})\hat{B}
            -\hat{B}(\hat{A}\hat{B} - \hat{B}\hat{A})]
        \} + \dots \\
        =& \hat{A} + [\hat{A}, \hat{B}]
        + \frac{1}{2}[[\hat{A}, \hat{B}], \hat{B}]
        + \frac{1}{3!} [[[\hat{A}, \hat{B}], \hat{B}], \hat{B}] + \dots .
    \end{aligned}
\end{equation}
Applying the Baker-Campbell-Haussdorff expansion to the similarity-transformed 
Hamiltonians yields
\begin{equation}
    \begin{gathered}
    \label{eq:bch_hamiltonian}
    \mathscr{H} = 
    e^{-\hat{T}}\hat{H}_Ne^{\hat{T}} = \hat{H}_N + [\hat{H}_N, \hat{T}]
        + \frac{1}{2}[[\hat{H}_N, \hat{T}], \hat{T}]
        + \frac{1}{3!}[[[\hat{H}_N, \hat{T}], \hat{T}], \hat{T}] \\
        + \frac{1}{4!}[[[[\hat{H}_N, \hat{T}], \hat{T}], \hat{T}], \hat{T}].
    \end{gathered}
\end{equation}
Notice the absence of an ``and so on''-operator ($\dots$) in this expression. The Baker-Campbell-Hausdorff expansion 
for the electronic Hamiltionian, containing at most two-particle interactions, will 
terminate with the four-fold commutator. We will show this shortly.

By applying the generalised Wick's theorem to the Baker-Campbell-Hausdorff 
expansion of the Hamiltonian in \autoref{eq:bch_hamiltonian}, we will be 
confronted with a vast simplification. Applying the generalised Wick's theorm 
to a commutator gives the following 
\begin{equation}
    \label{eq:wick_on_ab}
    [\hat{A}, \hat{B}] = \hat{A} \hat{B} - \hat{B} \hat{A} 
        = \{\hat{A} \hat{B} \} + \{ \wick{\c{\hat{A}} \c{\hat{B}} } \}
        - \{\hat{B} \hat{A} \} - \{ \wick{\c{\hat{B}} \c{\hat{A}} } \},
\end{equation}
where $\hat{A}$ and $\hat{B}$ are normal-ordered operators, each with an even 
number of creation- and annihilation operators\footnote{It is not a coincidence 
that both the normal-ordred Hamiltonian $\hat{H}_N$ and the cluster operator
$\hat{T}$ satisfy these condtions}.
In this expression $\{ \}$ denotes a normal-ordering of the operators inside 
the braces and $\{ \wick{\c{\hat{A}} \c{\hat{B}} } \}$
represents a sum of all normal-ordered products of operators in which there 
are one or more contractions between creation or annihilation operators in 
$\hat{A}$ and those in $\hat{B}$. We must also have that 
\begin{equation}
    \{\hat{A} \hat{B}\} = \{\hat{B} \hat{A}\},
\end{equation}
since the two operators both contain an even number of creation- and
annihilation operators. This means that what remains of \autoref{eq:wick_on_ab}
is simply
\begin{equation}
    [\hat{A}, \hat{B}] = \{ \wick{\c{\hat{A}} \c{\hat{B}} } \}
    - \{ \wick{\c{\hat{B}} \c{\hat{A}} } \}.
\end{equation}

The general $m$-fold cluster operator $T_m$ contains some number of creation
operators $\hat{a}^\dagger, \hat{b}^\dagger \dots$ and hole operators 
$\hat{i}, \hat{j}, \dots$, and the only possible non-zero contractions are 
$\wick{\c{\hat{a}} \c{\hat{b}}^\dagger} = \delta_{ab}$ and 
$\wick{\c{\hat{i}}^\dagger \c{\hat{j}}} = \delta_{ij}$. Moreover, since the 
different cluster operators commute, no nonzero conatractions exist 
between different $\hat{T}_m$ operators. Ergo, in the nested commutators from 
\autoref{eq:bch_hamiltonian}, we only see surviving terms between the Hamiltonian 
$\hat{H}_N$ and one or more of the cluster operators $\hat{T}_m$. This 
accounts for the natural truncation at the four-fold commutator. In fact,
we can rewrite the Baker-Campbell-Haussdorff-expanded similarity-transformed 
Hamiltonian as 
\begin{equation}
    \mathscr{H} = 
    e^{-\hat{T}}\hat{H}_Ne^{\hat{T}} = 
    \hat{H}_N + \wick{\c{\hat{H}_N} \c{\hat{T}}}
    + \frac{1}{2}\wick[offset=1.4em]{\c{\hat{H}_N} \c{\overline{\hat{T}\hat{T}}}}
    + \frac{1}{3!}\wick[offset=1.4em]{\c{\hat{H}_N} 
        \c{\overline{\hat{T}\hat{T}\hat{T}}}}
    + \frac{1}{4!}\wick[offset=1.4em]{\c{\hat{H}_N} 
        \c{\overline{\hat{T}\hat{T}\hat{T}\hat{T}}}},
\end{equation}
where the notation combining a contraction line and a horizontal bar 
indicates a sum over all terms in which the Hamiltonian $\hat{H}_N$ is connected by at 
least one contraction with each of the following cluster operators $\hat{T}$.

Disconnected clusters on the form $\hat{T}_m \hat{T}_n$, which can be found in the 
coupled cluster wavefunction are not present in the Baker-Campbell-Hausdorff expansion 
of the similarity-transformed Hamiltonian. This is true also for the coupled cluster 
amplitude equations, which may be written 
\begin{align}
    \bra{\Phi_0} e^{-\hat{T}}\hat{H}_N e^{\hat{T}} \ket{\Phi_0}
    &= \bra{\Phi_0} \hat{H}_N e^{\hat{T}} \ket{\Phi_0}_C = \Delta E \\
    \bra{\Phi^{ab\dots}_{ij\dots}} e^{-\hat{T}}\hat{H}_N e^{\hat{T}} \ket{\Phi_0}
    &= \bra{\Phi^{ab\dots}_{ij\dots}} \hat{H}_N e^{\hat{T}} \ket{\Phi_0}_C = 0,
\end{align}
where the inclusion of only connected terms is underlined.

The CCSD equations take the form 
\begin{gather}
    \bra{\Phi_0} \hat{H}_N
        \Big(\hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \hat{T}_2\Big)
    \ket{\Phi_0}_C = \Delta E \\
    \bra{\Phi^a_i} \hat{H}_N \Big(
        1 + \hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \frac{1}{3!}\hat{T}_1^3
        + \hat{T}_1\hat{T}_2 + \hat{T}_2
    \Big) \ket{\Phi_0}_C = 0 \\
    \bra{\Phi^{ab}_{ij}} \hat{H}_N \Big(
        1 + \hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \frac{1}{3!}\hat{T}_1^3
        + \frac{1}{4!}\hat{T}_1^4 + \hat{T}_2 + \frac{1}{2}\hat{T}_2^2
        + \hat{T}_1 \hat{T}_2 + \frac{1}{2}\hat{T}_1^2 \hat{T}_2
    \Big) \ket{\Phi_0}_C = 0.
\end{gather}
For CCSDT, the energy expression is the same, while the amplitude equations take
the form 
\begin{gather}
    \bra{\Phi^a_i} \hat{H}_N \Big(
        1 + \hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \frac{1}{3!}\hat{T}_1^3
        + \hat{T}_1\hat{T}_2 + \hat{T}_2 + \hat{T}_3
    \Big) \ket{\Phi_0}_C = 0 \\
    \begin{aligned}
    \bra{\Phi^{ab}_{ij}} \hat{H}_N& \Big(
        1 + \hat{T}_1 + \frac{1}{2}\hat{T}_1^2 + \frac{1}{3!}\hat{T}_1^3
        + \frac{1}{4!}\hat{T}_1^4 + \hat{T}_2 \\ &+ \frac{1}{2}\hat{T}_2^2
        + \hat{T}_1 \hat{T}_2 + \frac{1}{2}\hat{T}_1^2 \hat{T}_2
        + \hat{T}_3 + \hat{T}_1\hat{T}_3
    \Big) \ket{\Phi_0}_C = 0  
    \end{aligned} \\
    \begin{aligned}
    \bra{\Phi^{ab}_{ij}} \hat{H}_N& \Big(
        \hat{T}_2 + \hat{T}_3 + \frac{1}{2}\hat{T}_2^2 + \hat{T}_1\hat{T}_2
        + \hat{T}_2\hat{T}_3 + \hat{T}_1\hat{T}_3 \\
        &+ \frac{1}{2}\hat{T}_1^2\hat{T}_2 + \frac{1}{2}\hat{T}_1\hat{T}_2^2
        + \frac{1}{2} \hat{T}_1^2\hat{T}_3 + \frac{1}{3!} \hat{T}_1^3 \hat{T}_2
    \big) \ket{\Phi_0}_C = 0  
    \end{aligned}
\end{gather}
The coupled cluster with singles and doubles equations are provided
in \autoref{app:ccsd_equations}.

\section{A Variational Formulation of Coupled Cluster}

In the following section we follow the narrative of 
\citeauthor{kvaal2013variational}\cite{kvaal2013variational} closely.

The Coupled Cluster method is very successful in computing energies, but computing other 
expectations values has been a problem. For instance we see that the way we compute the
coupled cluster energy,
\begin{equation}
    E_{\text{CC}} = \mel{\Phi}{e^{-\hat{T}}\hat{H}e^{\hat{T}}}{\Phi},
\end{equation}
is not the same as one would compute the energy of the system variationally,
\begin{equation}
    \label{eq:var_hamiltionian_cc}
    \ev*{\hat{H}}_{\text{var}} = \frac{\mel{\Psi}{\hat{H}}{\Psi}}{\braket{\Psi}}
        = \frac{ \mel{\Phi}{e^{\hat{T}^\dagger} \hat{H} e^{\hat{T}}}{\Phi} }
            {\mel{\Phi}{e^{\hat{T}^\dagger} e^{\hat{T}}}{\Phi}}.
\end{equation}
Moreover, the similarity transformed operators are not Hermitian. This can be 
showed by inference
\begin{equation}
    \hat{T}^\dagger_1 = \left(\sum_{ia}t^a_i\hat{a}^\dagger \hat{i} \right)^\dagger 
        \sum_{ia} (t^a_i)^* \hat{i}^\dagger\hat{a} \neq \hat{T}_1,
\end{equation}
from which it follows that 
\begin{equation}
    \left(e^{-\hat{T}}\hat{H}e^{\hat{T}} \right)^\dagger
        = (e^{\hat{T}})^\dagger\hat{H}(e^{-\hat{T}})^\dagger
        = e^{\hat{T}^\dagger}\hat{H}e^{-\hat{T}^\dagger} 
        \neq e^{-\hat{T}}\hat{H}e^{\hat{T}}.
\end{equation}
Variational computations as in \autoref{eq:var_hamiltionian_cc} has been attempted 
by Cizek\cite{vcivzek1966correlation} and Fink\cite{fink1974new}.
Regrettably, the coupled cluster exponential 
wavefunction is not a variationally optimal wavefunction, as it give rise to
series expansions in the 
numerator and denominator in the expression for the variational expectation value. 
For a general operator $\hat{O}$, we have
\begin{equation}
    \begin{aligned}
        \label{eq:variational_exp_val_cc}
        \ev*{\hat{O}}_{\text{var}} &=\frac{ \mel{\Psi}{\hat{O}}{\Psi} }{\braket{\Psi}} 
            = \frac{ \mel{\Phi}{e^{\hat{T}^\dagger} \hat{O} e^{\hat{T}}}{\Phi} }
                {\mel{\Phi}{e^{\hat{T}^\dagger} e^{\hat{T}}}{\Phi}} \\
            &= \frac{
                \mel{\Phi}{
                [1 + \hat{T}^\dagger + \frac{1}{2!}(\hat{T}^\dagger)^2 + \frac{1}{3!}(\hat{T}^\dagger)^3 + \dots]
                \hat{O} 
                [1 + \hat{T}+ \frac{1}{2!}\hat{T}2 + \frac{1}{3!}\hat{T}^3 + \dots]
                }{\Phi}
                }{
                \mel
                {\Phi}
                {
                [1 + \hat{T}^\dagger + \frac{1}{2!}(\hat{T}^\dagger)^2 + \frac{1}{3!}(\hat{T}^\dagger)^3 + \dots]
                [1 + \hat{T} + \frac{1}{2!}\hat{T}^2 + \frac{1}{3!}\hat{T}^3 + \dots]
                } 
                {\Phi}
                }.
    \end{aligned}
\end{equation}
In contrast with the expansions of the coupled cluster amplitude equations, which 
truncates naturally after products of four $\hat{T}$ operators, the expansions for 
$e^{\hat{\hat{T}}^\dagger}$ and $e^{\hat{T}}$ terminates only if the total excitation 
level represented by a product of $\hat{T}$ operators exceed the number of electrons in 
the wavefunctions. This means that the number of terms and the computational effort
required to compute expectation values in this way is usually very high.

An idea is to simply use a similar expression to the coupled cluster energy
expression
\begin{equation}
    \ev*{O}_{\text{Goldstone}} = \mel{\Phi}{e^{-\hat{T}}\hat{O}e^{\hat{T}}}{\Phi}.
\end{equation}
The problem with this expression, as well as with \autoref{eq:variational_exp_val_cc},
is that none of them conform with the Hellmann-Feynman theorem and the problem remains,
the coupled cluster energy is arrived at non-variationally, and is therefore non-stationary.

\subsection{The Hellmann-Feynman Theorem}

The Hellmann-Feynmann\cite{feynman1939forces} theorem relates the first order change of total energy 
with respect to a parameter to the first order change of the Hamiltonian with 
respect to the same parameters,
\begin{equation}
    \frac{d E}{d\alpha}\Big\lvert_{\alpha=0} = 
    \frac{\partial}{\partial t}\mel{\Psi_\alpha}{\hat{H}}{\Psi_\alpha},
\end{equation}
where $\Psi$ is the exact state, variationally determined from the Hamiltonian of the 
system, and $\Psi_\alpha = N(\Psi + \alpha \delta\Psi)$ is a variation of this state,
implicitly dependent on the parameter $\alpha$.

\begin{tcolorbox}[width=\textwidth,colback={white},title={Proof of the Hellmann-Feynman theorem},colbacktitle=pink,coltitle=black]
    Using the following conditions,
    \begin{gather}
        \hat{H}_\lambda \ket{\psi_\lambda} = E_\lambda \ket{\psi_\lambda} \\
        \braket{\psi_\lambda} = 1,
    \end{gather}
    we prove 
    \begin{equation}
        \frac{\partial E_\lambda}{\partial \lambda} 
            = \bra{\psi_\lambda} \frac{\partial \hat{H}}{\partial \lambda} \ket{\psi_\lambda}.
    \end{equation}
    Now,
    \begin{equation}
        E_\lambda =  \bra{\psi_\lambda} \hat{H} \ket{\psi_\lambda}
        = \int \psi_\lambda \hat{H} \psi^*_\lambda dr
    \end{equation}
    whence,
    \begin{equation}
        \begin{aligned}
        \frac{\partial E_\lambda}{\partial \lambda}
        &= \int \psi_\lambda \frac{\hat{H}}{\partial\lambda} \psi^*_\lambda dr
        + \int \frac{\psi_\lambda}{\partial\lambda} \hat{H} \psi^*_\lambda dr
        + \int \psi_\lambda \hat{H} \frac{\psi^*_\lambda}{\partial\lambda} dr \\
        &= \int \psi_\lambda \frac{\hat{H}}{\partial\lambda} \psi^*_\lambda dr
        + E_\lambda \int \frac{\psi_\lambda}{\partial\lambda}  \psi^*_\lambda dr
        + E_\lambda \int \psi_\lambda \frac{\psi^*_\lambda}{\partial\lambda} dr \\
        &= \int \psi_\lambda \frac{\hat{H}}{\partial\lambda} \psi^*_\lambda dr
        + E_\lambda \frac{\partial }{\partial \lambda} \braket{\psi_\lambda}
        = \bra{\psi_\lambda} \frac{\partial \hat{H}}{\partial \lambda} \ket{\psi_\lambda}.
        \end{aligned}
    \end{equation}
\end{tcolorbox}

By treating an observable of the system as a perturbation of the Hamiltonian,
\begin{equation*}
    \hat{H}'(\alpha) = \hat{H} + \alpha\hat{V},
\end{equation*}
the Hellman-Feynman theorem provides us with a way to evaluate the expected value of 
this observable if we have the exact wavefunction and energy,
\begin{equation}
    \frac{d E}{d\alpha}\Big\lvert_{\alpha=0}
    = \frac{\partial}{\partial \alpha} 
        \mel{\Psi_\alpha}{\hat{H} + \alpha\hat{O}}{\Psi_\alpha}
    = \ev*{\hat{O}}.
\end{equation}

The problem with some computational techniques, like the coupled cluster method,
is that the final energy is not variationally determined (non-stationary), 
and we cannot invoke the Hellmann-Feynman theorem to simplify computation of 
molecular properties. At first, it would appear that one would have to resort to 
a more cumbersome computation, like the expansion of clustes operators above 
(\autoref{eq:variational_exp_val_cc}). But fortunately, there exists a way to 
reformulate the energy function of a non-variational wavefunction in such a way that 
the energy is stationary with respect to the variables of the new formulation.

Consider an energy that depends on two sets of parameters. The parameter $\alpha$ which 
describes a perturbation and the parameters $\alpha$ which describe the wavefunction. 
The optimal energy $E(\alpha)$ is obtained by an optimised set of parameters $\vb{\lambda}^*$,
which are inserted into the energy function
\begin{equation}
    E(\alpha) = E(\alpha, \vb{\lambda}^*),
\end{equation}
the values for $\alpha$ and $\vb{\lambda}^*$ are obtained as the solution to some set of 
equations
\begin{equation}
    \label{eq:nonvar_cond_HellF}
    \vb{f}(\alpha, \vb{\lambda}^*) = 0 \quad \forall \alpha,
\end{equation}
For \emph{variational} wavefunctions, this condition corresponds to the stationarity requirement,
\begin{equation}
    \label{eq:stat_cond_HellF}
    \frac{\partial E_{\text{var}}(\alpha, \vb{\lambda})}
    {\partial \lambda}\Big\lvert_{(\vb{\lambda} = \vb{\lambda}^*)}
    = 0 \quad \forall \alpha,
\end{equation}
but not for \emph{non-variational} wavefunctions. Writing out this derivative yields,
\begin{equation}
\label{eq:total_derivative_HellF_energy}
\frac{dE(\alpha)}{d\alpha} 
= \frac{dE(\alpha, \vb{\lambda})}{d\alpha}\Big\lvert_{(\vb{\lambda} = \vb{\lambda}^*)}
= \frac{\partial E(\alpha, \vb{\lambda})}{\partial\alpha}\Big\lvert_{(\vb{\lambda} = \vb{\lambda}^*)}
+ \frac{\partial E(\alpha, \vb{\lambda})}{\partial\vb{\lambda}}\Big\lvert_{(\vb{\lambda} = \vb{\lambda}^*)}
\cdot
\frac{\partial \vb{\lambda}}{\partial}\alpha\Big\lvert_{(\vb{\lambda} = \vb{\lambda}^*)}.
\end{equation}
For a variational wavefunction, the last term will vanish due to the stationarity condition in 
\autoref{eq:stat_cond_HellF}. This would leave us with 
\begin{equation}
    \frac{d E_{\text{var}}(\alpha)}{d\alpha} 
    = \frac{\partial E(\alpha, \vb{\lambda})}{\partial\alpha}\Big\lvert_{(\vb{\lambda} = \vb{\lambda}^*)},
\end{equation}
i.e. that the total derivative corresponds to the partial derivative. This means that if the variational 
energy corresponds to an expectation value 
$E_{\text{var}}(\alpha, \vb{\lambda}) = \mel{\vb{\lambda}}{\hat{H}(\alpha)}{\vb{\lambda}}$, and the 
perturbed system is described by the Hamiltonian $\hat{H}(\alpha) = \hat{H} + \alpha\hat{V}$, we 
recover the presumed expression
\begin{equation}
\frac{dE(\alpha, \vb{\lambda})}{d\alpha}\Big\lvert_{(\alpha = 0)},
\end{equation}
in accordance with first-order perturbation theory and the Hellmann-Feynmann theorem.

But if we look at nonvariational energies, \autoref{eq:total_derivative_HellF_energy},
will not simplify to just the partial derivative, since the stationarity condition does not hold. 
What we do is replace the now nonvariational function $E(\alpha, \vb{\lambda})$ by a new function 
$L(\alpha, \vb{\lambda}, \bar{\vb{\lambda}})$ with a stationary point 
$(\vb{\lambda}^*, \bar{\vb{\lambda}}^*)$ that satisfies the nonvariational condition
\autoref{eq:nonvar_cond_HellF}
, and whose values at this point correspond to the optimal
energy. Indeed, we apply Langrange's method of undetermined multipliers, by regarding the 
energy $E(\alpha, \vb{\lambda})$ a an \emph{unconstrained} optimisation problem, but 
subject to the constraints of the variational parameters $\lambda$, which satisfy
\autoref{eq:noncanonical_hf_eqns};
\begin{equation}
    \label{eq:langrange_method}
    L(\alpha, \vb{\lambda}, \bar{\vb{\lambda}})
    = E(\alpha, \vb{\lambda}) + \bar{\vb{\lambda}} \cdot \vb{f}(\alpha, \vb{\lambda}).
\end{equation}
A necessary condition for the optimum Lagrange multipliers $\bar{\vb{\lambda}}^*$ to 
be unique is that the the Jacobian of $\vb{f}$, 
$\mathscr{J} \equiv \partial \vb{f}(\alpha, \vb{\lambda})/\partial \lambda$ is non-singular 
and invertible.

\subsection{The Lagrangian Formulation of Coupled Cluster}

As we outlined in the previous section, the solution to making the coupled cluster 
theory into a variational theory is to find a set of equations which are zero for a set
of parameters (\autoref{eq:nonvar_cond_HellF}). These parameters should in turn provide the optimal energy by insertion 
into the expression for energy. Luckily, Helgaker and 
Jørgensen\cite{helgaker1988analytical,helgaker1989configuration} had the insight to 
realise that we are already given such a set of parameters and equations in the 
formulation of coupled cluster, namely the amplitudes and the amplitude equations
respectively. The Hellmann-Feynman theorem will be baked into the very definition 
of such a expectation value functional,
\begin{equation}
    \ev*{\hat{O}}_{\text{H-F}} 
        = \mathscr{L}_{\text{O}}(\alpha^*, \vb{\lambda}^*, \bar{\vb{\lambda}}^*)
        = E(\alpha^*, \vb{\lambda}^*, \bar{\vb{\lambda}}^*)
        + \bar{\vb{\lambda}}^* \cdot \vb{f}(\alpha^*, \vb{\lambda}^*).
\end{equation}
This equation is essentially a restatement of \autoref{eq:langrange_method}, with  
the optimal parameters.

More specifically, we simplify the notation in some measure and state the coupled
cluster energy Lagrangian,
\begin{equation}
    \label{eq:cc_energy_lagrangian}
    \mathscr{L}_{\hat{H}}(t, \lambda) 
        = \mel{\Phi}{e^{-\hat{T}}\hat{H}e^{\hat{T}}}{\Phi}
        + \sum_\mu \lambda_\mu \mel{\Phi}{X_\mu^\dagger e^{-\hat{T}} \hat{H} e^{\hat{T}}}{\Phi}
        = \mel{\Phi}{(1 + \Lambda)e^{-\hat{T}}\hat{H}e^{\hat{T}} }{\Phi},
\end{equation}
where we have introduced $\Lambda = \sum_\mu X^\dagger_\mu$. Here, $X^\dagger_\mu$ is a
general relaxation operator, for instance $\hat{X}_1^\dagger = \{\hat{i}\hat{a}^\dagger\}$.
So $\Lambda$ written out is 
\begin{equation}
    \label{eq:capital_lambda}
    \Lambda = \sum_{ia}\lambda^i_a \hat{i}^\dagger \hat{a}
    + \frac{1}{2!^2}\sum_{ijab} 
        \lambda^{ij}_{ab} \hat{i}^\dagger \hat{a} \hat{j}^\dagger \hat{a}
    + \dots
\end{equation}

The coupled cluster Lagrangian in \autoref{eq:cc_energy_lagrangian} can be rewritten 
with the use of density operators,
\begin{equation}
    \mathscr{L}_{\hat{H}}(t, \lambda) = \tr\{\hat{H}\hat{\rho}\}, \quad
    \hat{\rho} = e^{\hat{T}}\outerproduct{\Phi}(1 + \Lambda)e^{-\hat{T}},
\end{equation}
in a pure state description. We check to see if the attributes of the density operator 
endures,
\begin{align*}
    \hat{\rho}^2 &= 
        e^{\hat{T}}\outerproduct{\Phi}(1 + \Lambda)e^{-\hat{T}}
        e^{\hat{T}}\outerproduct{\Phi}(1 + \Lambda)e^{-\hat{T}} \\
        &= 
        e^{\hat{T}}\outerproduct{\Phi}(1 + \Lambda)e^{-\hat{T}}
        + \cancelto{0}{e^{\hat{T}}\ket{\Phi}
        \mel{\Phi}{\Lambda}{\Phi}
        \bra{\Phi}e^{-\hat{T}}} 
        = \hat{\rho} \\
    \Tr{\hat{\rho}} &= \sum_{p} \bra{\phi_p}e^{\hat{T}}\outerproduct{\Phi}(1 + \Lambda)e^{-\hat{T}} \ket{\phi_p}
    = 1 \\
    (\hat{\rho})^\dagger &= e^{-\hat{T}^\dagger}(1 + \Lambda^\dagger)
    \dyad{\Phi}e^{\hat{T}^\dagger} \neq \hat{\rho}.
\end{align*}
We see that another problem has 
presented itself, as the density operator is non-Hermitian. This leads us to the 
\emph{bivariational},
Hellmann-Feynman conforming framework developed by 
Arponen\cite{arponen1983variational}.


\subsection{The Bivariational Principle}

Arponen approached the coupled cluster problem by employing a very general form 
of the variational principle called the bivariational principle. Letting $\hat{H}$,
be a (possibly non-Hermitian) operator over Hilbert space $\mathcal{H}$, the bivariational 
expectation functional is defined by 

\begin{equation}
    \label{eq:bivariational_principle}
    \mathscr{E}_{\hat{H}} : \mathcal{H}' \times \mathcal{H} \to \mathbb{C},
    \quad
    \mathscr{E}_{\hat{H}}(\tilde{\Psi}, \Psi) 
        = \frac{\mel*{\tilde{\Psi}}{\hat{H}}{\Psi}}{\braket*{\tilde{\Psi}}{\Psi}}
        = \frac{\tr{\hat{H}\hat{\rho}}}{\tr{\rho}}.
\end{equation}
The main difference from the traditional and usual variational principle is that 
$\bra*{\tilde{\Psi}}$ and $\ket{\Psi}$ are treated as independent elements of the
Hilbert space, and $\hat{\rho} = \ket{\Psi}\bra*{\tilde{\Psi}}$.
Since the Hamiltonian $\hat{H}$ is Hermitian, $\bra*{\tilde{\Psi}}$ and $\ket{\Psi}$
can be treated 
independently in the derivations of stationary conditions. However, we must have that
$\bra*{\tilde{\Psi}}$ and $\ket{\Psi}$ are left- 
and right eigenvalues of the Hamiltonian, with the same eigenvalue
\begin{equation}
    \hat{H}\ket{\Psi} = E\ket{\Psi}, \quad \bra*{\tilde{\Psi}}\hat{H} = \bra*{\tilde{\Psi}}E.
\end{equation}
We alos have that $E = \mathcal{E}_{\hat{H}}(\tilde{\Psi}, \Psi)$ is the value at the
stationary point.

We transition to coupled cluster theory by inserting the coupled cluster exponential 
wave functions, $\ket{\Psi} = e^{\hat{T}}\ket{\Phi}$ and 
$\bra*{\tilde{\Psi}} = \bra*{\Phi}e^{\tilde{T}}$, where 
$\tilde{T} = \tilde{t}X^\dagger$ are some general relaxation operator. The 
bivariational functional becomes 
\begin{equation}
    \label{eq:bivariational_principle_cc}
    \mathscr{E}_{\hat{H}} 
    = \frac{\mel{\Phi}{e^{\tilde{T}}\hat{H}e^{\hat{T}}}{\Phi}}
        {\mel{\Phi}{e^{\tilde{T}}e^{\hat{T}}}{\Phi}}
\end{equation}
Varying this functional over all untruncated excitation and relaxation operators,
$\hat{T}$ and $\tilde{T}$, is the foundation of variational coupled cluster
theory\cite{bartlett1988expectation}, which is equivalent to full configuration 
interaction within the given single-particle basis set.

Now we wish to show that Arponen's framework corresponds to that of
\citeauthor{helgaker1988analytical}. We simplify the expression by performing 
a variable change 
$(\hat{T}, \tilde{T}) \to (\hat{T}, \hat{S})$, where $S$ is a new relaxation operator.
We start by introducing 
\begin{equation}
    \bra{\omega} = \frac{\bra*{\tilde{\Psi}}e^{\hat{T}}}{\braket*{\tilde{\Psi}}{\Psi}},
\end{equation}
which satisfies $\braket{\omega}{\Phi} = 1$, implying that there must exist an operator
$\hat{S} = sX^\dagger$, such that $\bra{\omega} = \bra{\Phi}e^{\hat{S}}$. Then we 
can write,
\begin{equation}
    \begin{gathered}
        \frac{\bra*{\tilde{\Psi}}e^{\hat{T}}}{\braket*{\tilde{\Psi}}{\Psi}}
        = \bra{\Psi} e^{\hat{S}},
        \to \bra*{\tilde{\Psi}} 
        = \braket*{\tilde{\Psi}}{\Psi}\bra{\Phi}e^{\hat{S}}e^{-\hat{T}}.
    \end{gathered}
\end{equation}
This enables us to rewrite the bivariational principle (\autoref{eq:bivariational_principle_cc})
to 
\begin{equation}
    \label{eq:bivar_lagrang_equal}
    \mathscr{E}_{\hat{H}} = \mel{\Phi}{e^{\hat{S}}e^{-\hat{T}}\hat{H}e^{\hat{T}}}{\Phi},
\end{equation} 
which is an exact functional if $\hat{T}$ and $\hat{S}$ are not truncated. Comparing this 
expression to the coupled cluster Lagrangian in \autoref{eq:cc_energy_lagrangian}, we can only
conlude that our seemingly serendipitous algebra acrobatics has revealed that
$e^{\hat{S}} = 1 + \Lambda$. Truthfully, we have strong indication the coupled cluster bivariational 
functional (\autoref{eq:bivariational_principle_cc}) is the same as the the 
coupled cluster Lagrangian (\autoref{eq:cc_energy_lagrangian})\footnote{Pruning 
the expression in \autoref{eq:bivar_lagrang_equal} to only include single and double 
excitations will yield Arponen's \emph{extended coupled cluster} (ECC) 
method\cite{arponen1987extended}.
This method has seen little use due to it's complexity.}.

First order conditions of the coupled cluster energy Lagrangian in
\autoref{eq:cc_energy_lagrangian} gives us a new set of amplitude equations,
\begin{align}
    \label{eq:lagrangian_tau_amplitude_eqns}
    \frac{\partial}{\partial \lambda_\mu} \mathscr{L}(t, \lambda)
    &= \mel{\Phi_{X_\mu}}{e^{-\hat{T}}\hat{H}e^{\hat{T}} }{\Phi} = 0 \\
    \label{eq:lagrangian_lambda_amplitude_eqns} 
    \frac{\partial}{\partial t_\mu} \mathscr{L}(t, \lambda)
    &= \mel{\Phi}{(1 + \Lambda)e^{-\hat{T}}[\hat{H}, X_\mu]e^{\hat{T}} }{\Phi} = 0.
\end{align}
Under constrained optimisation all partial derivatives vanish at the same point,
\begin{equation}
    \frac{\partial \mathscr{L}}{\partial \lambda_\mu}\Big\lvert_{t=t^*} = 0,
    \quad
    \frac{\partial \mathscr{L}}{\partial t_\mu}\Big\lvert_{(t,\lambda)=(t^*,\lambda^*)} = 0,
    \quad \forall X_\mu.
\end{equation}
What we have arrived at are amplitude equations both for the ``bra part'' and the 
``ket part'' of the problem, which we refer to as the $\lambda$ amplitude equations
(\autoref{eq:lagrangian_lambda_amplitude_eqns}) and 
the $\tau$ amplitude equations
(\autoref{eq:lagrangian_lambda_amplitude_eqns}), respectively. Notice that the $\tau$ amplitude equations 
only depend on $\tau$, whilst the $\lambda$ equations depend both on $\tau$ and $\lambda$.
This means that the $\tau$ amplitude equations are solved iteratively first, and then 
the $\lambda$ amplitudes are solved similarly.
The full equations are given in \autoref{app:ccsd_equations}.

The benefit of going through the exercise of reformulating the coupled cluster framework entirely
is that it is now possible to define operators,
\begin{align}
    \rho^q_p &= \mel*{\tilde{\Psi}}{c^\dagger_p c_q}{\Psi} \\
    \rho^{qs}_{pr} &= \mel*{\tilde{\Psi}}{c^\dagger_p c^\dagger_q c_s c_r}{\Psi},
\end{align}
which we can use to compute expectation values of operators,
$\ev*{\hat{A}} = \tr{\rho\hat{A}}$. Here, $\hat{A}$ is a general one- and two-body 
operator,
\begin{equation}
    \hat{A} = 
        a^p_qc^\dagger_p c_q 
        + \frac{1}{4}a^{pr}_{qs}c^\dagger_p c^\dagger_q c_s c_r.
\end{equation}
Then we have,
\begin{equation}
    \ev*{\hat{A}} = \mel*{\tilde{\Psi}}{\hat{A}}{\Psi}
        = a^p_q \mel*{\tilde{\Psi}}{c^\dagger_p}{\Psi}
        + \frac{1}{4} a^{pr}_{qs}
            \mel*{\tilde{\Psi}}{c^\dagger_p c^\dagger_q c_s c_r}{\Psi}
        = a^p_q \rho^q_p + \frac{1}{4} a^{pr}_{qs} \rho^{qs}_{pr}.
\end{equation}

\section{Generalisation in Time}

Here, we will outline a derivation of the orbital-adaptive time-dependent coupled cluster 
method, a generalisation in time for the coupled cluster method put forth by 
Kvaal\cite{kvaal2012ab}. The method inherits both size-extensivity and size-consistency from 
the coupled cluster method and is a hierarchy of approximations to the multi-configurational 
time-dependent Hartree method for fermions.

We now define a time-dependent generalisation of the bivariational principle
(\autoref{eq:bivariational_principle}). This is similar to the usual time-dependent 
action functional and the time-dependent Schrödinger equation can be recovered from 
it,
\begin{equation}
    \label{eq:time_dependent_action_functional}
    \mathcal{S}[{\Psi}'(\cdot), \Psi(\cdot)]
        = \int_0^T dt \frac{\mel{{\Psi}'(t)}{\left(
            i\hbar \frac{\partial}{\partial t} - \hat{H}
        \right)}{\Psi(t)}}{\braket{{\Psi}'(t)}{\Psi(t)}}.
\end{equation}
Functionals like these are quite common throughout the historical literature on 
quantum mechanics, appearing as early as in Dirac\cite{dirac1930principles}. The 
integral of the functional depends on all history for the system in question. 
By applying the principle of least action, 
requiring that the functional is stationary, $\delta\mathcal{S} = 0$, under all variations 
of $\bra{{\Psi}'}$ and $\ket{\Psi}$ and vanishing in the endpoints $t=0$ and
$t=T$, gives us the following conditions
\begin{equation*}
    i\hbar\frac{\partial}{\partial t} \ket{\Psi(t)} = \hat{H}\ket{\Psi(t)}
    \quad -i \hbar \frac{\partial}{\partial t} \bra{{\Psi}'} = \bra{{\Psi}'}\hat{H}.
\end{equation*}
By a specific parametrisation of $\bra*{{\Psi}'}$, such that 
$\braket{{\Psi}'}{\Psi} = 1$ we have indeed recovered the familiar 
time-dependent Schrödinger euqation.

Instead of venturing down this path, we will presuppose that it is possible
that $\braket{{\Psi}'}{\Psi} \neq 1$. Indeed, that $\bra{{\Psi}'}$ 
and $\ket{\Psi}$ are independent. This means we must enact
Arponen's\cite{arponen1983variational} Hellmann-Feynman conforming bivariational 
principle, where the energy expectation functial is given by 
\begin{equation}
    \label{eq:bivar_energy_expectation}
    \mathscr{E}_{\hat{H}}(\tau', \tau, \Phi', \Phi)
    = \frac{\mel*{\Phi'}{e^{\hat{T}'}\hat{H}e^{\hat{H}}}{\Phi}}
    {\mel*{\Phi'}{e^{\hat{T}'}e^{\hat{T}}}{\Phi}}.
\end{equation}
We perform a variable change $(T', T)\to(\lambda, T)$, similarly to the section above, 
and introduce
\begin{equation}
    \bra*{\tilde{\Psi}} = \frac{\bra{\Psi'}}{\braket{\Psi'}{\Psi}}
    = \bra*{\tilde{\Phi}} (1 + \Lambda) e^{\hat{T}},
\end{equation}
Where $\Lambda$ is the same as in \autoref{eq:capital_lambda}.
The bivariational energy expectation functional in \autoref{eq:bivar_energy_expectation}
now becomes
\begin{equation}
    \mathscr{E}_{\hat{H}}(\lambda, \tau, \tilde{\Phi}, \Phi)
    = \mel*{\tilde{\Phi}}{(\hat{1} + \lambda)e^{-\hat{T}}\hat{H}e^{\hat{T}} }{\Phi}.
\end{equation}
Disregarding the differene in $\tilde{\Phi}$ and $\Phi$, this expression is the 
same as the coupled cluster expectation functional in \autoref{eq:bivar_lagrang_equal},
where the interpretation is that the $\lambda$s are Lagrange multipliers 
for a constrained energy minimisation problem. This is not the interpretation 
here, as the $\lambda$-part of the problem is seen as equally important.

We are now assuming biorthogonality in orbitals, $\braket*{\tilde{\phi}_p}{\phi_q} = \delta_{pq}$, but 
independence of bra and ket states otherwise. For a full Slater determinant state 
consisting of these orbitals, we have 
\begin{equation}
    \braket*{\tilde{\phi}_{p_1}\dots \tilde{\phi}_{p_n}}{\phi_{q_1}\dots\phi_{q_n}}
    =\delta_{p_q q_1}\dots \delta_{p_N q_N}.
\end{equation}
The second quantised operators ascociated with these Slater determinants are defined through
\begin{equation}
    \ket{\phi_{q_1}\dots\phi_{q_n}} \equiv c^\dagger_{p_1}\dots c^\dagger_{p_N}\ket{ }
    \quad
    \bra*{\tilde{\phi}_{p_1}\dots \tilde{\phi}_{p_n}} = \bra{ } \tilde{c}_{q_N} \dots \tilde{c}_{q_1}.
\end{equation}
These creation- and annihilation operators can furtermore be defined by,
\begin{equation}
    c_p^\dagger = \int \phi_p(\vb{x}) \Psi^\dagger(\vb{x})d\vb{x}
    \quad
    \tilde{c}_p = \int \tilde{\phi}_p(\vb{x}) \Psi(\vb{x})d\vb{x},
\end{equation}
where $\Psi^\dagger$ and $\Psi$ are field creation- and annihilation operators. This particular
definition may seem like an unecessary and stringent tangent, but its purpose is to underline
the dependence of the cluster operator $\hat{T}$ not only on the amplitudes
$\tau$, but also on the orbitals. This is an important point to emphasise, in ``ordinary''
coupled cluster theory, one thinks of the amplitudes as the only unknowns while keeping the 
orbitals fixed and the dependence on $\tau$ are 1-1. This becomes very important when one computes derivatives with 
respect to time of the cluster operators $\hat{T}$.
Furthermore, the second quantised operators are subject to the anticommutator relation,
\begin{equation}
    \{\tilde{c}_p, c_q^\dagger \} \equiv \tilde{c}_p c_q^\dagger + c_q^\dagger\tilde{c}_p
    \stackrel{!}{\equiv} \braket*{\tilde{\phi}_p}{\phi_q} = \delta_{pq}.
\end{equation}

The time-dependent action(-like) functional (\autoref{eq:time_dependent_action_functional}) 
defining the Schrödinger dynamics becomes,
\begin{equation}
    \begin{aligned}
        \label{eq:oatdcc_functional}
        \mathcal{S}[\lambda, \tau, \tilde{\Phi}, \Phi]
        &= \int_0^T \mel{\tilde{\Phi}}
            {(1 + \Lambda)e^{-\hat{T}}\left(\frac{\partial}{\partial t} - \hat{H} \right)e^{\hat{T}}} 
            {\Phi} dt \\ 
        &= \int_0^T i\hbar\mel{\tilde{\Phi}}
        {(1 + \Lambda)e^{-\hat{T}}\frac{\partial}{\partial t}e^{\hat{T}}}
        {\Phi} dt
        - \mathscr{E}_{\hat{H}}(\lambda, \tau, \tilde{\Phi}, \Phi).
    \end{aligned} 
\end{equation}
Herein, it is necessary to compute 
$\frac{\partial}{\partial t}\ket{\Psi} = \frac{\partial}{\partial t}e^{\hat{T}}\ket{\Phi}$.
In order to accomplish this we indroduce the expansion,
\begin{equation}
    \ket{\Psi} = \Pi\ket{\Psi} = \ket{\Phi} + \sum_\mu A^\mu \ket{\Phi_\mu}, \quad
    A^\mu = A^\mu(\tau) = \mel*{\tilde{\Phi}^\mu}{e^{\hat{T}}}{\Phi}
\end{equation}
Here we write $\Phi$ as the reference Slater determinant and $\Phi_\mu$ are all the other 
excited Slater determinant. The coefficients $A^\mu$ do not depend explicitly on the 
orbitals, only on the the amplitudes $\tau$. It is important to note that this summation is not truncated,
regardless of the truncation of the cluster amplitudes at some excitation level $\tau^\mu$.
To further the matter, we have introduced a projection operator,
\begin{equation}
    \Pi \equiv \outerproduct*{\Phi}{\tilde{\Phi}} 
    + \sum_\mu \outerproduct*{\Phi_\mu}{\tilde{\Phi}^\mu}.
\end{equation}
The projection operator has the following properties,
\begin{equation}
    \begin{gathered}
        \Pi \ket{\Psi} = \ket{\Psi}, \quad \bra{\Psi'}\Phi = \bra{\Psi'}, \\
        \mel{\Psi'}{\hat{H}}{\Psi} = \mel{\Psi'}{\Pi\hat{H}\Pi}{\Psi},
        \quad \Pi^\dagger \neq \Pi
    \end{gathered}
\end{equation}
and unless orbitals are complete we have $\Pi\hat{H}\Pi \neq \hat{H}$.

Now we compute the time derivative of a Slater determinant,
\begin{equation*}
    \begin{aligned}
        \frac{\partial}{\partial t} c^\dagger_{p_1}c^\dagger_{p_2}\dots c^\dagger_{p_N}\ket{ }
        &= \dot{c}^\dagger_{p_1} c^\dagger_{p_2}\dots c^\dagger_{p_N} \ket{ }
        + c^\dagger_{p_1} \dot{c}^\dagger_{p_2}\dots c^\dagger_{p_N}\ket{ } + \dots \\
        &= \left(\sum_q \dot{c}^\dagger_q \tilde{c}_q \right)
        c^\dagger_{p_1}c^\dagger_{p_2}\dots c^\dagger_{p_N}\ket{ }
        = \hat{D}c^\dagger_{p_1}c^\dagger_{p_2}\dots c^\dagger_{p_N}\ket{ },
    \end{aligned}
\end{equation*}
where we have defined the operator $\hat{D}$ by 
\begin{equation}
    \hat{D} = \sum_q \dot{c}^\dagger_q \tilde{c}_q,
\end{equation}
which depends explicitly on orbitals, unlike $\hat{H}$. The derivative of the exact 
wavefunction becomes,
\begin{equation}
    \begin{aligned}
        \frac{\partial}{\partial t}\ket{\Psi} 
        &= \sum_\mu \left(\frac{\partial}{\partial t}A^\mu (\tau)\right)\ket{\Phi_\mu}
         + \hat{D}\ket{\Phi} + \sum_\mu A^\mu (\tau) \hat{D} \ket{\Phi_\mu} \\
        &= \left(
            \sum_\nu \dot{\tau}^\nu \frac{\partial}{\partial \tau^\nu} + \hat{D}
        \right)\ket{\Psi}
        = \left(\sum_\nu \dot{\tau}^\nu X_\nu + \hat{D}\right)\ket{\Psi}.
    \end{aligned}
\end{equation}
The time-derivative part of the functional (\autoref{eq:oatdcc_functional}) integrand
becomes,
\begin{equation}
    \begin{aligned}
        i\hbar&\mel{\tilde{\Phi}}
            {(1 + \Lambda)e^{-\hat{T}}\frac{\partial}{\partial t}e^{\hat{T}}}
        {\Phi} \\
        &= i\hbar\mel{\tilde{\Phi}}
            {
            \left(
                1 + \sum_\mu \lambda_\mu \tilde{X}^\mu     
            \right)
            e^{-\hat{T}}
            \left(
                \sum_\nu \dot{\tau}^\nu X_\nu + \hat{D}
            \right)
            e^{\hat{T}}
            }
        {\Phi} \\
        &= i\hbar \sum_\mu \lambda_\mu \dot{\tau}^\mu
        + i\hbar \mel{\tilde{\Phi}}
            {(1 + \Lambda)e^{-\hat{T}}\Pi\hat{D}\Pi e^{\hat{T}}}
        {\Phi},
    \end{aligned}
\end{equation}
where the projected operator $\Pi\hat{D}\Pi$ is given by 
\begin{equation}
    \Pi\hat{D}\Pi = \hat{D}_0 
    \equiv 
    \sum_{pq}\braket*{\tilde{\phi}_p}{\dot{\phi}_q}c^\dagger_p \tilde{c}_q.
\end{equation}
Finally we obtain a new expression for the functional in \autoref{eq:oatdcc_functional}
\begin{align}
    \label{eq:oatdcc_functional_final}
    \mathcal{S}[\lambda, \tau, \tilde{\Phi}, \Phi] 
    &= \sum_0^T 
    i\hbar\sum_\mu \lambda_\mu \dot{\tau}^\mu 
    - \mathcal{E}_{\hat{H} - i \hbar\hat{D}_0}[\lambda, \tau, \tilde{\Phi}, \Phi] dt \\
    \label{eq:einsum_density_operator_functional}  
    &= \int_0^T i\hbar \lambda_\mu \dot{\tau}^\mu 
    + \rho^q_p (h^p_q - i\hbar\eta^p_q) + \frac{1}{4}\rho^{qs}_{pr} u^{pr}_{qs}dt,
\end{align}
where
\begin{align} 
    \rho^q_p &= \rho^q_p(\lambda, \tau) 
    \equiv \mel{\tilde{\Phi}}
    {(1 + \Lambda)e^{-\hat{T}}c^\dagger_p \tilde{c}_q e^{\hat{T}}}
    {\Phi}, \\
    \rho^{qs}_{pr} &= \rho^{qs}_{pr}(\lambda, \tau) 
    \equiv \mel{\tilde{\Phi}}
    {(1 + \Lambda)e^{-\hat{T}} c^\dagger_p c^\dagger_r \tilde{c}_s \tilde{c}_q e^{\hat{T}}}
    {\Phi}, \\
    h^p_q &= h^p_q(\tilde{\Phi}, \Phi)
    \equiv \mel{\tilde{\phi}_p}{\hat{h}}{\varphi_q}, \\
    \eta^p_q &= \eta^p_q(\tilde{\Phi}, \Phi)
    \equiv \braket*{\tilde{\phi}_p}{\dot{\varphi}_q}, \\
    u^{pr}_{qs} &= u^{pr}_{qs}(\tilde{\Phi}, \Phi)
    \equiv \mel{\tilde{\phi}_p\tilde{\varphi}_r}
    {(\hat{u} - \hat{P}_{12})}
    {\phi_q \varphi_s}.
\end{align}
We introduced Einstein summation convention over repeated indices of opposite vertical 
placement in \autoref{eq:einsum_density_operator_functional}.

\subsection{Equations of Motion}

The time has now come to apply the principle of least action to the orbital-adaptive 
coupled cluster functional from \autoref{eq:oatdcc_functional_final} in order to 
find the equations of motion. First we keep $\tau^\nu$ constant and vary $\lambda_\mu$,
\begin{equation}
    \delta\mathcal{S}[\lambda, \tau] 
    = \int_0^T i\hbar 
        \delta\lambda_\mu\dot{\tau}^\nu 
        - \frac{\partial \mathscr{E}_{\hat{H} - i\hbar \hat{D}_0}}{\partial \lambda_\mu} 
            \delta\lambda_\mu
    dt = 0.
\end{equation}
We see that the stationary condition is 
\begin{equation}
    \label{eq:oatdcc_tau}
    \boxed{
    i\hbar \dot{\tau}^\mu 
    = \frac{\partial}{\partial \lambda_\mu}
        \mathscr{E}_{\hat{H} -i \hbar \hat{D}_0}[\lambda, \tau, \tilde{\Phi}, \Phi]
    = \mel*{\tilde{\Phi}_\mu}
        {e^{-\hat{T}}(\hat{H} - i\hbar \hat{D}_0)e^{\hat{T}}}{\Phi},
    }
\end{equation}
which is also the eqution of motion, dictating the time-development of $\tau$. Next, 
we hold $\lambda_\mu$ fixed and vary $\tau^\nu$,
\begin{equation}
    \delta \mathcal{S}[\lambda, \tau]
    = \int_0^T
        i\hbar \lambda_\nu \delta \dot{\tau}^\nu
        - \frac{\partial \mathscr{E}_{\hat{H} - i\hbar\hat{D}_0}}{\partial \lambda^\nu} 
    dt. 
\end{equation}
through integration by parts we see that the first term becomes,
\begin{equation*}
    i\hbar\int_0^T \lambda_\nu \delta\dot{\tau}^\nu
    = i\hbar\cancelto{0}{\lambda_\nu\delta\tau^\nu}
    - i\hbar \int_0^T \dot{\lambda}_\nu \delta\tau^\nu dt,
\end{equation*}
yielding 
\begin{equation}
    \delta\mathcal{S}[\lambda, \tau] 
    = \int_0^T \delta \tau^\nu \left(-i\hbar\dot{\lambda}_\nu 
    -\frac{\partial \mathscr{E}_{\hat{H} - i\hbar\hat{D}_0}}{\partial\tau^\nu} \right).
\end{equation}
Here the stationary condition is 
\begin{equation}
    \label{eq:oatdcc_lambda}
    \boxed{
    -i\hbar\dot{\lambda}_\nu = \frac{\partial}{\partial \tau^\nu}
    \mathscr{E}_{\hat{H} - i\hbar\hat{D}_0}[\lambda, \tau, \tilde{\Phi}, \Phi]
    = \mel*{\tilde{\Phi}}
        {(1 + \Lambda)e^{-\hat{T}}[\hat{H} -i\hbar\hat{D}_0, X_\mu]e^{\hat{T}}
        }{\Phi}.
    }
\end{equation}
\autoref{eq:oatdcc_tau} and \autoref{eq:oatdcc_lambda} together make up the orbital-adaptive 
coupled cluster (OACC) amplitude equations of motion.

We will return to the OACC equations of motion shortly, but first we consider a special 
situation where the operator
$\hat{D}_0 \equiv \sum_{pq} \braket*{\tilde{\phi}_p}{\dot{\phi}_q}c^\dagger_p\tilde{c}_q$,
equates to zero. This is the same as keeping the orbitals static over time. The 
resulting equations of motions are 
\begin{align}
    \label{eq:tdcc_tau}
    i\hbar\dot{\tau}^\mu 
        &= \frac{\partial}{\partial \lambda_\mu}\mathscr{E}_{\hat{H}}
            [\lambda, \tau, \tilde{\Phi}, \Phi]
        = \mel*{\tilde{\Phi}_\mu}
            {e^{-\hat{T}}\hat{H}e^{\hat{T}}}
        {\Phi} \\
    \label{eq:tdcc_lambda}
    -i\hbar\dot{\lambda}_\nu
        &= \frac{\partial}{\partial \tau^\nu}\mathscr{E}_{\hat{H}}
            [\lambda, \tau, \tilde{\Phi}, \Phi]
        = \mel*{\tilde{\Phi}}
            {(1 + \Lambda)e^{-\hat{T}}[\hat{H}, X_\mu]e^{\hat{T}}}
        {\Phi}.
\end{align}
We call these equations the time-dependent coupled cluster (TDCC) amplitude equations. 
Setting the left-hand side of
\autoref{eq:tdcc_tau} and \autoref{eq:tdcc_lambda} to zero will give a set of 
non-linar equations that can be solved in order to find initial amplitudes 
($\lambda^{(0)}$, $\tau^{(0)}$). These equations are the same as 
\autoref{eq:lagrangian_tau_amplitude_eqns} and \autoref{eq:lagrangian_lambda_amplitude_eqns}.

Returning to the orbital-adaptive scheme, the OATDCC equations 
(\autoref{eq:oatdcc_tau} and \autoref{eq:oatdcc_lambda}) have parametric redundancies
that we need to address briefly\footnote{A thorough decription of this matter can be 
found in the supplementary to Kvaal's articl on OATDCC\cite{kvaal2012ab}}. The 
parametric redundancies exist in the sense that when one derives equations of motion
for 
$(\tau, \lambda, \tilde{\Phi}, \Phi) = (\tau^\mu, \lambda_\mu, \tilde{\phi}_p, \phi_q)$,
under the stationary condition
$\delta\mathcal{S} = 0$, for a given pair of coupled cluster wavefunctions
$(\bra*{\tilde{\Psi}}, \ket{\Psi}) \in \mathcal{M}$, there are many choices for the amplitudes and 
orbitals that would give this same wavefunction pair. It is therefore necessary 
to define a transformation as a many-to-one mapping from this collection of points
$(\lambda, \tau, \tilde{\Phi}, \Phi) \in \mathcal{N}$
to the wavefunction pair on $(\bra*{\tilde{\Psi}}, \ket{\Psi}) \in \mathcal{M}$,
\begin{equation}
   f : \mathcal{N} \to \mathcal{M}. 
\end{equation}
As circumstances would have it, the simplest of such transformations corresponds to 
a rotation that eliminates the singles amplitudes $\tau^a_i$. This is the same ansatz 
employed in orbital-optimised-  or Bruecker coupled cluster theory (see box). Additionally,
including $\lambda^i_a$ after this rotation would leave the equations of motions 
overdetermined. The presence of $\hat{T}_1$ is compensated by the freely 
varying orbitals, but this does not hold for $\Lambda_1$, which gives more 
parameters in the $\bra*{\tilde{\Psi}}$ than in $\ket{\Psi}$. As such, we set all 
single amplitudes, $\tau^a_i$ and $\lambda^i_a$ equal to zero.

\begin{tcolorbox}[title={Orbital-optimised and Bruecker coupled cluster theories
    \cite{krylov1998size,pedersen1999gauge}}, 
    colback={white},
    colbacktitle={pink},
    coltitle={black}]

    In standard coupled cluster theory including single excitations,
    \begin{equation}
        \label{eq:the_singles_manifold}
        e^{\hat{T}_1} = \exp{\sum_{ai}\tau^a_ic^\dagger_ac_i},
    \end{equation} 
    we determine a set of non-zero single-excitation amplitudes $\tau^a_i$
    together with any 
    higher-excitation amplitudes.
    An alternative parametrisation of the singles manifold
    in \autoref{eq:the_singles_manifold} is the orthogonal orbital-rotation 
    operator
    \begin{equation}
        \label{eq:the_orbital rotator}
        e^{-\kappa} = \exp{ 
            - \sum_{ai} \kappa_ai(c^\dagger_a c_i - c^\dagger_i c_a)     
        }
    \end{equation}
    This is a rephrasing of Thouless
    theorem\cite{thouless1960stability}. We may therefore use 
    \begin{equation}
       \ket{\Psi_{\text{OCC}}} = e^{-\kappa}e^{\hat{T}_{\text{O}}}\ket{\Phi}
    \end{equation}
    as a wavefunction ansatz instead. Here,
    \begin{equation}
        \hat{T}_{\text{O}} = \hat{T}_2 + \hat{T}_3 + \dots
    \end{equation}

\end{tcolorbox}

In orbital-adaptive time-dependent coupled cluster theory such a gauge condition corresponds
to considering orbital time derivatives of the form
\begin{align}
    \label{eq:orbital_time_derivative_ket}
    \ket{\dot{\phi}_q} &= (P + Q)\ket{\dot{\phi}_q}
        = \sum_p \ket{\phi_p}\braket{\tilde{\phi}_p}{\dot{\phi}_q} 
            + Q\ket{\dot{\phi_q}}
        = \sum_p\eta^p_q + Q\ket{\dot{\phi}_q}\\
    \label{eq:orbital_time_derivative_bra}
    \bra*{\dot{\tilde{\phi}}_p} &= \bra{\dot{\tilde{\phi}}_p}(P + Q)
        = \sum_q \braket{\dot{\tilde{\phi}}_p}{\phi_q}\bra{\tilde{\phi}_q}
            + \bra{\dot{\tilde{\phi}}_p}Q
        = - \sum_q \eta^p_q \bra{\tilde{\phi}_q} + \bra{\dot{\tilde{\phi}}_p}Q,
\end{align}
with $\eta^i_j = \eta^a_b = 0$,
<<<<<<< HEAD
$\eta^p_q = \braket*{\tilde{\phi}_p}{\dot{\phi}_q} = - \braket*{\dot{\tilde{\phi}}_p}{\phi_q}$.
=======
$\eta^p_q = \braket{\tilde{\phi}_p}{\dot{\phi}_q} = - \braket{\dot{\tilde{\phi}}_p}{\phi_q}$.
>>>>>>> 5fa5d9300d7bda0a55cb5d73d10059e9abff243b
Here we have defined the projection operators $P$ and $Q$, where 
$P = \Phi\tilde{\Phi} = \sum_p \dyad{\phi_p}{\phi_p}$ projects onto the single-particle 
space defined by the orbitals, and $Q = 1 - P$ projects onto everything else.

We can write down equations of motions just for the nonzero $P$-components
$\eta^a_i$ and $\eta^i_a$ of the orbital derivatives,
\begin{align}
    i\hbar \sum_{bj}A^{ib}_{aj}\eta^j_b 
        &= \sum_p \rho^i_p h^p_a - \sum_q \rho^q_a h^i_q
        + \frac{1}{2}\left[ 
              \sum_{qrs} \rho^{is}_{pr} u^{pr}_{as}
            - \sum_{rqs} \rho^{qs}_{ar} u^{ir}_{qs}     
        \right] \\
    - i\hbar \sum_{bj} A^{ja}_{bi}\eta^b_j 
        &= \sum_p \rho^a_p h^p_i - \sum_q \rho^q_i h^a_q
        + \frac{1}{2} \left[
              \sum_{prs} \rho^{as}_{ps} u^{pr}_{is}
            - \sum_{rqs} \rho^{qs}_{ir} u^{ar}_{qs}
        \right]
        + i\hbar \hat{\rho}_i^a,
\end{align}
where the matrix elements $A^{ib}_{aj}$ are defined by,
\begin{equation}
    A^{ib}_{aj} \equiv 
    \mel{\tilde{\Psi}}{[c^\dagger_j\tilde{c}_b, c^\dagger_a\tilde{c}_i]}{\Psi}
    = \delta^b_a\rho^i_j - \delta^i_j\rho^b_a.
\end{equation}
The $Q$-part of the orbital derivatives are,
\begin{align}
    i\hbar\sum_q \rho^q_p Q \frac{\partial}{\partial t} \ket{\phi_q}
        &= \sum_q \rho^q_p Q h\ket{\phi_q}
        + \sum_{qrs} \rho^{qs}_{pr}Q W^r_s\ket{\phi_q}, \ \forall p \\
    -i\hbar\sum_p \rho^q_p \left(\frac{\partial}{\partial t}\bra{\tilde{\phi}_p} \right)Q
        &= \sum_p\rho^q_p \bra{\tilde{\phi}_p}hQ
        + \sum_{prs} \rho^{qs}_{pr} \bra{\tilde{\phi}_p}W^r_s Q, \ \forall q,
\end{align}
where mean-field operators $W^r_s$ are defined by 
\begin{equation}
    W^r_s\ket{\psi} \equiv 
    \mel*{\cdot \tilde{\phi}_r}{u}{\psi\phi_s}.
\end{equation}

The logical next step is to write down the equations of motion for the lowest 
truncated form of OATDCC available too us, namely OATDCCD. In addition to the 
orbitals $\Phi$ and $\tilde{\Phi}$, the only parameters of the exact wavefunction 
are the amplitudes $\tau = \tau^{ab}_{ij}$ and $\lambda = \lambda^{ij}_{ab}$. 
The OATDCCD amplitude equations read 
\begin{align}
    \label{eq:oatdccd_tau}
    i\hbar \dot{\tau}^{ab}_{ij} 
        &= \frac{\partial}{\partial \lambda^{ij}_{ab}}
            \mathscr{E}_{\text{H}}[\lambda, \tau, \tilde{\Phi}, \Phi]
        = \mel{\tilde{\phi}^{ab}_{ij}}
            {e^{-\hat{T}}\hat{H}e^{\hat{T}}}
        {\phi} \\
    \label{eq:oatdccd_lambda}
    -i\hbar\dot{\lambda}^{ij}_{ab}
        &= \frac{\partial}{\partial \tau^{ab}_{ij}}
            \mathscr{E}[\lambda, \tau, \tilde{\Phi}, \Phi]
        = \mel{\tilde{\phi}}
            {(1 + \Lambda)e^{-\hat{T}}[\hat{H}, X^{ij}_{ab}]e^{\hat{T}}}
            {\phi}.
\end{align}
The $P$-space orbitals read 
\begin{align}
    \label{eq:oatdccd_p_1}
    i\hbar\sum_{bj}A^{ib}_{aj} \eta^j_b
        &= \sum_j \rho^i_j h^j_a - \sum_b \rho^b_a h^i_b
        + \frac{1}{2}\left[
             \sum_{prs}\rho^{is}_{pr} u^{pr}_{as}
            -\sum_{rqs}\rho^{qs}_{ar} U^{ir}_{qs}
        \right], \\
    \label{eq:oatdccd_p_2}
    -i\hbar\sum_{bj}A^{ja}_{bi} \eta^b_j
        &= \sum_b \rho^a_b h^b_i - \sum_j \rho^j_i h^a_j
        + \frac{1}{2}\left[
             \sum_{prs}\rho^{as}_{pr} u^{pr}_{is}
            -\sum_{rqs}\rho^{qs}_{ir} U^{ar}_{qs}       
        \right]
\end{align}
and the $Q$-space orbitals read
\begin{align}
    \label{eq:oatdccd_q_1}
    i\hbar\sum_q \rho^q_p Q \frac{\partial}{\partial t} \ket{\phi_q}
        &= \sum_q \rho^p_q Q h\ket{\phi_q} 
            + \sum_{qrs} \rho^{qs}_{pr} Q W^r_s \ket{\phi_q}, \\
    \label{eq:oatdccd_q_2}
    -i\hbar\sum_p \rho^q_p
    \left(\frac{\partial}{\partial t} \bra{\tilde{\phi}_q}\right)Q
        &= \sum_p \rho^q_p \ket{\phi_q} Q h
            + \sum_{prs} \rho^{qs}_{pr}\bra{\phi_q} W^r_s Q.
\end{align}

Notice that the $\tau$ and $\lambda$ OATDCCD equations
(\autoref{eq:oatdccd_tau} and \autoref{eq:oatdccd_lambda}) are the 
same equations as the ones used in standard TDCCD
(\autoref{eq:tdcc_tau} and \autoref{eq:tdcc_lambda}), because the 
operator $\hat{D}_0$ is eliminated due to $\rho^a_i = \rho^i_a = 0$.
Because the operators $\hat{D}_0$ disappears from 
\autoref{eq:oatdccd_tau} and \autoref{eq:oatdccd_lambda},
the right-hand sides can be evaluated independently of 
equations \ref{eq:oatdccd_p_1}, \ref{eq:oatdccd_p_2},
\ref{eq:oatdccd_q_1}, \ref{eq:oatdccd_q_2}. In order to compute 
$\dot{\tilde{\Phi}}$ and $\dot{\Phi}$, $\eta$ must be solved for in 
addition to $Q\ket*{\dot{\phi}_q}$ and $\bra*{\dot{\tilde{\phi}}_p}Q$,
according to \autoref{eq:orbital_time_derivative_ket} and 
\autoref{eq:orbital_time_derivative_bra}.