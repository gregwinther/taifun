\section{Configuration space derivation of CCD}
\label{app:conf_derivation_ccd}

We start from the CCD-constrained time-independent Schrödinger equation,
\begin{equation}
    \hat{H}\Psi_{\text{CCD}} = E_{\text{CCD}} \Psi_{\text{CCD}},
\end{equation}
which we left project with the reference state,
\begin{gather*}
    \bra{\Phi_0} \hat{H} \ket{\Psi_{\text{CCD}}} = \bra{\Phi_0} E_{\text{CCD}} \ket{\Psi_{\text{CCD}}} \nonumber \\
    \to E_{\text{CCD}} = \bra{\Phi_0} \hat{H} \ket{\Psi_{\text{CCD}}},
\end{gather*}
where we have taken advandage of the intermediate normalisation, 
$\braket{\Phi_0}{\Psi_{\text{CCD}}} = 1$. We then insert the exponential expansion
from the coupled cluster ansatz,
\begin{equation}
    \label{eq:ccd_energy}
    \begin{aligned}
    E_{\text{CCD}} &= \bra{\Phi_0} \hat{H} (1 + \hat{T}_2)\ket{\Phi_0} \\
        &= E_{\text{ref}} 
        + \sum_{\substack{i>j \\ a>b}} \bra{\Phi_0} \hat{H} \ket{\Phi_{ij}^{ab}}t^{ab}_{ij} \\
        &= E_{\text{ref}}
        + \sum_{\substack{i>j \\ a>b}} \bra{ij} \ket{ab}t^{ab}_{ij}.
    \end{aligned}
\end{equation}
The energy expression will truncate here because no higher-order terms will contribute.
It is common to substract $E_{\text{ref}}$ to get,
\begin{equation}
    \hat{H}_N \Psi_{\text{CCD}} = \Delta E_{\text{CCD}} \Psi_{\text{CCD}},
\end{equation}
where $\hat{H}_N = \hat{H} - E_{\text{ref}}$. Here follow the definitions of 
all the operators we will be dealing with in this derivation,
\begin{equation}
    \hat{H}_N = \hat{F} - \hat{U} + \hat{H}_2 - E_{\text{ref}}
        = \hat{H}_0 + \hat{F}^0 - \hat{U} + \hat{H}_2 - E_{\text{ref}},
\end{equation}
where,
\begin{gather}
    \hat{H}_0 = \hat{F}^d = \sum_\mu \hat{f}_\mu^d, 
        \quad \bra{p} \hat{f}_\mu^d \ket{q} = \epsilon_p \delta_{pq} \\
    \hat{F}^0 = \sum_\mu \hat{f}^0_\mu,
        \quad \bra{p} \hat{f}^0 \ket{q} = (1 - \delta_{pq})\bra{p} \hat{f} \ket{q} \\
    \hat{U} = \sum_\mu \hat{u}_\mu, 
        \quad \bra{p} \hat{u}_\mu \ket{q} = \sum_i \bra{pi} \ket{qi} \\
    \hat{H}_2 = \sum_{\mu > \nu} \frac{1}{r_{\mu\nu}},
        \quad E_{\text{ref}} = E_0 + E^{(1)}, \\
    E_0  = \sum_i \epsilon_i, \quad E^{(1)} = - \frac{1}{2} \sum_{ij} \bra{ij} \ket{ij}.
\end{gather}
In the canonical HF case we have $\hat{F}^0 = 0$ and $\hat{F}^d = \hat{F}$.

In order to compute the energy of the system we need the amplitudes $t^{ab}_{ij}$.
Starting from the modified Schrödinger equation,
\begin{equation}
    \hat{H}_N \Psi_{\text{CCD}} = \Delta E_{\text{CCD}} \Psi_{\text{CCD}}.
\end{equation}
We left project with a doubly-excited Slater determinant, and insert for the CC ansatz,
\begin{gather}
    \bra*{\Phi^{ab}_{ij}} \hat{H}_N e^{\hat{T}_2} \ket{\Phi_0} 
        = \Delta E_{\text{CCD}} \bra*{\Phi^{ab}_{ij}} e^{\hat{T}_2} \ket{\Phi_0} \\
    \bra*{\Phi^{ab}_{ij}} 
        \hat{H}_N \left(1 + \hat{T}_2 + \frac{1}{2}\hat{T}^2_2\right) \ket{\Phi_0}
        = \Delta E_{\text{CCD}} t^{ab}_{ij}. \label{eq:ccd_amplitude}
\end{gather}
Here we have only expanded the exponential function up to the quadratic term. The next
term in the series will triple-excite the bra Slater determinant, which will give a
zero-contribution according to the Slater-Condon rules, because of two noncoincidences. Next we apply the Slater-Condon rules to the rest of the terms on the right-hand side, starting with just the normal-ordered Hamiltonian,
\begin{equation}
    \bra*{\phi^{ab}_{ij}} \hat{H}_N \ket{\Phi_0} = \bra{ab} \ket{ij},
\end{equation}
where only $\hat{H}_2$ contributes.

Next we look at the linear term,
\begin{equation}
    \begin{aligned}
    \bra*{\Phi^{ab}_{ij}} &\hat{H}_N \hat{T}_2 \ket{\Phi_0} 
        = \sum_{klcd} \bra{\phi^{ab}_{ij}} \hat{H}_N \ket{\phi^{cd}_{kl}} \\
    &= \bra{\Phi^{ab}_{ij}} \hat{H}_0 - E_{\text{ref}} \ket{\Phi^{ab}_{ij}}t^{ab}_{ij}
        + \sum_{\substack{k>l \\ c>d}} 
            \bra{\Phi^{ab}_{ij}} \hat{F}^0 - \hat{U} \ket{\Phi^{cd}_{kl}} t^{cd}_{kl} \\
    &\quad + \sum_{\substack{k>l \\ c>l}} 
        \bra{\Phi^{ab}_{ij}} \hat{H}_2 \ket{\Phi^{cd}_{kl}} t^{cd}_{kl} 
        = L_0 + L_1 + L_2.
    \end{aligned}
\end{equation}
We are going to evaluate these terms one-by-one, starting with $L_0$,
\begin{equation}
    \begin{aligned}
        L_0 &= \bra{\Phi^{ab}_{ij}} \hat{H}_0 - E_{\text{ref}}\ket{\Phi^{ab}_{ij}}
            = \bra{\Phi^{ab}_{ij}} \hat{H}_0 - E_0 - E^{(1)}\ket{\Phi^{ab}_{ij}} \\
            &= \left(-\varepsilon^{ab}_{ij} + \frac{1}{2}\sum_{kl}\bra{kl} \ket{kl}\right) t^{ab}_{ij}.,
    \end{aligned}
\end{equation}
where $\varepsilon^{ab}_{ij} = \varepsilon_i + \varepsilon_j - \varepsilon_a - \varepsilon_b$.

The next term,
\begin{equation}
    L_1 = \sum_{\substack{k>l \\ c>d}} 
            \bra{\Phi^{ab}_{ij}} \hat{F}^0 - \hat{U} \ket{\Phi^{cd}_{kl}} t^{cd}_{kl},
\end{equation}
yields contributions if at least three of the indices $k$, $l$, $c$, $d$ are equal to 
the indices $i$, $j$, $a$, $b$ (we want one or zero noncoincidences). All the possible
terms are,
\begin{equation}
L_1 = \begin{cases}
\begin{aligned}
     - \sum_k u_{kk} t^{ab}_{ij} &\quad \text{all indices equal} \\
     - \sum_k(f^0_{jk} - u_{jk}) t^{ab}_{ik} &\quad \text{one hole index unequal} \\
     + \sum_k(f^0_{ik} - u_{ik}) t^{ab}_{jk} &\quad \text{the other hole index unequal} \\
     - \sum_c(f^0_{ac} - u_{ac}) t^{bc}_{ij} &\quad \text{one particle index unequal} \\
     + \sum_c(f^0_{bc} - u_{bc}) t^{zc}_{ij} &\quad \text{the other particle index unequal}.
\end{aligned}
\end{cases}
\end{equation}

For the last linear term,
\begin{equation}
    L_2 = \sum_{\substack{k>l \\ c>d}}\bra{\Phi^{ab}_{ij}} \hat{H}_2 \ket{\Phi^{cd}_{kl}} t^{cd}_{kl},
\end{equation}
we require that at least two of the indices $k$, $l$, $c$, $d$ are equal to the indices $i$, $j$, $a$, $b$,
as we can do with at most two noncoincidences in the bra and the ket. For equality in
both the hole indices or both the particle indices we have
\begin{align}
    cd = ab \quad &\to \quad \sum_{k>l}\bra{ij}\ket{kl} t^{ab}_{kl} \\ 
    kl = ij \quad &\to \quad \sum_{c>d}\bra{ab}\ket{cd} t^{cd}_{ij}.
\end{align}
For one equality in both hole and particle index we have
\begin{equation}
    -\sum_{kl}\big(\bra{bk}\ket{cj} t^{ac}_{ik} - \bra{bk}\ket{ci} t^{ac}_{jk}  
                -\bra{ak}\ket{cj} t^{bc}_{ik} - \bra{bk}\ket{ci}  t^{ac}_{jk} \big),
\end{equation}
where the sign stems from the maximum coincidence permutations as dictated by the
Slater-Condon rules. Most of the three- and four equal index terms are accounted
for by the expression above, the remaining three-index equality terms are
\begin{align}
    -\sum_{kl}\big( \bra{jl}\ket{kl} t^{ab}_{ik} - \bra{il}\ket{kl} t^{ab}_{jk} \big) \\
    +\sum_{cl}\big( \bra{bl}\ket{cl} t^{ac}_{ij} - \bra{al}\ket{cl} t^{bc}_{ij} \big),
\end{align}
and there is one term for the case where all indices are equal,
\begin{equation}
    \sum_{k>l} \bra{kl} \ket{kl} t^{ab}_{ij} = \frac{1}{2} \sum_{kl} \bra{kl} \ket{kl} t^{ab}_{ij}.
\end{equation}

These last three- and four-index equality terms are expressible in terms of $\hat{u}$,
and will cancel the first term in $L_1$ together with the $\hat{u}$ term from $L_0$.
All terms so far are the same as in a configuration interaction with doubles excitations
(CID) computation. The difference between coupled cluster with doubles (CCD) and
CID is the following extra quadratic terms,
\begin{equation}
    Q = \frac{1}{2}\bra{\Phi^{ab}_{ij}} \hat{H}_N \hat{T}_2^2\ket{\Phi_0}
        = \frac{1}{2} \sum_{\substack{k>l \\ c>d}} \sum_{\substack{m>n \\ e>f}}
            \bra{\phi^{ab}_{ij}} \hat{H}_N \ket{\Phi^{cdef}_{klmn}}t^{cd}_{kl}t^{ef}_{mn}.
\end{equation}
From this expression we will have a contribution only when four of the indices $k$, $l$,
$m$, $n$, $c$, $d$, $e$, $f$ are equal to $i$, $j$, $a$, $b$; and only $\hat{H}_2$
can contribute. We will find that this becomes,
\begin{equation}
    \label{eq:quad_term}
    \begin{aligned}
        Q = \sum_{\substack{k>l \\ c>d}} \bra{kl} \ket{cd}\big[
                &(t^{ab}_{ij}t^{cd}_{kl} + t^{cd}_{ij}t^{ab}_{kl}) 
            -2   (t^{ac}_{ik}t^{cd}_{jl} + t^{bd}_{ij}t^{bd}_{ij}) \\
            -2  &(t^{ab}_{ik}t^{cd}_{jl} + t^{cd}_{ik}t^{ab}_{jl}) 
            +4   (t^{ac}_{ik}t^{bd}_{jl} + t^{bd}_{ik}t^{ac}_{jl})
            \big].
    \end{aligned}
\end{equation}
From \autoref{eq:ccd_energy} we see that
\begin{equation}
    \label{eq:ccd_energy2}
    \Delta E_{\text{CCD}} = \sum_{\substack{i>j \\ a>b}} \bra{ij} \ket{ab} t^{ab}_{ij},
\end{equation}
and because the indices in \autoref{eq:quad_term} are dummy variables we see that
the first term here cancels with the right-hand side of \autoref{eq:ccd_amplitude}.
This leads to,
\begin{equation}
    \begin{aligned}
    \varepsilon^{ab}_{ij}t^{ab}_{ij}
        &= \bra{ab}\ket{ij} + \frac{1}{2}\sum_{cd} \bra{ab}\ket{cd}t^{cd}_{ij}
            + \frac{1}{2}\sum_{kl} \bra{ij} \ket{kl} t^{ab}_{kl} \\
        &\ -\sum_{kl}\big(
             \bra{bk}\ket{cj}t^{ac}_{ik} 
            -\bra{bk}\ket{ci}t^{ac}_{jk}
            -\bra{ak}\ket{cj}t^{bc}_{ik}
            +\bra{ak}\ket{ci}t^{bc}_{jk}
            \big) \\
        &\ -\sum_k \hat{f}^0_{jk} t^{ab}_{ik}
            +\sum_k \hat{f}^0_{ik} t^{ab}_{jk}
            +\sum_c \hat{f}^0_{bc} t^{ac}_{ij}
            -\sum_c \hat{f}^0_{ac} t^{bc}_{ij} \\
        &\ +\sum_{klcd} \bra{kl} \ket{cd} \Big[
            \frac{1}{4}t^{cd}_{ij}t^{ab}_{kl}
            -\frac{1}{2}(t^{ac}_{ij}t^{bd}_{kl} + t^{bd}_{ij}t^{ac}_{kl}) \\
        &\quad\quad -\frac{1}{2}(t^{ab}_{ik}t^{cd}_{jl} + t^{cd}_{ik}t^{ab}_{jl})
            +(t^{ac}_{ik}t^{bd}_{jl} + t^{bd}_{ik}t^{ac}_{jl})
            \Big],
    \end{aligned}
\end{equation}
which is the CCD amplitude equations. This equation contains simultaneous algebraic 
expressions, contrary to CI. The equations must be solved iteratively, substituting 
$t^{ab}_{ij}$ obtained in each iteration, into the quadratic terms for the next 
iteration.
